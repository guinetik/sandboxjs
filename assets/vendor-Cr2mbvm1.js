const e=4e3,t=5e3,o=5e3,s=320,r=420,n=100,i=100,l=5,a="js-sandbox-code",h={ERROR:0,WARN:1,INFO:2,DEBUG:3,TRACE:4},d=768;const c=function(){const e=document.querySelector("base");if(e&&e.href){return new URL(e.href).pathname}return window.location.pathname.includes("/sandboxjs/")?"/sandboxjs/":"/"}()+"examples",g="./src/ui/sandbox.html",m={INIT_START:"init:start",INIT_COMPLETE:"init:complete",INIT_ERROR:"init:error",CODE_CHANGE:"code:change",CODE_LOAD:"code:load",CODE_VALIDATE:"code:validate",CODE_EXECUTE_START:"code:execute:start",CODE_EXECUTE_COMPLETE:"code:execute:complete",CODE_EXECUTE_TIMEOUT:"code:execute:timeout",CONSOLE_MESSAGE:"console:message",CONSOLE_CLEAR:"console:clear",SANDBOX_RESET:"sandbox:reset",STATUS_CHANGE:"status:change",THEME_LOAD_START:"theme:load:start",THEME_LOAD_COMPLETE:"theme:load:complete",THEME_CHANGE:"theme:change",THEME_READY:"theme:ready",EDITOR_READY:"editor:ready",EXAMPLE_LOAD:"example:load",EXAMPLE_LOADED:"example:loaded",EXAMPLE_ERROR:"example:error",PANES_RESIZED:"panes:resized",PANES_RESIZED_VERTICAL:"panes:resized:vertical",DESTROY:"destroy"},u={executing:"Executingâ€¦",completed:"Completed",timeout:"Timeout exceeded",reset:"Sandbox reset",cleared:"Console cleared"},p=2,E={SECRET:"{{SECRET}}",USER_CODE:"{{USER_CODE}}"};const f=new class{constructor(){this.allowedComponents=new Set,this.globalEnabled=!0,this.allowAll=!1,this.loadFromStorage()}enable(...e){e.forEach(e=>this.allowedComponents.add(e.toLowerCase())),this.saveToStorage(),console.log("ðŸ”§ Logging enabled for:",e.join(", "))}disable(...e){e.forEach(e=>this.allowedComponents.delete(e.toLowerCase())),this.saveToStorage(),console.log("ðŸ”§ Logging disabled for:",e.join(", "))}enableAll(){this.allowAll=!0,this.saveToStorage(),console.log("ðŸ”§ Logging enabled for ALL components")}disableAll(){this.allowAll=!1,this.allowedComponents.clear(),this.saveToStorage(),console.log("ðŸ”§ Logging disabled for ALL components (errors still show)")}status(){console.log("ðŸ”§ Logging Status:"),console.log("  Global enabled:",this.globalEnabled),console.log("  Allow all:",this.allowAll),console.log("  Enabled components:",Array.from(this.allowedComponents).join(", ")||"none")}listComponents(){console.log("ðŸ”§ Available components to filter:");Array.from(this.registeredComponents||[]).sort().forEach(e=>{const t=this.isComponentEnabled(e);console.log(`  ${t?"âœ…":"âŒ"} ${e}`)})}isComponentEnabled(e){return!!this.globalEnabled&&(!!this.allowAll||this.allowedComponents.has(e.toLowerCase()))}registerComponent(e){this.registeredComponents||(this.registeredComponents=new Set),this.registeredComponents.add(e)}saveToStorage(){try{const e={allowedComponents:Array.from(this.allowedComponents),allowAll:this.allowAll,globalEnabled:this.globalEnabled};localStorage.setItem("sandbox_logging_filters",JSON.stringify(e))}catch(e){}}loadFromStorage(){try{const e=JSON.parse(localStorage.getItem("sandbox_logging_filters")||"{}");this.allowedComponents=new Set(e.allowedComponents||[]),this.allowAll=e.allowAll||!1,this.globalEnabled=!1!==e.globalEnabled,localStorage.getItem("sandbox_logging_filters")||(this.allowedComponents=new Set(["themeswitcher","codemirroreditor","editoradapter"]))}catch(e){this.allowedComponents=new Set(["themeswitcher","codemirroreditor","editoradapter"])}}};"undefined"!=typeof window&&(window.logFilter={enable:(...e)=>f.enable(...e),disable:(...e)=>f.disable(...e),enableAll:()=>f.enableAll(),disableAll:()=>f.disableAll(),status:()=>f.status(),list:()=>f.listComponents()});class C{constructor(e={}){this.enabled=!1!==e.enabled,this.level=e.level||"info",this.prefix=e.prefix||"",this.component=this.prefix,this.redactSecrets=e.redactSecrets||!1,this.currentLevel=h[this.level.toUpperCase()]??h.INFO,this.component&&f.registerComponent(this.component)}shouldLog(e){if("ERROR"===e.toUpperCase())return this.enabled&&h[e.toUpperCase()]<=this.currentLevel;const t=!this.component||f.isComponentEnabled(this.component);return this.enabled&&t&&h[e.toUpperCase()]<=this.currentLevel}redactArgs(e){return this.redactSecrets?e.map(e=>"string"==typeof e?e.replace(/\b[a-zA-Z0-9]{20,}\b/g,"[REDACTED]"):e):e}formatMessage(e,...t){return[(this.prefix?`[${this.prefix}] `:"")+e,...this.redactArgs(t)]}error(e,...t){this.shouldLog("error")&&console.error(...this.formatMessage(e,...t))}warn(e,...t){this.shouldLog("warn")&&console.warn(...this.formatMessage(e,...t))}info(e,...t){this.shouldLog("info")&&console.info(...this.formatMessage(e,...t))}log(e,...t){this.shouldLog("info")&&console.log(...this.formatMessage(e,...t))}debug(e,...t){this.shouldLog("debug")&&console.debug(...this.formatMessage(e,...t))}trace(e,...t){if(this.shouldLog("trace")){const o=this.redactSecrets;this.redactSecrets=!0,console.trace(...this.formatMessage(e,...t)),this.redactSecrets=o}}table(e,t){if(this.shouldLog("info")){const o=this.prefix?`[${this.prefix}]`:"";o&&console.log(o),console.table(e,t)}}group(e){this.shouldLog("info")&&console.group(...this.formatMessage(e))}groupCollapsed(e){this.shouldLog("info")&&console.groupCollapsed(...this.formatMessage(e))}groupEnd(){this.shouldLog("info")&&console.groupEnd()}time(e){this.shouldLog("debug")&&console.time(this.prefix?`[${this.prefix}] ${e}`:e)}timeEnd(e){this.shouldLog("debug")&&console.timeEnd(this.prefix?`[${this.prefix}] ${e}`:e)}setLevel(e){this.level=e,this.currentLevel=h[e.toUpperCase()]??h.INFO}enable(){this.enabled=!0}disable(){this.enabled=!1}isEnabled(){return this.enabled}}class b{constructor(e,t={},o=null){this.container=e,this.options=t,this.eventEmitter=o,this.changeHandlers=[],this.executeHandlers=[],this.logger=new C({enabled:!0,level:"info",prefix:"EditorAdapter"}),this.eventEmitter?(this.logger.info("Setting up theme event listeners"),this.eventEmitter.on(m.THEME_READY,e=>{this.logger.info("Base adapter received theme ready event:",e),this.onThemeChange(e.theme,null)}),this.eventEmitter.on(m.THEME_CHANGE,e=>{this.logger.info("Base adapter received theme change event:",e),this.onThemeChange(e.theme,e.oldTheme)})):this.logger.warn("No event emitter provided - theme switching will not work")}getValue(){throw new Error("getValue() must be implemented by editor adapter")}setValue(e){throw new Error("setValue() must be implemented by editor adapter")}onChange(e){this.changeHandlers.push(e)}onExecute(e){this.executeHandlers.push(e)}focus(){throw new Error("focus() must be implemented by editor adapter")}triggerChange(){this.changeHandlers.forEach(e=>e(this.getValue()))}triggerExecute(){this.executeHandlers.forEach(e=>e())}onThemeChange(e,t){}destroy(){}}class w extends b{constructor(e,t={},o=null){super(e,t,o),this.cm=null,this.currentTheme=t.theme||"darcula",this.logger=new C({enabled:!0,level:"info",prefix:"CodeMirrorEditor"}),this.logger.info("CodeMirror editor initialized with theme:",this.currentTheme),this.logger.info("Event emitter provided:",!!o),this.init()}init(){if("undefined"==typeof CodeMirror)throw new Error("CodeMirror is not loaded. Include CodeMirror before using this adapter.");const e=document.createElement("textarea");this.container.appendChild(e),this.cm=CodeMirror.fromTextArea(e,{mode:this.options.mode||"javascript",theme:this.currentTheme,lineNumbers:!0,lineWrapping:!0,indentUnit:2,tabSize:2,indentWithTabs:!1,autofocus:!1!==this.options.autofocus,extraKeys:{"Ctrl-Enter":()=>this.triggerExecute(),"Cmd-Enter":()=>this.triggerExecute()}}),this.cm.on("change",()=>{this.triggerChange()}),this.applyGlassEffect(this.currentTheme)}getValue(){return this.cm.getValue()}setValue(e){this.cm.setValue(e)}focus(){this.cm.focus()}onThemeChange(e,t){this.logger.info("onThemeChange called with:",{newTheme:e,oldTheme:t}),this.logger.info("Current theme before change:",this.currentTheme),this.logger.info("CodeMirror instance exists:",!!this.cm),this.cm&&e!==this.currentTheme?(this.logger.info("Applying theme change from",this.currentTheme,"to",e),this.currentTheme=e,this.cm.setOption("theme",e),this.logger.info("Theme applied successfully. CodeMirror theme is now:",this.cm.getOption("theme")),this.applyGlassEffect(e)):(this.logger.warn("Theme change skipped. Reasons:"),this.logger.warn("- CodeMirror exists:",!!this.cm),this.logger.warn("- New theme different from current:",e!==this.currentTheme),this.logger.warn("- New theme value:",e),this.logger.warn("- Current theme value:",this.currentTheme))}applyGlassEffect(e){setTimeout(()=>{const t=this.container.querySelector(".CodeMirror");if(t){this.logger.info("Applying glass effect for theme:",e);const o=window.getComputedStyle(t).backgroundColor;this.logger.info("Original background color:",o);const s=this.reduceColorOpacity(o,.7);this.logger.info("Reduced opacity color:",s);let r=document.getElementById("codemirror-glass-effect");r||(r=document.createElement("style"),r.id="codemirror-glass-effect",document.head.appendChild(r));const n=`.cm-s-${e}`;r.textContent=`\n          ${n}.CodeMirror {\n            background-color: ${s} !important;\n          }\n          ${n} .CodeMirror-gutters {\n            background-color: ${this.reduceColorOpacity(o,.8)} !important;\n          }\n        `,this.logger.info("Glass effect applied with reduced opacity background")}},200)}reduceColorOpacity(e,t){const o=e.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*([\d.]+))?\)/);if(o){const[,e,s,r]=o;return`rgba(${e}, ${s}, ${r}, ${t})`}const s=e.match(/rgb\((\d+),\s*(\d+),\s*(\d+)\)/);if(s){const[,e,o,r]=s;return`rgba(${e}, ${o}, ${r}, ${t})`}const r=e.match(/^#([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i);if(r){return`rgba(${parseInt(r[1],16)}, ${parseInt(r[2],16)}, ${parseInt(r[3],16)}, ${t})`}return this.logger.warn("Could not parse color:",e,"using fallback"),`rgba(0, 0, 0, ${t})`}getCurrentTheme(){return this.currentTheme}setTheme(e){this.cm&&e!==this.currentTheme&&(this.currentTheme=e,this.cm.setOption("theme",e))}destroy(){this.cm&&this.cm.toTextArea()}}export{p as C,g as D,m as E,C as L,s as M,t as N,l as R,u as S,o as T,E as a,e as b,a as c,c as d,r as e,n as f,i as g,d as h,b as i,w as j};
//# sourceMappingURL=vendor-Cr2mbvm1.js.map
