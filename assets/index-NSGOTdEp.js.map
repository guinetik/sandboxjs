{"version":3,"mappings":"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","names":["Storage","constructor","key","DEFAULT_STORAGE_KEY","options","this","logger","Logger","enabled","debug","level","prefix","save","code","localStorage","setItem","e","warn","load","getItem","clear","removeItem","ExamplesLoader","examplesPath","DEFAULT_EXAMPLES_PATH","onLoad","onError","examples","Map","discoverExamples","knownExamples","id","title","description","file","availableExamples","info","example","url","response","fetchWithTimeout","NETWORK_TIMEOUT_MS","ok","text","set","push","status","error","message","length","loadExample","exampleId","has","get","Error","getAvailableExamples","Array","from","values","clearCache","destroy","ExamplesDropdown","container","onSelect","createDropdown","existingDropdown","querySelector","remove","dropdown","document","createElement","className","innerHTML","addEventListener","target","value","setTimeout","previewLabel","insertBefore","nextSibling","appendChild","setExamples","forEach","option","textContent","disabled","setLoading","loading","setError","parentNode","removeChild","ThemeSwitcher","eventEmitter","defaultTheme","storageKey","savedEditor","themes","getThemesForEditor","currentTheme","loadSavedTheme","initializeCurrentTheme","setupEditorChangeListener","on","EVENTS","EDITOR_CHANGE","async","data","refreshThemesForEditor","editor","editorName","EDITOR_THEMES","ACE","CODEMIRROR","TEXTAREA","populateThemes","find","t","switchTheme","newTheme","emit","THEME_LOAD_START","theme","loadThemeCSS","THEME_READY","themeValue","examplesDropdown","label","themeName","ace","themePath","require","Promise","resolve","savedTheme","saveTheme","oldTheme","THEME_CHANGE","getCurrentTheme","setTheme","addTheme","EditorSwitcher","defaultEditor","editors","available","CodeMirror","currentEditor","loadSavedEditor","populateEditors","editorValue","switchEditor","availableEditors","filter","saveEditor","oldEditor","getCurrentEditor","setEditor","refreshEditors","FullscreenManager","currentMode","appElement","elements","isChanging","setupEventListeners","init","app","fullscreenEditor","toggleFullscreen","fullscreenConsole","preventDefault","exitFullscreen","FULLSCREEN_TOGGLE","mode","FULLSCREEN_EXIT","setFullscreenMode","previousMode","classList","updateButtonStates","add","toUpperCase","activeMode","getCurrentMode","isFullscreen","LibraryManager","allowlistKey","console","log","defaultDomains","libraries","allowedDomains","libraryCache","loadFromStorage","LIBRARY_ADD","addLibrary","name","LIBRARY_REMOVE","removeLibrary","DOMAIN_TRUST_REQUEST","addDomain","domain","librariesData","JSON","parse","domainsData","savedDomains","Set","map","lib","join","saveLibraries","serialized","stringify","saveDomains","customDomains","includes","generateId","Date","now","Math","random","toString","substr","extractDomain","URL","hostname","guessLibraryName","pathname","nameWithoutExt","split","pop","replace","patterns","pattern","match","charAt","slice","extractVersionFromUrl","versionPatterns","isDomainAllowed","validateLibraryUrl","valid","domainAllowed","needsDomainApproval","validation","success","needsApproval","library","trim","addedAt","toISOString","LIBRARY_ADDED","index","findIndex","removed","splice","LIBRARY_REMOVED","DOMAIN_ADDED","removeDomain","indexOf","DOMAIN_REMOVED","getLibraries","getAllowedDomains","generateScriptTags","scripts","content","fetch","statusText","result","libraryNames","scriptSize","s","version","versionInfo","toFixed","generateCSP","getStats","libraryCount","domainCount","customDomainCount","LIBRARIES_CLEARED","testLogging","BaseDialog","modal","closeOnBackdrop","closeOnEscape","logPrefix","dialog","isOpen","closeButton","createDialog","header","body","close","getBody","setTitle","titleElement","open","focus","onBeforeOpen","showModal","show","onFocus","onAfterOpen","onBeforeClose","onAfterClose","toggle","isDialogOpen","setContent","HTMLElement","addClass","removeClass","LibraryDialog","libraryManager","super","urlInput","addBtn","libraryList","createLibraryContent","setupLibraryEventListeners","handleAddLibrary","LIBRARY_MANAGER_OPEN","refreshLibraryList","showDomainTrustDialog","clearFeedback","showFeedback","confirm","trace","querySelectorAll","btn","dataset","type","feedback","ShareManager","generateShareUrl","encodedCode","btoa","encodeURIComponent","currentUrl","window","location","href","searchParams","extractScriptFromUrl","encodedScript","URLSearchParams","search","decodedScript","decodeURIComponent","atob","copyToClipboard","navigator","clipboard","isSecureContext","writeText","textArea","style","position","left","top","select","successful","execCommand","shareCode","shareUrl","SHARE_SUCCESS","codeLength","SHARE_ERROR","hasScriptInUrl","cleanupUrl","delete","history","replaceState","NeonGlowManager","transitionDuration","autoRotate","hue1","randomHue","hue2","rotationInterval","glowElements","floor","complementaryHue","baseHue","applyGlow","element","glowContainer","shine","updateHues","documentElement","setProperty","String","rotateColors","newHue1","newHue2","startRotation","stopRotation","setInterval","clearInterval","removeGlow","SandboxController","timeLimit","DEFAULT_TIMEOUT_MS","defaultCode","getDefaultCode","logLevel","events","EventEmitter","sandbox","storage","themeSwitcher","editorSwitcher","fullscreenManager","libraryDialog","shareManager","neonGlow","resizeHandlers","responsiveListener","isInitialized","INIT_START","findElements","initializeComponents","INIT_COMPLETE","INIT_ERROR","showInitializationError","consoleContainer","errorDiv","editorContainer","getElementById","sandboxContainer","runBtn","clearBtn","resetBtn","togglePreview","previewWrap","limitLabel","toolbar","librariesBtn","clearConsoleBtn","shareBtn","missing","ConsoleOutput","SandboxEngine","onMessage","args","addLine","CONSOLE_MESSAGE","onStatusChange","updateStatus","initialize","EXAMPLE_LOAD","EXAMPLE_ERROR","editorControls","initializeResizer","setupResponsiveListener","rightPane","isPreviewVisible","contains","initializeNeonGlow","pane","cleanupResizeHandlers","handler","cleanup","isMobile","MOBILE_BREAKPOINT","initializeVerticalResize","mainContent","handle","gridTemplateColumns","gridTemplateRows","resizeHandle","panes","horizontalHandler","config","leftPane","onResize","isResizing","startX","startLeftWidth","handleStart","clientX","touches","getBoundingClientRect","width","userSelect","cursor","handleMove","deltaX","totalWidth","RESIZE_HANDLE_WIDTH","newLeftWidth","max","MIN_LEFT_PANE_WIDTH","min","MIN_RIGHT_PANE_WIDTH","newRightWidth","handleEnd","removeEventListener","createHorizontalResizeHandler","PANES_RESIZED","mediaQuery","removeListener","handleChange","matchMedia","addListener","verticalHandle","consoleEl","verticalHandler","topPane","bottomPane","shouldResize","startY","startTopHeight","startBottomHeight","clientY","topRect","bottomRect","height","deltaY","totalContentHeight","newTopHeight","MIN_CONSOLE_HEIGHT","MIN_PREVIEW_HEIGHT","newBottomHeight","createVerticalResizeHandler","PANES_RESIZED_VERTICAL","getEventEmitter","onChange","CODE_CHANGE","onExecute","run","loadInitialCode","EDITOR_READY","clearConsole","reset","checked","setupThemeEventListeners","setupEditorEventListeners","setupShareEventListeners","getValue","currentCode","newEditor","ACEEditor","__vitePreload","then","ace$1","autofocus","CodeMirrorEditor","import","n","l","TextareaEditor","textarea","setValue","EDITOR_CHANGED","initialCode","fromStorage","fromShare","sharedCode","savedCode","CODE_LOAD","CODE_EXECUTE_START","validateSyntax","CODE_VALIDATE","enterConsoleFullscreenOnMobile","libraryData","csp","execute","STATUS_MESSAGES","cleared","CONSOLE_CLEAR","SANDBOX_RESET","displayStatus","STATUS_CHANGE","CODE_EXECUTE_COMPLETE","CODE_EXECUTE_TIMEOUT","event","callback","once","off","getCode","setCode","validateCode","codeToValidate","EXAMPLE_LOADED","DESTROY","removeAllListeners","EditorAdapter","editorElement","cssText","edit","session","setMode","setOptions","fontSize","showPrintMargin","showGutter","highlightActiveLine","enableBasicAutocompletion","autocomplete","enableLiveAutocompletion","enableSnippets","wrap","tabSize","useSoftTabs","behavioursEnabled","wrapBehavioursEnabled","commands","addCommand","bindKey","win","mac","exec","triggerExecute","triggerChange","applyGlassEffect","onThemeChange","aceElement","backgroundColor","getComputedStyle","reducedOpacityColor","reduceColorOpacity","styleElement","head","color","opacity","rgbaMatch","r","g","b","rgbMatch","hexMatch","parseInt","applyTransformation","transformation","getCursorPosition","action","insert","cursorOffset","newCursor","moveCursorTo","row","column","positions","range","Range","start","end","spellcheck","placeholder","ctrlKey","metaKey","initSandbox","controller","createEditor","autoInit","catch","readyState"],"ignoreList":[],"sources":["../../src/core/storage.js","../../src/ui/examples.js","../../src/ui/examples-dropdown.js","../../src/ui/theme-switcher.js","../../src/ui/editor-switcher.js","../../src/ui/fullscreen.js","../../src/libraries/manager.js","../../src/ui/base-dialog.js","../../src/libraries/dialog.js","../../src/ui/share-manager.js","../../src/ui/neon.js","../../src/ui/controller.js","../../src/ui/resize-utils.js","../../src/editors/ace.js","../../src/editors/textarea.js","../../src/index.js"],"sourcesContent":["import { DEFAULT_STORAGE_KEY } from './constants.js';\r\nimport { Logger } from './logger.js';\r\n\r\n/**\r\n * Simple localStorage wrapper for persistent code storage\r\n * @author Joao Guilherme (Guinetik) <guinetik@gmail.com>\r\n */\r\nexport class Storage {\r\n  /**\r\n   * Creates a new Storage instance\r\n   * @param {string} [key] - The localStorage key to use\r\n   * @param {Object} [options={}] - Configuration options\r\n   * @param {boolean} [options.debug=false] - Enable debug logging\r\n   */\r\n  constructor(key = DEFAULT_STORAGE_KEY, options = {}) {\r\n    this.key = key;\r\n    this.logger = new Logger({\r\n      enabled: options.debug || false,\r\n      level: 'warn',\r\n      prefix: 'Storage'\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Saves code to localStorage\r\n   * @param {string} code - The code to save\r\n   * @returns {boolean} True if save was successful\r\n   */\r\n  save(code) {\r\n    try {\r\n      localStorage.setItem(this.key, code);\r\n      return true;\r\n    } catch (e) {\r\n      this.logger.warn('Failed to save code to localStorage:', e);\r\n      return false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Loads code from localStorage\r\n   * @returns {string|null} The saved code or null if not found\r\n   */\r\n  load() {\r\n    try {\r\n      return localStorage.getItem(this.key);\r\n    } catch (e) {\r\n      this.logger.warn('Failed to load code from localStorage:', e);\r\n      return null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clears the saved code\r\n   * @returns {boolean} True if clear was successful\r\n   */\r\n  clear() {\r\n    try {\r\n      localStorage.removeItem(this.key);\r\n      return true;\r\n    } catch (e) {\r\n      this.logger.warn('Failed to clear localStorage:', e);\r\n      return false;\r\n    }\r\n  }\r\n}\r\n","import { Logger } from '../core/logger.js';\r\nimport { fetchWithTimeout } from '../core/utils.js';\r\nimport { DEFAULT_EXAMPLES_PATH, NETWORK_TIMEOUT_MS } from '../core/constants.js';\r\n\r\n/**\r\n * Examples loader for the JavaScript sandbox\r\n * @author Joao Guilherme (Guinetik) <guinetik@gmail.com>\r\n */\r\nexport class ExamplesLoader {\r\n  /**\r\n   * Creates a new ExamplesLoader instance\r\n   * @param {Object} options - Configuration options\r\n   * @param {string} [options.examplesPath] - Path to examples directory\r\n   * @param {Function} [options.onLoad] - Callback when example is loaded\r\n   * @param {Function} [options.onError] - Callback when loading fails\r\n   * @param {boolean} [options.debug=false] - Enable debug logging\r\n   */\r\n  constructor(options = {}) {\r\n    this.examplesPath = options.examplesPath || DEFAULT_EXAMPLES_PATH;\r\n    this.onLoad = options.onLoad || (() => {});\r\n    this.onError = options.onError || (() => {});\r\n    this.examples = new Map();\r\n    \r\n    this.logger = new Logger({\r\n      enabled: options.debug || false,\r\n      level: 'info',\r\n      prefix: 'ExamplesLoader'\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Discovers available examples by attempting to load known files\r\n   * @returns {Promise<Array>} Array of example metadata\r\n   */\r\n  async discoverExamples() {\r\n    // Known examples - in a real app, this could come from an API or manifest\r\n    const knownExamples = [\r\n      {\r\n        id: 'hello-world',\r\n        title: '👋 Hello World',\r\n        description: 'Simple greeting with interactive button',\r\n        file: 'hello-world.js'\r\n      },\r\n      {\r\n        id: 'spinning-animation',\r\n        title: '🌀 CSS Animations',\r\n        description: 'Spinning box with rainbow colors and controls',\r\n        file: 'spinning-animation.js'\r\n      },\r\n      {\r\n        id: 'interactive-form',\r\n        title: '📝 Interactive Form',\r\n        description: 'Form validation and submission handling',\r\n        file: 'interactive-form.js'\r\n      },\r\n      {\r\n        id: 'canvas-drawing',\r\n        title: '🎨 Canvas Drawing',\r\n        description: 'Draw with mouse or touch on HTML5 canvas',\r\n        file: 'canvas-drawing.js'\r\n      },\r\n      {\r\n        id: 'jquery-basics',\r\n        title: '🔧 jQuery Basics',\r\n        description: 'Basic jQuery DOM manipulation and event handling',\r\n        file: 'jquery-basics.js'\r\n      },\r\n      {\r\n        id: 'jquery-demo',\r\n        title: '🎨 jQuery Demo',\r\n        description: 'Advanced jQuery features: animations, plugins, and effects',\r\n        file: 'jquery-demo.js'\r\n      },\r\n      {\r\n        id: 'jquery-ajax',\r\n        title: '🌐 jQuery AJAX',\r\n        description: 'jQuery AJAX calls, API integration, and data handling',\r\n        file: 'jquery-ajax.js'\r\n      }\r\n    ];\r\n\r\n    const availableExamples = [];\r\n\r\n    this.logger.info(`Discovering examples from: ${this.examplesPath}`);\r\n\r\n    // Test each example to see if it's available\r\n    for (const example of knownExamples) {\r\n      try {\r\n        const url = `${this.examplesPath}/${example.file}`;\r\n        this.logger.debug(`Fetching example: ${url}`);\r\n        \r\n        const response = await fetchWithTimeout(\r\n          url,\r\n          {},\r\n          NETWORK_TIMEOUT_MS\r\n        );\r\n        \r\n        if (response.ok) {\r\n          const code = await response.text();\r\n          this.examples.set(example.id, { ...example, code });\r\n          availableExamples.push(example);\r\n          this.logger.debug(`✓ Example loaded: ${example.id}`);\r\n        } else {\r\n          this.logger.warn(`✗ Example ${example.id} returned ${response.status}`);\r\n        }\r\n      } catch (error) {\r\n        this.logger.warn(`✗ Example ${example.id} failed:`, error.message);\r\n      }\r\n    }\r\n\r\n    this.logger.info(`Discovered ${availableExamples.length} of ${knownExamples.length} examples`);\r\n    return availableExamples;\r\n  }\r\n\r\n  /**\r\n   * Loads an example by ID\r\n   * @param {string} exampleId - The example ID to load\r\n   * @returns {Promise<Object>} Example data with code\r\n   */\r\n  async loadExample(exampleId) {\r\n    if (this.examples.has(exampleId)) {\r\n      const example = this.examples.get(exampleId);\r\n      this.onLoad(example);\r\n      return example;\r\n    }\r\n\r\n    // Try to load if not cached\r\n    try {\r\n      await this.discoverExamples();\r\n      const example = this.examples.get(exampleId);\r\n\r\n      if (example) {\r\n        this.onLoad(example);\r\n        return example;\r\n      } else {\r\n        throw new Error(`Example '${exampleId}' not found`);\r\n      }\r\n    } catch (error) {\r\n      this.logger.error('Failed to load example:', error);\r\n      this.onError(error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Gets all available examples\r\n   * @returns {Array} Array of cached examples\r\n   */\r\n  getAvailableExamples() {\r\n    return Array.from(this.examples.values());\r\n  }\r\n\r\n  /**\r\n   * Clears the examples cache\r\n   */\r\n  clearCache() {\r\n    this.logger.debug('Clearing examples cache');\r\n    this.examples.clear();\r\n  }\r\n\r\n  /**\r\n   * Cleans up the examples loader\r\n   */\r\n  destroy() {\r\n    this.logger.debug('Destroying examples loader');\r\n    this.clearCache();\r\n  }\r\n}\r\n","/**\r\n * Examples dropdown UI component\r\n * @author Joao Guilherme (Guinetik) <guinetik@gmail.com>\r\n */\r\nexport class ExamplesDropdown {\r\n  /**\r\n   * Creates a new ExamplesDropdown instance\r\n   * @param {HTMLElement} container - The container element for the dropdown\r\n   * @param {Object} options - Configuration options\r\n   * @param {Function} [options.onSelect] - Callback when example is selected\r\n   */\r\n  constructor(container, options = {}) {\r\n    this.container = container;\r\n    this.onSelect = options.onSelect || (() => {});\r\n    this.examples = [];\r\n\r\n    this.createDropdown();\r\n  }\r\n\r\n  /**\r\n   * Creates the dropdown HTML structure\r\n   */\r\n  createDropdown() {\r\n    // Check if dropdown already exists in container\r\n    const existingDropdown = this.container.querySelector('.examples-dropdown');\r\n    if (existingDropdown) {\r\n      existingDropdown.remove();\r\n    }\r\n\r\n    this.dropdown = document.createElement('select');\r\n    this.dropdown.className = 'examples-dropdown';\r\n    this.dropdown.innerHTML = '<option value=\"\">📚 Load Example...</option>';\r\n\r\n    this.dropdown.addEventListener('change', (e) => {\r\n      const exampleId = e.target.value;\r\n      if (exampleId) {\r\n        this.onSelect(exampleId);\r\n        // Reset to placeholder after selection\r\n        setTimeout(() => {\r\n          this.dropdown.value = '';\r\n        }, 100);\r\n      }\r\n    });\r\n\r\n    // Insert after the preview button (make examples last in toolbar)\r\n    const previewLabel = this.container.querySelector('label.btn');\r\n    if (previewLabel) {\r\n      this.container.insertBefore(this.dropdown, previewLabel.nextSibling);\r\n    } else {\r\n      this.container.appendChild(this.dropdown);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Populates the dropdown with examples\r\n   * @param {Array} examples - Array of example objects\r\n   */\r\n  setExamples(examples) {\r\n    this.examples = examples;\r\n\r\n    // Reset to normal placeholder first\r\n    this.dropdown.innerHTML = '<option value=\"\">📚 Load Example...</option>';\r\n\r\n    // Add example options\r\n    examples.forEach(example => {\r\n      const option = document.createElement('option');\r\n      option.value = example.id;\r\n      option.textContent = example.title;\r\n      option.title = example.description; // Tooltip\r\n      this.dropdown.appendChild(option);\r\n    });\r\n\r\n    // Enable dropdown if we have examples\r\n    this.dropdown.disabled = examples.length === 0;\r\n  }\r\n\r\n  /**\r\n   * Shows loading state\r\n   */\r\n  setLoading(loading = true) {\r\n    if (loading) {\r\n      this.dropdown.innerHTML = '<option value=\"\">⏳ Loading examples...</option>';\r\n      this.dropdown.disabled = true;\r\n    } else {\r\n      this.dropdown.innerHTML = '<option value=\"\">📚 Load Example...</option>';\r\n      this.dropdown.disabled = false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Shows error state\r\n   * @param {string} message - Error message to display\r\n   */\r\n  setError(message = 'Failed to load examples') {\r\n    this.dropdown.innerHTML = `<option value=\"\">❌ ${message}</option>`;\r\n    this.dropdown.disabled = true;\r\n  }\r\n\r\n  /**\r\n   * Destroys the dropdown\r\n   */\r\n  destroy() {\r\n    if (this.dropdown && this.dropdown.parentNode) {\r\n      this.dropdown.parentNode.removeChild(this.dropdown);\r\n    }\r\n  }\r\n}","import { Logger } from '../core/logger.js';\r\nimport { EVENTS, EDITOR_THEMES } from '../core/constants.js';\r\n\r\n/**\r\n * Theme switcher UI component\r\n * @author Joao Guilherme (Guinetik) <guinetik@gmail.com>\r\n */\r\nexport class ThemeSwitcher {\r\n\r\n  /**\r\n   * Creates a new ThemeSwitcher instance\r\n   * @param {HTMLElement} container - The container element for the dropdown\r\n   * @param {Object} eventEmitter - The event emitter instance\r\n   * @param {Object} options - Configuration options\r\n   * @param {string} [options.defaultTheme='darcula'] - Default theme name\r\n   * @param {boolean} [options.debug=true] - Enable debug logging\r\n   */\r\n  constructor(container, eventEmitter, options = {}) {\r\n    this.container = container;\r\n    this.eventEmitter = eventEmitter;\r\n    this.options = {\r\n      defaultTheme: 'monokai',\r\n      debug: true,\r\n      storageKey: 'sandbox_current_theme',\r\n      ...options\r\n    };\r\n\r\n    this.logger = new Logger({\r\n      enabled: this.options.debug,\r\n      level: 'info',\r\n      prefix: 'ThemeSwitcher'\r\n    });\r\n\r\n    // Check for saved editor preference to initialize with correct themes\r\n    const savedEditor = localStorage.getItem('sandbox_current_editor') || 'ace';\r\n    this.logger.info('Initializing theme switcher with saved editor:', savedEditor);\r\n    \r\n    // Initialize with themes for the saved editor\r\n    this.themes = ThemeSwitcher.getThemesForEditor(savedEditor);\r\n\r\n    // Load saved theme or use default (now that themes array exists)\r\n    this.currentTheme = this.loadSavedTheme() || this.options.defaultTheme;\r\n    this.logger.info('Initializing theme switcher with theme:', this.currentTheme);\r\n\r\n    this.createDropdown();\r\n\r\n    // Load CSS for the current theme on startup and emit events\r\n    this.initializeCurrentTheme();\r\n\r\n    // Listen for editor changes to refresh theme list\r\n    this.setupEditorChangeListener();\r\n  }\r\n\r\n  /**\r\n   * Sets up listener for editor changes\r\n   */\r\n  setupEditorChangeListener() {\r\n    if (this.eventEmitter) {\r\n      this.eventEmitter.on(EVENTS.EDITOR_CHANGE, async (data) => {\r\n        this.logger.info('Editor changed, refreshing theme list:', data);\r\n        await this.refreshThemesForEditor(data.editor);\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Gets themes for a specific editor\r\n   * @param {string} editorName - The editor name\r\n   * @returns {Array} Array of theme objects\r\n   */\r\n  static getThemesForEditor(editorName) {\r\n    switch (editorName) {\r\n      case 'ace':\r\n        return EDITOR_THEMES.ACE;\r\n      case 'codemirror':\r\n        return EDITOR_THEMES.CODEMIRROR;\r\n      case 'textarea':\r\n        return EDITOR_THEMES.TEXTAREA;\r\n      default:\r\n        return EDITOR_THEMES.ACE; // Default fallback\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Refreshes themes based on the current editor\r\n   * @param {string} editorName - The current editor name\r\n   */\r\n  async refreshThemesForEditor(editorName) {\r\n    this.logger.info('Refreshing themes for editor:', editorName);\r\n    \r\n    // Update themes based on editor using constants\r\n    this.themes = ThemeSwitcher.getThemesForEditor(editorName);\r\n\r\n    // Repopulate dropdown\r\n    this.populateThemes();\r\n    \r\n    // If current theme is not available in new editor, switch to first available\r\n    if (!this.themes.find(t => t.value === this.currentTheme)) {\r\n      const newTheme = this.themes[0].value;\r\n      this.logger.info('Current theme not available in new editor, switching to:', newTheme);\r\n      await this.switchTheme(newTheme);\r\n    } else {\r\n      // Restore current selection and re-apply the theme\r\n      this.dropdown.value = this.currentTheme;\r\n      this.logger.info('Re-applying current theme for new editor:', this.currentTheme);\r\n      await this.switchTheme(this.currentTheme);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Initializes the current theme by loading its CSS and emitting events\r\n   */\r\n  async initializeCurrentTheme() {\r\n    this.logger.info('Initializing current theme:', this.currentTheme);\r\n\r\n    // Emit that theme loading started\r\n    this.eventEmitter.emit(EVENTS.THEME_LOAD_START, {\r\n      theme: this.currentTheme\r\n    });\r\n\r\n    try {\r\n      await this.loadThemeCSS(this.currentTheme);\r\n      this.logger.info('Current theme CSS loaded:', this.currentTheme);\r\n\r\n      // Emit that theme is ready for use\r\n      this.eventEmitter.emit(EVENTS.THEME_READY, {\r\n        theme: this.currentTheme\r\n      });\r\n    } catch (error) {\r\n      this.logger.warn('Failed to load current theme CSS:', error);\r\n\r\n      // Emit error but fallback to default\r\n      this.eventEmitter.emit(EVENTS.THEME_READY, {\r\n        theme: 'darcula', // fallback\r\n        error: error.message\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Creates the theme switcher dropdown HTML structure\r\n   */\r\n  createDropdown() {\r\n    // Check if dropdown already exists in container\r\n    const existingDropdown = this.container.querySelector('.theme-switcher');\r\n    if (existingDropdown) {\r\n      existingDropdown.remove();\r\n    }\r\n\r\n    this.dropdown = document.createElement('select');\r\n    this.dropdown.className = 'theme-switcher examples-dropdown'; // Reuse examples dropdown styling\r\n    this.dropdown.title = 'Switch editor theme';\r\n\r\n    // Add theme options\r\n    this.populateThemes();\r\n\r\n    // Set default theme\r\n    this.dropdown.value = this.currentTheme;\r\n\r\n    this.dropdown.addEventListener('change', async (e) => {\r\n      const themeValue = e.target.value;\r\n      this.logger.info('Theme dropdown changed to:', themeValue);\r\n      this.logger.info('Current theme is:', this.currentTheme);\r\n\r\n      if (themeValue && themeValue !== this.currentTheme) {\r\n        this.logger.info('Switching theme from', this.currentTheme, 'to', themeValue);\r\n        await this.switchTheme(themeValue);\r\n      } else {\r\n        this.logger.warn('Theme value is empty or same as current theme');\r\n      }\r\n    });\r\n\r\n    // Insert after the examples dropdown if it exists, otherwise after preview button\r\n    const examplesDropdown = this.container.querySelector('.examples-dropdown');\r\n    const previewLabel = this.container.querySelector('label.btn');\r\n\r\n    if (examplesDropdown) {\r\n      this.container.insertBefore(this.dropdown, examplesDropdown.nextSibling);\r\n    } else if (previewLabel) {\r\n      this.container.insertBefore(this.dropdown, previewLabel.nextSibling);\r\n    } else {\r\n      this.container.appendChild(this.dropdown);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Populates the dropdown with available themes\r\n   */\r\n  populateThemes() {\r\n    // Clear existing options\r\n    this.dropdown.innerHTML = '';\r\n\r\n    // Add theme options\r\n    this.themes.forEach(theme => {\r\n      const option = document.createElement('option');\r\n      option.value = theme.value;\r\n      option.textContent = theme.label;\r\n      this.dropdown.appendChild(option);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Loads an ACE theme - themes are already loaded via CDN scripts\r\n   * @param {string} themeName - The theme name to load\r\n   * @returns {Promise<void>} Promise that resolves when theme is loaded\r\n   */\r\n  async loadThemeCSS(themeName) {\r\n    // ACE themes are loaded via script tags in HTML, so we just need to verify they're available\r\n    this.logger.info('ACE theme loading for:', themeName);\r\n    \r\n    // Check if ACE is available\r\n    if (typeof ace === 'undefined') {\r\n      throw new Error('ACE editor not loaded');\r\n    }\r\n\r\n    // Check if the theme is available in ACE\r\n    try {\r\n      // Try to access the theme to see if it's loaded\r\n      const themePath = `ace/theme/${themeName}`;\r\n      if (ace.require && ace.require(themePath)) {\r\n        this.logger.info('ACE theme is available:', themeName);\r\n        return;\r\n      }\r\n    } catch (error) {\r\n      this.logger.warn('ACE theme may not be loaded:', themeName, error);\r\n    }\r\n\r\n    // For now, we'll assume themes are loaded via CDN scripts\r\n    // In a production app, you might want to dynamically load theme scripts\r\n    this.logger.info('Assuming ACE theme is available:', themeName);\r\n    return Promise.resolve();\r\n  }\r\n\r\n  /**\r\n   * Loads saved theme from localStorage\r\n   * @returns {string|null} Saved theme name or null if not found\r\n   */\r\n  loadSavedTheme() {\r\n    try {\r\n      const savedTheme = localStorage.getItem(this.options.storageKey);\r\n      if (savedTheme && this.themes.find(t => t.value === savedTheme)) {\r\n        this.logger.info('Loaded saved theme from storage:', savedTheme);\r\n        return savedTheme;\r\n      }\r\n    } catch (error) {\r\n      this.logger.warn('Failed to load saved theme:', error);\r\n    }\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Saves current theme to localStorage\r\n   * @param {string} themeName - Theme name to save\r\n   */\r\n  saveTheme(themeName) {\r\n    try {\r\n      localStorage.setItem(this.options.storageKey, themeName);\r\n      this.logger.info('Saved theme to storage:', themeName);\r\n    } catch (error) {\r\n      this.logger.warn('Failed to save theme:', error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Switches to a new theme\r\n   * @param {string} themeName - The theme name to switch to\r\n   */\r\n  async switchTheme(themeName) {\r\n    const oldTheme = this.currentTheme;\r\n    this.currentTheme = themeName;\r\n\r\n    this.logger.info('switchTheme called: changing from', oldTheme, 'to', themeName);\r\n\r\n    // Update dropdown value\r\n    this.dropdown.value = themeName;\r\n    this.logger.info('Dropdown value updated to:', this.dropdown.value);\r\n\r\n    try {\r\n      // Load theme CSS first\r\n      await this.loadThemeCSS(themeName);\r\n\r\n      // Save theme for persistence\r\n      this.saveTheme(themeName);\r\n\r\n      // Emit theme change event for editor adapters to listen to\r\n      this.logger.info('Emitting theme change event with data:', { theme: themeName, oldTheme: oldTheme });\r\n      this.eventEmitter.emit(EVENTS.THEME_CHANGE, {\r\n        theme: themeName,\r\n        oldTheme: oldTheme\r\n      });\r\n      this.logger.info('Theme change event emitted successfully');\r\n    } catch (error) {\r\n      this.logger.error('Failed to switch theme:', error);\r\n      // Revert dropdown to old theme\r\n      this.dropdown.value = oldTheme;\r\n      this.currentTheme = oldTheme;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Gets the current theme\r\n   * @returns {string} Current theme name\r\n   */\r\n  getCurrentTheme() {\r\n    return this.currentTheme;\r\n  }\r\n\r\n  /**\r\n   * Sets the current theme programmatically\r\n   * @param {string} themeName - The theme name to set\r\n   */\r\n  setTheme(themeName) {\r\n    if (this.themes.find(t => t.value === themeName)) {\r\n      this.switchTheme(themeName);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Adds a new theme to the list\r\n   * @param {string} value - Theme value/name\r\n   * @param {string} label - Display label for the theme\r\n   */\r\n  addTheme(value, label) {\r\n    // Check if theme already exists\r\n    if (!this.themes.find(t => t.value === value)) {\r\n      this.themes.push({ value, label });\r\n      this.populateThemes();\r\n      this.dropdown.value = this.currentTheme; // Restore selection\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Destroys the theme switcher\r\n   */\r\n  destroy() {\r\n    if (this.dropdown && this.dropdown.parentNode) {\r\n      this.dropdown.parentNode.removeChild(this.dropdown);\r\n    }\r\n  }\r\n}","import { Logger } from '../core/logger.js';\r\nimport { EVENTS } from '../core/constants.js';\r\n\r\n/**\r\n * Editor switcher UI component\r\n * @author Joao Guilherme (Guinetik) <guinetik@gmail.com>\r\n */\r\nexport class EditorSwitcher {\r\n  /**\r\n   * Creates a new EditorSwitcher instance\r\n   * @param {HTMLElement} container - The container element for the dropdown\r\n   * @param {Object} eventEmitter - The event emitter instance\r\n   * @param {Object} options - Configuration options\r\n   * @param {string} [options.defaultEditor='ace'] - Default editor name\r\n   * @param {boolean} [options.debug=true] - Enable debug logging\r\n   */\r\n  constructor(container, eventEmitter, options = {}) {\r\n    this.container = container;\r\n    this.eventEmitter = eventEmitter;\r\n    this.options = {\r\n      defaultEditor: 'ace',\r\n      debug: true,\r\n      storageKey: 'sandbox_current_editor',\r\n      ...options\r\n    };\r\n\r\n    this.logger = new Logger({\r\n      enabled: this.options.debug,\r\n      level: 'info',\r\n      prefix: 'EditorSwitcher'\r\n    });\r\n\r\n    // Define available editors\r\n    this.editors = [\r\n      { value: 'ace', label: '🎯 ACE Editor', available: () => typeof ace !== 'undefined' },\r\n      { value: 'codemirror', label: '📝 CodeMirror', available: () => typeof CodeMirror !== 'undefined' },\r\n      { value: 'textarea', label: '📄 Textarea', available: () => true } // Always available\r\n    ];\r\n\r\n    // Load saved editor or use default\r\n    this.currentEditor = this.loadSavedEditor() || this.options.defaultEditor;\r\n    this.logger.info('Initializing editor switcher with editor:', this.currentEditor);\r\n\r\n    this.createDropdown();\r\n  }\r\n\r\n  /**\r\n   * Creates the editor switcher dropdown HTML structure\r\n   */\r\n  createDropdown() {\r\n    // Check if dropdown already exists in container\r\n    const existingDropdown = this.container.querySelector('.editor-switcher');\r\n    if (existingDropdown) {\r\n      existingDropdown.remove();\r\n    }\r\n\r\n    this.dropdown = document.createElement('select');\r\n    this.dropdown.className = 'editor-switcher examples-dropdown'; // Reuse examples dropdown styling\r\n    this.dropdown.title = 'Switch editor (ACE, CodeMirror, Textarea)';\r\n\r\n    // Add editor options\r\n    this.populateEditors();\r\n\r\n    // Set current editor\r\n    this.dropdown.value = this.currentEditor;\r\n\r\n    this.dropdown.addEventListener('change', async (e) => {\r\n      const editorValue = e.target.value;\r\n      this.logger.info('Editor dropdown changed to:', editorValue);\r\n      this.logger.info('Current editor is:', this.currentEditor);\r\n\r\n      if (editorValue && editorValue !== this.currentEditor) {\r\n        this.logger.info('Switching editor from', this.currentEditor, 'to', editorValue);\r\n        await this.switchEditor(editorValue);\r\n      } else {\r\n        this.logger.warn('Editor value is empty or same as current editor');\r\n      }\r\n    });\r\n\r\n    // Insert into the editor controls container\r\n    this.container.appendChild(this.dropdown);\r\n  }\r\n\r\n  /**\r\n   * Populates the dropdown with available editors\r\n   */\r\n  populateEditors() {\r\n    // Clear existing options\r\n    this.dropdown.innerHTML = '';\r\n\r\n    // Add editor options, filtering by availability\r\n    this.editors.forEach(editor => {\r\n      if (editor.available()) {\r\n        const option = document.createElement('option');\r\n        option.value = editor.value;\r\n        option.textContent = editor.label;\r\n        this.dropdown.appendChild(option);\r\n      } else {\r\n        this.logger.debug('Editor not available:', editor.value);\r\n      }\r\n    });\r\n\r\n    // If current editor is not available, fallback to first available\r\n    const availableEditors = this.editors.filter(e => e.available());\r\n    if (availableEditors.length > 0 && !this.editors.find(e => e.value === this.currentEditor)?.available()) {\r\n      this.logger.warn('Current editor not available, falling back to:', availableEditors[0].value);\r\n      this.currentEditor = availableEditors[0].value;\r\n      this.dropdown.value = this.currentEditor;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Loads saved editor from localStorage\r\n   * @returns {string|null} Saved editor name or null if not found\r\n   */\r\n  loadSavedEditor() {\r\n    try {\r\n      const savedEditor = localStorage.getItem(this.options.storageKey);\r\n      if (savedEditor && this.editors.find(e => e.value === savedEditor && e.available())) {\r\n        this.logger.info('Loaded saved editor from storage:', savedEditor);\r\n        return savedEditor;\r\n      }\r\n    } catch (error) {\r\n      this.logger.warn('Failed to load saved editor:', error);\r\n    }\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Saves current editor to localStorage\r\n   * @param {string} editorName - Editor name to save\r\n   */\r\n  saveEditor(editorName) {\r\n    try {\r\n      localStorage.setItem(this.options.storageKey, editorName);\r\n      this.logger.info('Saved editor to storage:', editorName);\r\n    } catch (error) {\r\n      this.logger.warn('Failed to save editor:', error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Switches to a new editor\r\n   * @param {string} editorName - The editor name to switch to\r\n   */\r\n  async switchEditor(editorName) {\r\n    const oldEditor = this.currentEditor;\r\n    this.currentEditor = editorName;\r\n\r\n    this.logger.info('switchEditor called: changing from', oldEditor, 'to', editorName);\r\n\r\n    // Update dropdown value\r\n    this.dropdown.value = editorName;\r\n    this.logger.info('Dropdown value updated to:', this.dropdown.value);\r\n\r\n    try {\r\n      // Save editor for persistence\r\n      this.saveEditor(editorName);\r\n\r\n      // Emit editor change event for controller to listen to\r\n      this.logger.info('Emitting editor change event with data:', { editor: editorName, oldEditor: oldEditor });\r\n      this.eventEmitter.emit(EVENTS.EDITOR_CHANGE, {\r\n        editor: editorName,\r\n        oldEditor: oldEditor\r\n      });\r\n      this.logger.info('Editor change event emitted successfully');\r\n    } catch (error) {\r\n      this.logger.error('Failed to switch editor:', error);\r\n      // Revert dropdown to old editor\r\n      this.dropdown.value = oldEditor;\r\n      this.currentEditor = oldEditor;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Gets the current editor\r\n   * @returns {string} Current editor name\r\n   */\r\n  getCurrentEditor() {\r\n    return this.currentEditor;\r\n  }\r\n\r\n  /**\r\n   * Sets the current editor programmatically\r\n   * @param {string} editorName - The editor name to set\r\n   */\r\n  setEditor(editorName) {\r\n    if (this.editors.find(e => e.value === editorName && e.available())) {\r\n      this.switchEditor(editorName);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Refreshes the editor list (useful when new editors become available)\r\n   */\r\n  refreshEditors() {\r\n    this.logger.info('Refreshing editor list');\r\n    this.populateEditors();\r\n    this.dropdown.value = this.currentEditor;\r\n  }\r\n\r\n  /**\r\n   * Destroys the editor switcher\r\n   */\r\n  destroy() {\r\n    if (this.dropdown && this.dropdown.parentNode) {\r\n      this.dropdown.parentNode.removeChild(this.dropdown);\r\n    }\r\n  }\r\n}\r\n","import { Logger } from '../core/logger.js';\r\nimport { EVENTS } from '../core/constants.js';\r\n\r\n/**\r\n * Fullscreen manager for toggling between editor and console views\r\n * @author Joao Guilherme (Guinetik) <guinetik@gmail.com>\r\n */\r\nexport class FullscreenManager {\r\n  /**\r\n   * Creates a new FullscreenManager instance\r\n   * @param {Object} eventEmitter - Event emitter instance\r\n   * @param {Object} options - Configuration options\r\n   * @param {boolean} [options.debug=false] - Enable debug logging\r\n   */\r\n  constructor(eventEmitter, options = {}) {\r\n    this.eventEmitter = eventEmitter;\r\n    this.options = {\r\n      debug: false,\r\n      ...options\r\n    };\r\n\r\n    this.logger = new Logger({\r\n      enabled: this.options.debug,\r\n      level: 'info',\r\n      prefix: 'FullscreenManager'\r\n    });\r\n\r\n    this.currentMode = null; // null, 'editor', 'console'\r\n    this.appElement = null;\r\n    this.elements = {};\r\n    this.isChanging = false; // Recursion guard\r\n\r\n    this.setupEventListeners();\r\n  }\r\n\r\n  /**\r\n   * Initializes the fullscreen manager with DOM elements\r\n   * @param {Object} elements - DOM elements\r\n   * @param {HTMLElement} elements.app - Main app container\r\n   * @param {HTMLElement} elements.fullscreenEditor - Editor fullscreen button\r\n   * @param {HTMLElement} elements.fullscreenConsole - Console fullscreen button\r\n   */\r\n  init(elements) {\r\n    this.appElement = elements.app;\r\n    this.elements = elements;\r\n\r\n    this.logger.info('Fullscreen manager initialized');\r\n\r\n    // Add click listeners to fullscreen buttons\r\n    if (this.elements.fullscreenEditor) {\r\n      this.elements.fullscreenEditor.addEventListener('click', () => {\r\n        this.toggleFullscreen('editor');\r\n      });\r\n    }\r\n\r\n    if (this.elements.fullscreenConsole) {\r\n      this.elements.fullscreenConsole.addEventListener('click', () => {\r\n        this.toggleFullscreen('console');\r\n      });\r\n    }\r\n\r\n    // Add keyboard shortcut (F11 or Escape)\r\n    document.addEventListener('keydown', (e) => {\r\n      if (e.key === 'F11') {\r\n        e.preventDefault();\r\n        this.toggleFullscreen();\r\n      } else if (e.key === 'Escape' && this.currentMode) {\r\n        this.exitFullscreen();\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Sets up event listeners for fullscreen events\r\n   */\r\n  setupEventListeners() {\r\n    this.eventEmitter.on(EVENTS.FULLSCREEN_TOGGLE, (mode) => {\r\n      this.toggleFullscreen(mode);\r\n    });\r\n\r\n    this.eventEmitter.on(EVENTS.FULLSCREEN_EXIT, () => {\r\n      this.exitFullscreen();\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Toggles fullscreen mode for specified pane\r\n   * @param {string} [mode] - 'editor', 'console', or null to cycle\r\n   */\r\n  toggleFullscreen(mode) {\r\n    if (!this.appElement) {\r\n      this.logger.warn('App element not initialized');\r\n      return;\r\n    }\r\n\r\n    // If no mode specified, cycle through modes\r\n    if (!mode) {\r\n      if (this.currentMode === null) {\r\n        mode = 'editor';\r\n      } else if (this.currentMode === 'editor') {\r\n        mode = 'console';\r\n      } else {\r\n        mode = null; // exit fullscreen\r\n      }\r\n    }\r\n\r\n    // If same mode is clicked, exit fullscreen\r\n    if (mode === this.currentMode) {\r\n      mode = null;\r\n    }\r\n\r\n    this.setFullscreenMode(mode);\r\n  }\r\n\r\n  /**\r\n   * Sets the fullscreen mode\r\n   * @param {string|null} mode - 'editor', 'console', or null for normal view\r\n   */\r\n  setFullscreenMode(mode) {\r\n    if (!this.appElement) return;\r\n\r\n    // Prevent recursion: if we're already changing or in the target mode, don't do anything\r\n    if (this.isChanging || mode === this.currentMode) return;\r\n\r\n    this.isChanging = true;\r\n    const previousMode = this.currentMode;\r\n\r\n    try {\r\n      // Remove all fullscreen classes\r\n      this.appElement.classList.remove('fullscreen-editor', 'fullscreen-console');\r\n\r\n      // Update button states\r\n      this.updateButtonStates(null);\r\n\r\n      if (mode) {\r\n        // Add appropriate fullscreen class\r\n        this.appElement.classList.add(`fullscreen-${mode}`);\r\n        this.updateButtonStates(mode);\r\n\r\n        this.logger.info(`Entering fullscreen mode: ${mode}`);\r\n        this.eventEmitter.emit(`FULLSCREEN_${mode.toUpperCase()}`, { mode });\r\n      } else if (previousMode) {\r\n        // Only emit exit event if we were actually in fullscreen before\r\n        this.logger.info('Exiting fullscreen mode');\r\n        this.eventEmitter.emit(EVENTS.FULLSCREEN_EXIT, { previousMode });\r\n      }\r\n\r\n      this.currentMode = mode;\r\n    } finally {\r\n      // Always clear the changing flag\r\n      this.isChanging = false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Updates button states based on current mode\r\n   * @param {string|null} activeMode - Current active mode\r\n   */\r\n  updateButtonStates(activeMode) {\r\n    // Update editor button\r\n    if (this.elements.fullscreenEditor) {\r\n      if (activeMode === 'editor') {\r\n        this.elements.fullscreenEditor.textContent = '◱'; // Exit symbol\r\n        this.elements.fullscreenEditor.title = 'Exit Fullscreen';\r\n      } else {\r\n        this.elements.fullscreenEditor.textContent = '⛶'; // Fullscreen symbol\r\n        this.elements.fullscreenEditor.title = 'Fullscreen Editor';\r\n      }\r\n    }\r\n\r\n    // Update console button\r\n    if (this.elements.fullscreenConsole) {\r\n      if (activeMode === 'console') {\r\n        this.elements.fullscreenConsole.textContent = '◱'; // Exit symbol\r\n        this.elements.fullscreenConsole.title = 'Exit Fullscreen';\r\n      } else {\r\n        this.elements.fullscreenConsole.textContent = '⛶'; // Fullscreen symbol\r\n        this.elements.fullscreenConsole.title = 'Fullscreen Console';\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Exits fullscreen mode\r\n   */\r\n  exitFullscreen() {\r\n    this.setFullscreenMode(null);\r\n  }\r\n\r\n  /**\r\n   * Gets the current fullscreen mode\r\n   * @returns {string|null} Current mode or null\r\n   */\r\n  getCurrentMode() {\r\n    return this.currentMode;\r\n  }\r\n\r\n  /**\r\n   * Checks if currently in fullscreen\r\n   * @returns {boolean} True if in fullscreen mode\r\n   */\r\n  isFullscreen() {\r\n    return this.currentMode !== null;\r\n  }\r\n\r\n  /**\r\n   * Destroys the fullscreen manager\r\n   */\r\n  destroy() {\r\n    this.exitFullscreen();\r\n    this.logger.info('Fullscreen manager destroyed');\r\n  }\r\n}","import { Logger } from '../core/logger.js';\r\nimport { EVENTS } from '../core/constants.js';\r\n\r\n/**\r\n * Library Manager - Handles CDN library loading with user-controlled allowlists\r\n * @author Joao Guilherme (Guinetik) <guinetik@gmail.com>\r\n */\r\nexport class LibraryManager {\r\n  /**\r\n   * Creates a new LibraryManager instance\r\n   * @param {Object} eventEmitter - Event emitter instance\r\n   * @param {Object} options - Configuration options\r\n   * @param {boolean} [options.debug=false] - Enable debug logging\r\n   * @param {string} [options.storageKey='sandbox_libraries'] - localStorage key\r\n   */\r\n  constructor(eventEmitter, options = {}) {\r\n    this.eventEmitter = eventEmitter;\r\n    this.options = {\r\n      debug: false,\r\n      storageKey: 'sandbox_libraries',\r\n      allowlistKey: 'sandbox_allowed_domains',\r\n      ...options\r\n    };\r\n\r\n    this.logger = new Logger({\r\n      enabled: this.options.debug,\r\n      level: 'info',\r\n      prefix: 'LibraryManager'\r\n    });\r\n\r\n    // Force a log message to test if logging is working\r\n    console.log('🔧 LibraryManager created with debug:', this.options.debug);\r\n\r\n    // Default trusted CDN domains\r\n    this.defaultDomains = [\r\n      'cdnjs.cloudflare.com',\r\n      'unpkg.com',\r\n      'jsdelivr.net',\r\n      'code.jquery.com',\r\n      'stackpath.bootstrapcdn.com'\r\n    ];\r\n\r\n    this.libraries = [];\r\n    this.allowedDomains = [];\r\n    this.libraryCache = new Map(); // Cache for fetched library content\r\n\r\n    this.loadFromStorage();\r\n    this.setupEventListeners();\r\n  }\r\n\r\n  /**\r\n   * Sets up event listeners for library management\r\n   */\r\n  setupEventListeners() {\r\n    this.eventEmitter.on(EVENTS.LIBRARY_ADD, (data) => {\r\n      this.addLibrary(data.url, data.name);\r\n    });\r\n\r\n    this.eventEmitter.on(EVENTS.LIBRARY_REMOVE, (data) => {\r\n      this.removeLibrary(data.id);\r\n    });\r\n\r\n    this.eventEmitter.on(EVENTS.DOMAIN_TRUST_REQUEST, (data) => {\r\n      this.addDomain(data.domain);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Loads libraries and allowed domains from localStorage\r\n   */\r\n  loadFromStorage() {\r\n    this.logger.debug('Loading library data from localStorage...');\r\n\r\n    try {\r\n      // Load libraries\r\n      this.logger.debug(`Checking localStorage for key: ${this.options.storageKey}`);\r\n      const librariesData = localStorage.getItem(this.options.storageKey);\r\n      this.libraries = librariesData ? JSON.parse(librariesData) : [];\r\n      this.logger.debug(`Loaded ${this.libraries.length} libraries from storage`);\r\n\r\n      // Load allowed domains (merge with defaults)\r\n      this.logger.debug(`Checking localStorage for key: ${this.options.allowlistKey}`);\r\n      const domainsData = localStorage.getItem(this.options.allowlistKey);\r\n      const savedDomains = domainsData ? JSON.parse(domainsData) : [];\r\n      this.allowedDomains = [...new Set([...this.defaultDomains, ...savedDomains])];\r\n\r\n      this.logger.debug(`Merged domains - defaults: ${this.defaultDomains.length}, saved: ${savedDomains.length}, total: ${this.allowedDomains.length}`);\r\n      this.logger.info(`Storage load complete: ${this.libraries.length} libraries, ${this.allowedDomains.length} allowed domains`);\r\n\r\n      // Log library names for debugging\r\n      if (this.libraries.length > 0) {\r\n        this.logger.debug('Loaded libraries:', this.libraries.map(lib => lib.name).join(', '));\r\n      }\r\n    } catch (error) {\r\n      this.logger.error('Failed to load from storage:', error);\r\n      this.logger.warn('Falling back to empty state with default domains');\r\n      this.libraries = [];\r\n      this.allowedDomains = [...this.defaultDomains];\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Saves libraries to localStorage\r\n   */\r\n  saveLibraries() {\r\n    this.logger.debug(`Saving ${this.libraries.length} libraries to localStorage...`);\r\n    try {\r\n      const serialized = JSON.stringify(this.libraries);\r\n      localStorage.setItem(this.options.storageKey, serialized);\r\n      this.logger.debug(`Libraries saved successfully (${serialized.length} chars)`);\r\n    } catch (error) {\r\n      this.logger.error('Failed to save libraries to localStorage:', error);\r\n      if (error.name === 'QuotaExceededError') {\r\n        this.logger.warn('localStorage quota exceeded - consider clearing old data');\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Saves allowed domains to localStorage\r\n   */\r\n  saveDomains() {\r\n    // Only save non-default domains to avoid bloating storage\r\n    const customDomains = this.allowedDomains.filter(\r\n      domain => !this.defaultDomains.includes(domain)\r\n    );\r\n\r\n    this.logger.debug(`Saving ${customDomains.length} custom domains to localStorage...`);\r\n    try {\r\n      const serialized = JSON.stringify(customDomains);\r\n      localStorage.setItem(this.options.allowlistKey, serialized);\r\n      this.logger.debug(`Custom domains saved successfully: [${customDomains.join(', ')}]`);\r\n    } catch (error) {\r\n      this.logger.error('Failed to save domains to localStorage:', error);\r\n      if (error.name === 'QuotaExceededError') {\r\n        this.logger.warn('localStorage quota exceeded - consider clearing old data');\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Generates a unique ID for a library\r\n   * @returns {string} Unique identifier\r\n   */\r\n  generateId() {\r\n    return 'lib_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);\r\n  }\r\n\r\n  /**\r\n   * Extracts domain from URL\r\n   * @param {string} url - The URL to extract domain from\r\n   * @returns {string|null} Domain or null if invalid\r\n   */\r\n  extractDomain(url) {\r\n    try {\r\n      const urlObj = new URL(url);\r\n      return urlObj.hostname;\r\n    } catch (error) {\r\n      this.logger.warn('Invalid URL provided:', url);\r\n      return null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Extracts library name from URL (best guess)\r\n   * @param {string} url - The library URL\r\n   * @returns {string} Guessed library name\r\n   */\r\n  guessLibraryName(url) {\r\n    try {\r\n      const urlObj = new URL(url);\r\n      const pathname = urlObj.pathname;\r\n\r\n      // Extract filename without extension\r\n      const filename = pathname.split('/').pop();\r\n      const nameWithoutExt = filename.replace(/\\.(min\\.)?js$/, '');\r\n\r\n      // Common library name patterns\r\n      const patterns = [\r\n        /^(.+?)[-.][\\d]/,  // name-version or name.version\r\n        /^(.+?)\\.min$/,    // name.min\r\n        /^(.+?)$/          // fallback to full name\r\n      ];\r\n\r\n      for (const pattern of patterns) {\r\n        const match = nameWithoutExt.match(pattern);\r\n        if (match && match[1]) {\r\n          return match[1].charAt(0).toUpperCase() + match[1].slice(1);\r\n        }\r\n      }\r\n\r\n      return nameWithoutExt || 'Unknown Library';\r\n    } catch (error) {\r\n      return 'Unknown Library';\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Extracts version from URL (best guess)\r\n   * @param {string} url - The library URL\r\n   * @returns {string|null} Version string or null if not found\r\n   */\r\n  extractVersionFromUrl(url) {\r\n    try {\r\n      const urlObj = new URL(url);\r\n      const pathname = urlObj.pathname;\r\n\r\n      // Extract filename without extension\r\n      const filename = pathname.split('/').pop();\r\n      const nameWithoutExt = filename.replace(/\\.(min\\.)?js$/, '');\r\n\r\n      // Version extraction patterns\r\n      const versionPatterns = [\r\n        /[-.](\\d+\\.\\d+\\.\\d+(?:\\.\\d+)?(?:-[a-zA-Z0-9]+)*)/,  // semantic version (e.g., jquery-3.6.0.min.js)\r\n        /[-.](\\d+\\.\\d+\\.\\d+)/,                              // x.y.z version\r\n        /[-.](\\d+\\.\\d+)/,                                   // x.y version\r\n        /\\/(\\d+\\.\\d+\\.\\d+(?:\\.\\d+)?(?:-[a-zA-Z0-9]+)*)\\//  // version in path (e.g., /3.6.0/)\r\n      ];\r\n\r\n      for (const pattern of versionPatterns) {\r\n        const match = url.match(pattern) || nameWithoutExt.match(pattern);\r\n        if (match && match[1]) {\r\n          return match[1];\r\n        }\r\n      }\r\n\r\n      return null;\r\n    } catch (error) {\r\n      return null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Checks if a domain is in the allowed list\r\n   * @param {string} domain - Domain to check\r\n   * @returns {boolean} True if domain is allowed\r\n   */\r\n  isDomainAllowed(domain) {\r\n    return this.allowedDomains.includes(domain);\r\n  }\r\n\r\n  /**\r\n   * Validates a library URL\r\n   * @param {string} url - URL to validate\r\n   * @returns {Object} Validation result with status and domain\r\n   */\r\n  validateLibraryUrl(url) {\r\n    if (!url || typeof url !== 'string') {\r\n      return { valid: false, error: 'URL is required' };\r\n    }\r\n\r\n    // Basic URL validation\r\n    const domain = this.extractDomain(url);\r\n    if (!domain) {\r\n      return { valid: false, error: 'Invalid URL format' };\r\n    }\r\n\r\n    // Check if URL points to a JavaScript file\r\n    if (!url.match(/\\.js(\\?.*)?$/i)) {\r\n      return { valid: false, error: 'URL must point to a JavaScript file (.js)' };\r\n    }\r\n\r\n    // Check if domain is allowed\r\n    const domainAllowed = this.isDomainAllowed(domain);\r\n\r\n    return {\r\n      valid: true,\r\n      domain,\r\n      domainAllowed,\r\n      needsDomainApproval: !domainAllowed\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Adds a library to the collection\r\n   * @param {string} url - Library URL\r\n   * @param {string} [name] - Optional library name (will be guessed if not provided)\r\n   * @returns {Object} Result object with success status\r\n   */\r\n  addLibrary(url, name = null) {\r\n    const validation = this.validateLibraryUrl(url);\r\n\r\n    if (!validation.valid) {\r\n      this.logger.warn('Library validation failed:', validation.error);\r\n      return { success: false, error: validation.error };\r\n    }\r\n\r\n    // Check if library already exists\r\n    const existing = this.libraries.find(lib => lib.url === url);\r\n    if (existing) {\r\n      this.logger.warn('Library already exists:', url);\r\n      return { success: false, error: 'Library already added' };\r\n    }\r\n\r\n    // Check domain approval\r\n    if (validation.needsDomainApproval) {\r\n      this.logger.info('Domain approval needed for:', validation.domain);\r\n      this.eventEmitter.emit(EVENTS.DOMAIN_TRUST_REQUEST, {\r\n        domain: validation.domain,\r\n        url,\r\n        name: name || this.guessLibraryName(url)\r\n      });\r\n      return { success: false, needsApproval: true, domain: validation.domain };\r\n    }\r\n\r\n    // Add the library\r\n    const library = {\r\n      id: this.generateId(),\r\n      name: name || this.guessLibraryName(url),\r\n      url: url.trim(),\r\n      domain: validation.domain,\r\n      addedAt: new Date().toISOString()\r\n    };\r\n\r\n    this.libraries.push(library);\r\n    this.saveLibraries();\r\n\r\n    this.logger.info('Library added:', library.name);\r\n    this.eventEmitter.emit(EVENTS.LIBRARY_ADDED, { library });\r\n\r\n    return { success: true, library };\r\n  }\r\n\r\n  /**\r\n   * Removes a library by ID\r\n   * @param {string} id - Library ID to remove\r\n   * @returns {boolean} True if library was removed\r\n   */\r\n  removeLibrary(id) {\r\n    const index = this.libraries.findIndex(lib => lib.id === id);\r\n    if (index === -1) {\r\n      this.logger.warn('Library not found for removal:', id);\r\n      return false;\r\n    }\r\n\r\n    const removed = this.libraries.splice(index, 1)[0];\r\n    this.saveLibraries();\r\n\r\n    this.logger.info('Library removed:', removed.name);\r\n    this.eventEmitter.emit(EVENTS.LIBRARY_REMOVED, { library: removed });\r\n\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Adds a domain to the allowed list\r\n   * @param {string} domain - Domain to add\r\n   * @returns {boolean} True if domain was added\r\n   */\r\n  addDomain(domain) {\r\n    if (!domain || this.allowedDomains.includes(domain)) {\r\n      return false;\r\n    }\r\n\r\n    this.allowedDomains.push(domain);\r\n    this.saveDomains();\r\n\r\n    this.logger.info('Domain added to allowlist:', domain);\r\n    this.eventEmitter.emit(EVENTS.DOMAIN_ADDED, { domain });\r\n\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Removes a domain from the allowed list (if not default)\r\n   * @param {string} domain - Domain to remove\r\n   * @returns {boolean} True if domain was removed\r\n   */\r\n  removeDomain(domain) {\r\n    if (this.defaultDomains.includes(domain)) {\r\n      this.logger.warn('Cannot remove default domain:', domain);\r\n      return false;\r\n    }\r\n\r\n    const index = this.allowedDomains.indexOf(domain);\r\n    if (index === -1) {\r\n      return false;\r\n    }\r\n\r\n    this.allowedDomains.splice(index, 1);\r\n    this.saveDomains();\r\n\r\n    this.logger.info('Domain removed from allowlist:', domain);\r\n    this.eventEmitter.emit(EVENTS.DOMAIN_REMOVED, { domain });\r\n\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Gets all libraries\r\n   * @returns {Array} Array of library objects\r\n   */\r\n  getLibraries() {\r\n    return [...this.libraries];\r\n  }\r\n\r\n  /**\r\n   * Gets all allowed domains\r\n   * @returns {Array} Array of allowed domains\r\n   */\r\n  getAllowedDomains() {\r\n    return [...this.allowedDomains];\r\n  }\r\n\r\n  /**\r\n   * Fetches library content and generates inline script tags\r\n   * @returns {Promise<string>} HTML script tags with inline content\r\n   */\r\n  async generateScriptTags() {\r\n    if (this.libraries.length === 0) {\r\n      this.logger.debug('No libraries to generate scripts for');\r\n      return '';\r\n    }\r\n\r\n    this.logger.info(`Fetching content for ${this.libraries.length} libraries...`);\r\n    const scripts = [];\r\n\r\n    for (const lib of this.libraries) {\r\n      try {\r\n        let content;\r\n\r\n        // Check cache first\r\n        if (this.libraryCache.has(lib.url)) {\r\n          this.logger.debug(`Using cached content for: ${lib.name}`);\r\n          content = this.libraryCache.get(lib.url);\r\n        } else {\r\n          this.logger.debug(`Fetching library: ${lib.name} from ${lib.url}`);\r\n\r\n          const response = await fetch(lib.url);\r\n          if (!response.ok) {\r\n            throw new Error(`HTTP ${response.status}: ${response.statusText}`);\r\n          }\r\n\r\n          content = await response.text();\r\n          this.logger.debug(`Fetched ${lib.name}: ${content.length} characters`);\r\n\r\n          // Cache the content\r\n          this.libraryCache.set(lib.url, content);\r\n        }\r\n\r\n        // Create clean inline script with library content\r\n        scripts.push(`  <script data-library=\"${lib.name}\">\r\n/* Library: ${lib.name} */\r\n/* Source: ${lib.url} */\r\n/* Cached: ${new Date().toISOString()} */\r\n${content}\r\n</script>`);\r\n\r\n        this.logger.info(`✅ Successfully loaded library: ${lib.name}`);\r\n      } catch (error) {\r\n        this.logger.error(`❌ Failed to fetch library ${lib.name}:`, error.message);\r\n\r\n        // Add error placeholder script\r\n        scripts.push(`  <script data-library=\"${lib.name}\">\r\n/* Library: ${lib.name} - FAILED TO LOAD */\r\n/* Error: ${error.message} */\r\n/* URL: ${lib.url} */\r\nconsole.error('Failed to load library ${lib.name}: ${error.message}');\r\n</script>`);\r\n      }\r\n    }\r\n\r\n    const result = scripts.join('\\n');\r\n\r\n    // Enhanced logging for library injection\r\n    if (this.libraries.length > 0) {\r\n      const libraryNames = this.libraries.map(lib => lib.name).join(', ');\r\n      this.logger.info(`📚 Injecting ${this.libraries.length} libraries into sandbox: ${libraryNames}`);\r\n\r\n      // Log each library with detailed info including version detection\r\n      this.libraries.forEach(lib => {\r\n        const scriptSize = scripts.find(s => s.includes(`data-library=\"${lib.name}\"`))?.length || 0;\r\n        const version = this.extractVersionFromUrl(lib.url);\r\n        const versionInfo = version ? ` v${version}` : '';\r\n        this.logger.debug(`  → ${lib.name}${versionInfo}: ${(scriptSize / 1024).toFixed(1)}KB from ${lib.url}`);\r\n      });\r\n\r\n      this.logger.info(`📦 Total script injection size: ${(result.length / 1024).toFixed(1)}KB`);\r\n    } else {\r\n      this.logger.debug('No libraries to inject into sandbox');\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Generates dynamic CSP policy with allowed domains\r\n   * @returns {string} CSP policy string\r\n   */\r\n  generateCSP() {\r\n    const scriptSrc = [\r\n      \"'self'\",\r\n      \"'unsafe-inline'\",\r\n      \"'unsafe-eval'\",\r\n      ...this.allowedDomains.map(domain => `https://${domain}`)\r\n    ].join(' ');\r\n\r\n    return `default-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob:; script-src ${scriptSrc}; connect-src 'none';`;\r\n  }\r\n\r\n  /**\r\n   * Gets library statistics\r\n   * @returns {Object} Statistics object\r\n   */\r\n  getStats() {\r\n    return {\r\n      libraryCount: this.libraries.length,\r\n      domainCount: this.allowedDomains.length,\r\n      customDomainCount: this.allowedDomains.length - this.defaultDomains.length\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Clears all libraries and custom domains\r\n   */\r\n  clear() {\r\n    this.libraries = [];\r\n    this.allowedDomains = [...this.defaultDomains];\r\n\r\n    localStorage.removeItem(this.options.storageKey);\r\n    localStorage.removeItem(this.options.allowlistKey);\r\n\r\n    this.logger.info('All libraries and custom domains cleared');\r\n    this.eventEmitter.emit(EVENTS.LIBRARIES_CLEARED);\r\n  }\r\n\r\n  /**\r\n   * Test method to verify logging is working\r\n   */\r\n  testLogging() {\r\n    console.log('🧪 LibraryManager test logging - debug enabled:', this.options.debug);\r\n    this.logger.debug('This is a debug message');\r\n    this.logger.info('This is an info message');\r\n    this.logger.warn('This is a warn message');\r\n    this.logger.error('This is an error message');\r\n  }\r\n\r\n  /**\r\n   * Destroys the library manager\r\n   */\r\n  destroy() {\r\n    this.libraries = [];\r\n    this.allowedDomains = [];\r\n    this.logger.info('Library manager destroyed');\r\n  }\r\n}","import { Logger } from '../core/logger.js';\r\n\r\n/**\r\n * Base Dialog - Reusable dialog foundation with neon glow effects\r\n * @author Joao Guilherme (Guinetik) <guinetik@gmail.com>\r\n */\r\nexport class BaseDialog {\r\n  /**\r\n   * Creates a new BaseDialog instance\r\n   * @param {Object} options - Configuration options\r\n   * @param {string} options.title - Dialog title\r\n   * @param {string} [options.className=''] - Additional CSS classes\r\n   * @param {boolean} [options.modal=true] - Whether dialog is modal\r\n   * @param {boolean} [options.closeOnBackdrop=true] - Close on backdrop click\r\n   * @param {boolean} [options.closeOnEscape=true] - Close on Escape key\r\n   * @param {boolean} [options.debug=false] - Enable debug logging\r\n   * @param {string} [options.logPrefix='BaseDialog'] - Logger prefix\r\n   */\r\n  constructor(options = {}) {\r\n    this.options = {\r\n      title: 'Dialog',\r\n      className: '',\r\n      modal: true,\r\n      closeOnBackdrop: true,\r\n      closeOnEscape: true,\r\n      debug: false,\r\n      logPrefix: 'BaseDialog',\r\n      ...options\r\n    };\r\n\r\n    this.logger = new Logger({\r\n      enabled: this.options.debug,\r\n      level: 'info',\r\n      prefix: this.options.logPrefix\r\n    });\r\n\r\n    this.dialog = null;\r\n    this.content = null;\r\n    this.isOpen = false;\r\n    this.closeButton = null;\r\n\r\n    this.logger.debug('BaseDialog instance created with options:', this.options);\r\n    this.createDialog();\r\n  }\r\n\r\n  /**\r\n   * Creates the base dialog structure\r\n   */\r\n  createDialog() {\r\n    this.logger.debug('Creating dialog structure...');\r\n\r\n    // Create dialog element\r\n    this.dialog = document.createElement('dialog');\r\n    this.dialog.className = `base-dialog ${this.options.className}`.trim();\r\n\r\n    // Create dialog content wrapper\r\n    this.content = document.createElement('div');\r\n    this.content.className = 'dialog-content';\r\n\r\n    // Create header\r\n    const header = document.createElement('header');\r\n    header.className = 'dialog-header';\r\n    header.innerHTML = `\r\n      <h3 class=\"dialog-title\">${this.options.title}</h3>\r\n      <button class=\"close-btn\" title=\"Close\">×</button>\r\n    `;\r\n\r\n    // Cache close button reference\r\n    this.closeButton = header.querySelector('.close-btn');\r\n\r\n    // Create body container (to be populated by subclasses)\r\n    const body = document.createElement('div');\r\n    body.className = 'dialog-body';\r\n\r\n    // Assemble dialog\r\n    this.content.appendChild(header);\r\n    this.content.appendChild(body);\r\n    this.dialog.appendChild(this.content);\r\n\r\n    // Add to document\r\n    document.body.appendChild(this.dialog);\r\n\r\n    this.logger.debug('Dialog structure created and added to DOM');\r\n    this.setupEventListeners();\r\n  }\r\n\r\n  /**\r\n   * Sets up base event listeners\r\n   */\r\n  setupEventListeners() {\r\n    this.logger.debug('Setting up base event listeners...');\r\n\r\n    // Close button\r\n    if (this.closeButton) {\r\n      this.closeButton.addEventListener('click', () => {\r\n        this.logger.debug('Close button clicked');\r\n        this.close();\r\n      });\r\n    }\r\n\r\n    // Backdrop click\r\n    if (this.options.closeOnBackdrop) {\r\n      this.dialog.addEventListener('click', (e) => {\r\n        if (e.target === this.dialog) {\r\n          this.logger.debug('Backdrop clicked, closing dialog');\r\n          this.close();\r\n        }\r\n      });\r\n    }\r\n\r\n    // Escape key\r\n    if (this.options.closeOnEscape) {\r\n      this.dialog.addEventListener('keydown', (e) => {\r\n        if (e.key === 'Escape') {\r\n          this.logger.debug('Escape key pressed, closing dialog');\r\n          this.close();\r\n        }\r\n      });\r\n    }\r\n\r\n    this.logger.debug('Base event listeners configured');\r\n  }\r\n\r\n  /**\r\n   * Gets the dialog body element for content injection\r\n   * @returns {HTMLElement} The dialog body element\r\n   */\r\n  getBody() {\r\n    return this.content.querySelector('.dialog-body');\r\n  }\r\n\r\n  /**\r\n   * Sets the dialog title\r\n   * @param {string} title - New title\r\n   */\r\n  setTitle(title) {\r\n    this.logger.debug(`Setting dialog title to: \"${title}\"`);\r\n    const titleElement = this.content.querySelector('.dialog-title');\r\n    if (titleElement) {\r\n      titleElement.textContent = title;\r\n      this.options.title = title;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Opens the dialog\r\n   * @param {Object} [options={}] - Open options\r\n   * @param {boolean} [options.focus=true] - Whether to focus the dialog\r\n   */\r\n  open(options = {}) {\r\n    const { focus = true } = options;\r\n\r\n    if (this.isOpen) {\r\n      this.logger.warn('Dialog is already open');\r\n      return;\r\n    }\r\n\r\n    this.logger.info('Opening dialog...');\r\n\r\n    // Call pre-open hook\r\n    this.onBeforeOpen();\r\n\r\n    // Show dialog\r\n    if (this.options.modal) {\r\n      this.dialog.showModal();\r\n    } else {\r\n      this.dialog.show();\r\n    }\r\n\r\n    this.isOpen = true;\r\n\r\n    // Focus management\r\n    if (focus) {\r\n      setTimeout(() => {\r\n        this.dialog.focus();\r\n        this.onFocus();\r\n      }, 100);\r\n    }\r\n\r\n    // Call post-open hook\r\n    this.onAfterOpen();\r\n\r\n    this.logger.info('Dialog opened successfully');\r\n  }\r\n\r\n  /**\r\n   * Closes the dialog\r\n   */\r\n  close() {\r\n    if (!this.isOpen) {\r\n      this.logger.warn('Dialog is already closed');\r\n      return;\r\n    }\r\n\r\n    this.logger.info('Closing dialog...');\r\n\r\n    // Call pre-close hook\r\n    this.onBeforeClose();\r\n\r\n    this.dialog.close();\r\n    this.isOpen = false;\r\n\r\n    // Call post-close hook\r\n    this.onAfterClose();\r\n\r\n    this.logger.info('Dialog closed successfully');\r\n  }\r\n\r\n  /**\r\n   * Toggles the dialog open/closed state\r\n   */\r\n  toggle() {\r\n    this.logger.debug('Toggling dialog state');\r\n    if (this.isOpen) {\r\n      this.close();\r\n    } else {\r\n      this.open();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Checks if dialog is currently open\r\n   * @returns {boolean} True if dialog is open\r\n   */\r\n  isDialogOpen() {\r\n    return this.isOpen;\r\n  }\r\n\r\n  /**\r\n   * Adds content to the dialog body\r\n   * @param {string|HTMLElement} content - Content to add\r\n   */\r\n  setContent(content) {\r\n    this.logger.debug('Setting dialog content...');\r\n    const body = this.getBody();\r\n\r\n    if (typeof content === 'string') {\r\n      body.innerHTML = content;\r\n    } else if (content instanceof HTMLElement) {\r\n      body.innerHTML = '';\r\n      body.appendChild(content);\r\n    }\r\n\r\n    this.logger.debug('Dialog content updated');\r\n  }\r\n\r\n  /**\r\n   * Adds a CSS class to the dialog\r\n   * @param {string} className - Class name to add\r\n   */\r\n  addClass(className) {\r\n    this.logger.debug(`Adding class: ${className}`);\r\n    this.dialog.classList.add(className);\r\n  }\r\n\r\n  /**\r\n   * Removes a CSS class from the dialog\r\n   * @param {string} className - Class name to remove\r\n   */\r\n  removeClass(className) {\r\n    this.logger.debug(`Removing class: ${className}`);\r\n    this.dialog.classList.remove(className);\r\n  }\r\n\r\n  // Lifecycle hooks (to be overridden by subclasses)\r\n\r\n  /**\r\n   * Called before dialog opens\r\n   * Override in subclasses for custom behavior\r\n   */\r\n  onBeforeOpen() {\r\n    this.logger.debug('onBeforeOpen hook called');\r\n  }\r\n\r\n  /**\r\n   * Called after dialog opens\r\n   * Override in subclasses for custom behavior\r\n   */\r\n  onAfterOpen() {\r\n    this.logger.debug('onAfterOpen hook called');\r\n  }\r\n\r\n  /**\r\n   * Called when dialog receives focus\r\n   * Override in subclasses for custom behavior\r\n   */\r\n  onFocus() {\r\n    this.logger.debug('onFocus hook called');\r\n  }\r\n\r\n  /**\r\n   * Called before dialog closes\r\n   * Override in subclasses for custom behavior\r\n   */\r\n  onBeforeClose() {\r\n    this.logger.debug('onBeforeClose hook called');\r\n  }\r\n\r\n  /**\r\n   * Called after dialog closes\r\n   * Override in subclasses for custom behavior\r\n   */\r\n  onAfterClose() {\r\n    this.logger.debug('onAfterClose hook called');\r\n  }\r\n\r\n  /**\r\n   * Destroys the dialog and cleans up resources\r\n   */\r\n  destroy() {\r\n    this.logger.info('Destroying dialog...');\r\n\r\n    if (this.isOpen) {\r\n      this.close();\r\n    }\r\n\r\n    if (this.dialog) {\r\n      this.dialog.remove();\r\n      this.dialog = null;\r\n    }\r\n\r\n    this.content = null;\r\n    this.closeButton = null;\r\n    this.isOpen = false;\r\n\r\n    this.logger.info('Dialog destroyed successfully');\r\n  }\r\n}","import { BaseDialog } from '../ui/base-dialog.js';\r\nimport { EVENTS } from '../core/constants.js';\r\n\r\n/**\r\n * Library Manager Dialog - UI for managing runtime libraries\r\n * @author Joao Guilherme (Guinetik) <guinetik@gmail.com>\r\n */\r\nexport class LibraryDialog extends BaseDialog {\r\n  /**\r\n   * Creates a new LibraryDialog instance\r\n   * @param {Object} eventEmitter - Event emitter instance\r\n   * @param {Object} libraryManager - Library manager instance\r\n   * @param {Object} options - Configuration options\r\n   * @param {boolean} [options.debug=false] - Enable debug logging\r\n   */\r\n  constructor(eventEmitter, libraryManager, options = {}) {\r\n    // Call parent constructor with dialog-specific options\r\n    super({\r\n      title: 'Runtime Libraries',\r\n      className: 'library-dialog',\r\n      debug: options.debug || false,\r\n      logPrefix: 'LibraryDialog',\r\n      ...options\r\n    });\r\n\r\n    this.eventEmitter = eventEmitter;\r\n    this.libraryManager = libraryManager;\r\n\r\n    this.urlInput = null;\r\n    this.addBtn = null;\r\n    this.libraryList = null;\r\n\r\n    // Force a log message to test if logging is working\r\n    console.log('🔧 LibraryDialog created with debug:', this.options.debug);\r\n\r\n    this.logger.info('LibraryDialog initializing...');\r\n    this.createLibraryContent();\r\n    this.setupLibraryEventListeners();\r\n    this.logger.info('LibraryDialog initialization complete');\r\n  }\r\n\r\n  /**\r\n   * Creates the library-specific content for the dialog\r\n   */\r\n  createLibraryContent() {\r\n    this.logger.debug('Creating library-specific dialog content...');\r\n\r\n    const body = this.getBody();\r\n    body.innerHTML = `\r\n      <section class=\"current-libraries\">\r\n        <p class=\"descriptor\">Manage libraries loaded into the sandbox environment</p>\r\n        <div class=\"library-list\">\r\n          <div class=\"empty-state\">\r\n            <span class=\"empty-icon\">📚</span>\r\n            <p>No libraries added yet</p>\r\n            <small>Add a CDN URL below to get started</small>\r\n          </div>\r\n        </div>\r\n      </section>\r\n\r\n      <section class=\"add-library\">\r\n        <h4>Add Library</h4>\r\n        <p class=\"descriptor\">Paste CDN URL to add a new library to your sandbox</p>\r\n        <div class=\"input-row\">\r\n          <input type=\"url\" class=\"url-input\" placeholder=\"https://cdnjs.cloudflare.com/ajax/libs/...\">\r\n          <button class=\"add-btn\">Add</button>\r\n        </div>\r\n        <div class=\"input-feedback\"></div>\r\n      </section>\r\n    `;\r\n\r\n    // Cache element references\r\n    this.urlInput = body.querySelector('.url-input');\r\n    this.addBtn = body.querySelector('.add-btn');\r\n    this.libraryList = body.querySelector('.library-list');\r\n\r\n    // Setup library-specific event listeners\r\n    this.addBtn.addEventListener('click', () => {\r\n      this.logger.debug('Add button clicked');\r\n      this.handleAddLibrary();\r\n    });\r\n\r\n    this.urlInput.addEventListener('keydown', (e) => {\r\n      if (e.key === 'Enter') {\r\n        this.logger.debug('Enter key pressed in URL input');\r\n        this.handleAddLibrary();\r\n      }\r\n    });\r\n\r\n    this.logger.debug('Library content created successfully');\r\n  }\r\n\r\n  /**\r\n   * Sets up library-specific event listeners\r\n   */\r\n  setupLibraryEventListeners() {\r\n    this.logger.debug('Setting up library event listeners...');\r\n\r\n    this.eventEmitter.on(EVENTS.LIBRARY_MANAGER_OPEN, () => {\r\n      this.logger.info('Received LIBRARY_MANAGER_OPEN event');\r\n      this.open();\r\n    });\r\n\r\n    this.eventEmitter.on(EVENTS.LIBRARY_ADDED, (data) => {\r\n      this.logger.info('Received LIBRARY_ADDED event for:', data?.library?.name);\r\n      this.refreshLibraryList();\r\n    });\r\n\r\n    this.eventEmitter.on(EVENTS.LIBRARY_REMOVED, (data) => {\r\n      this.logger.info('Received LIBRARY_REMOVED event for:', data?.library?.name);\r\n      this.refreshLibraryList();\r\n    });\r\n\r\n    this.eventEmitter.on(EVENTS.DOMAIN_TRUST_REQUEST, (data) => {\r\n      this.logger.warn('Received DOMAIN_TRUST_REQUEST for domain:', data?.domain);\r\n      this.showDomainTrustDialog(data);\r\n    });\r\n\r\n    this.logger.debug('Library event listeners configured');\r\n  }\r\n\r\n  /**\r\n   * Called before dialog opens - prepare library content\r\n   */\r\n  onBeforeOpen() {\r\n    this.logger.debug('Preparing library dialog for opening...');\r\n    this.refreshLibraryList();\r\n    this.urlInput.value = '';\r\n    this.clearFeedback();\r\n  }\r\n\r\n  /**\r\n   * Called when dialog receives focus - focus URL input\r\n   */\r\n  onFocus() {\r\n    this.logger.debug('Library dialog focused, focusing URL input');\r\n    if (this.urlInput) {\r\n      this.urlInput.focus();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Called after dialog closes - clear feedback\r\n   */\r\n  onAfterClose() {\r\n    this.logger.debug('Library dialog closed, clearing feedback');\r\n    this.clearFeedback();\r\n  }\r\n\r\n  /**\r\n   * Handles adding a new library\r\n   */\r\n  handleAddLibrary() {\r\n    const url = this.urlInput.value.trim();\r\n    this.logger.debug('handleAddLibrary called with URL:', url);\r\n\r\n    if (!url) {\r\n      this.logger.warn('Add library attempted with empty URL');\r\n      this.showFeedback('Please enter a library URL', 'error');\r\n      return;\r\n    }\r\n\r\n    this.logger.info('Attempting to add library:', url);\r\n    this.showFeedback('Adding library...', 'loading');\r\n    this.addBtn.disabled = true;\r\n\r\n    // Attempt to add the library\r\n    const result = this.libraryManager.addLibrary(url);\r\n    this.logger.debug('Library manager result:', result);\r\n\r\n    if (result.success) {\r\n      this.logger.info(`Library added successfully: ${result.library.name}`);\r\n      this.showFeedback(`Added: ${result.library.name}`, 'success');\r\n      this.urlInput.value = '';\r\n      setTimeout(() => {\r\n        this.logger.debug('Clearing success feedback after timeout');\r\n        this.clearFeedback();\r\n      }, 2000);\r\n    } else if (result.needsApproval) {\r\n      this.logger.warn(`Domain approval needed for: ${result.domain}`);\r\n      this.showFeedback(`Waiting for domain approval: ${result.domain}`, 'warning');\r\n      // Dialog will be shown by domain trust request event\r\n    } else {\r\n      this.logger.error(`Failed to add library: ${result.error}`);\r\n      this.showFeedback(`Error: ${result.error}`, 'error');\r\n    }\r\n\r\n    this.addBtn.disabled = false;\r\n    this.logger.debug('Add library operation completed');\r\n  }\r\n\r\n  /**\r\n   * Shows domain trust confirmation dialog\r\n   * @param {Object} data - Domain trust data\r\n   */\r\n  showDomainTrustDialog(data) {\r\n    this.logger.info(`Showing domain trust dialog for: ${data.domain}`);\r\n\r\n    const confirmed = confirm(\r\n      `⚠️ New CDN Domain Detected\\n\\n` +\r\n      `The domain \"${data.domain}\" is not in your trusted list.\\n\\n` +\r\n      `Adding this domain will allow all scripts from:\\n` +\r\n      `https://${data.domain}\\n\\n` +\r\n      `Do you want to trust this domain?`\r\n    );\r\n\r\n    if (confirmed) {\r\n      this.logger.info(`User confirmed trust for domain: ${data.domain}`);\r\n      this.libraryManager.addDomain(data.domain);\r\n\r\n      // Try adding the library again\r\n      this.logger.debug(`Retrying library addition for: ${data.url}`);\r\n      const result = this.libraryManager.addLibrary(data.url, data.name);\r\n\r\n      if (result.success) {\r\n        this.logger.info(`Library added after domain approval: ${result.library.name}`);\r\n        this.showFeedback(`Added: ${result.library.name}`, 'success');\r\n        this.urlInput.value = '';\r\n        setTimeout(() => {\r\n          this.logger.debug('Clearing success feedback after domain approval');\r\n          this.clearFeedback();\r\n        }, 2000);\r\n      } else {\r\n        this.logger.error(`Library addition failed after domain approval: ${result.error}`);\r\n        this.showFeedback(`Error: ${result.error}`, 'error');\r\n      }\r\n    } else {\r\n      this.logger.info(`User cancelled domain trust for: ${data.domain}`);\r\n      this.showFeedback('Library addition cancelled', 'info');\r\n      setTimeout(() => {\r\n        this.logger.debug('Clearing cancellation feedback');\r\n        this.clearFeedback();\r\n      }, 2000);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Refreshes the library list display\r\n   */\r\n  refreshLibraryList() {\r\n    this.logger.debug('Refreshing library list display...');\r\n    const libraries = this.libraryManager.getLibraries();\r\n\r\n    if (libraries.length === 0) {\r\n      this.logger.debug('No libraries found, showing empty state');\r\n      this.libraryList.innerHTML = `\r\n        <div class=\"empty-state\">\r\n          <span class=\"empty-icon\">📚</span>\r\n          <p>No libraries added yet</p>\r\n          <small>Add a CDN URL below to get started</small>\r\n        </div>\r\n      `;\r\n    } else {\r\n      this.logger.info(`Displaying ${libraries.length} libraries in list`);\r\n      this.libraryList.innerHTML = libraries.map(lib => {\r\n        this.logger.trace(`Rendering library item: ${lib.name}`);\r\n        return `\r\n          <div class=\"library-item\" data-id=\"${lib.id}\">\r\n            <div class=\"library-info\">\r\n              <span class=\"library-name\">${lib.name}</span>\r\n              <small class=\"library-url\">${lib.url}</small>\r\n            </div>\r\n            <button class=\"remove-btn\" title=\"Remove library\" data-id=\"${lib.id}\">🗑️</button>\r\n          </div>\r\n        `;\r\n      }).join('');\r\n\r\n      // Add remove button listeners\r\n      this.libraryList.querySelectorAll('.remove-btn').forEach(btn => {\r\n        btn.addEventListener('click', (e) => {\r\n          const id = e.target.dataset.id;\r\n          const library = libraries.find(lib => lib.id === id);\r\n          this.logger.info(`Remove button clicked for library: ${library?.name || id}`);\r\n          this.libraryManager.removeLibrary(id);\r\n        });\r\n      });\r\n\r\n      this.logger.debug('Remove button listeners attached to all library items');\r\n    }\r\n\r\n    this.logger.debug(`Library list refresh completed: ${libraries.length} libraries displayed`);\r\n  }\r\n\r\n  /**\r\n   * Shows feedback message\r\n   * @param {string} message - Message to show\r\n   * @param {string} type - Type of feedback (success, error, warning, info, loading)\r\n   */\r\n  showFeedback(message, type = 'info') {\r\n    this.logger.debug(`Showing ${type} feedback: ${message}`);\r\n    const feedback = this.getBody().querySelector('.input-feedback');\r\n    if (feedback) {\r\n      feedback.textContent = message;\r\n      feedback.className = `input-feedback ${type}`;\r\n    } else {\r\n      this.logger.warn('Feedback element not found in dialog body');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clears feedback message\r\n   */\r\n  clearFeedback() {\r\n    this.logger.debug('Clearing feedback message');\r\n    const feedback = this.getBody().querySelector('.input-feedback');\r\n    if (feedback) {\r\n      feedback.textContent = '';\r\n      feedback.className = 'input-feedback';\r\n    }\r\n  }\r\n}","import { Logger } from '../core/logger.js';\r\nimport { EVENTS } from '../core/constants.js';\r\n\r\n/**\r\n * Share manager for generating and handling shareable links\r\n * @author Joao Guilherme (Guinetik) <guinetik@gmail.com>\r\n */\r\nexport class ShareManager {\r\n  /**\r\n   * Creates a new ShareManager instance\r\n   * @param {Object} eventEmitter - Event emitter instance\r\n   * @param {Object} options - Configuration options\r\n   * @param {boolean} [options.debug=true] - Enable debug logging\r\n   */\r\n  constructor(eventEmitter, options = {}) {\r\n    this.eventEmitter = eventEmitter;\r\n    this.options = {\r\n      debug: true,\r\n      ...options\r\n    };\r\n\r\n    this.logger = new Logger({\r\n      enabled: this.options.debug,\r\n      level: 'info',\r\n      prefix: 'ShareManager'\r\n    });\r\n\r\n    this.logger.info('ShareManager initialized');\r\n  }\r\n\r\n  /**\r\n   * Generates a shareable URL with the current code\r\n   * @param {string} code - The code to share\r\n   * @returns {string} Shareable URL\r\n   */\r\n  generateShareUrl(code) {\r\n    try {\r\n      // Encode the code to base64\r\n      const encodedCode = btoa(encodeURIComponent(code));\r\n      this.logger.info('Generated share URL with code length:', code.length);\r\n\r\n      // Get current URL without existing script parameter\r\n      const currentUrl = new URL(window.location.href);\r\n      currentUrl.searchParams.set('script', encodedCode);\r\n\r\n      return currentUrl.toString();\r\n    } catch (error) {\r\n      this.logger.error('Failed to generate share URL:', error);\r\n      throw new Error('Failed to generate share URL');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Extracts and decodes script from URL parameters\r\n   * @returns {string|null} Decoded script or null if not found\r\n   */\r\n  extractScriptFromUrl() {\r\n    try {\r\n      const urlParams = new URLSearchParams(window.location.search);\r\n      const encodedScript = urlParams.get('script');\r\n\r\n      if (!encodedScript) {\r\n        this.logger.info('No script parameter found in URL');\r\n        return null;\r\n      }\r\n\r\n      // Decode base64 and then URI decode\r\n      const decodedScript = decodeURIComponent(atob(encodedScript));\r\n      this.logger.info('Extracted script from URL, length:', decodedScript.length);\r\n\r\n      return decodedScript;\r\n    } catch (error) {\r\n      this.logger.error('Failed to extract script from URL:', error);\r\n      return null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Copies a URL to clipboard\r\n   * @param {string} url - URL to copy\r\n   * @returns {Promise<boolean>} Success status\r\n   */\r\n  async copyToClipboard(url) {\r\n    try {\r\n      if (navigator.clipboard && window.isSecureContext) {\r\n        // Use modern clipboard API\r\n        await navigator.clipboard.writeText(url);\r\n        this.logger.info('URL copied to clipboard using modern API');\r\n        return true;\r\n      } else {\r\n        // Fallback for older browsers or non-secure contexts\r\n        const textArea = document.createElement('textarea');\r\n        textArea.value = url;\r\n        textArea.style.position = 'fixed';\r\n        textArea.style.left = '-999999px';\r\n        textArea.style.top = '-999999px';\r\n        document.body.appendChild(textArea);\r\n        textArea.focus();\r\n        textArea.select();\r\n        \r\n        const successful = document.execCommand('copy');\r\n        document.body.removeChild(textArea);\r\n        \r\n        if (successful) {\r\n          this.logger.info('URL copied to clipboard using fallback method');\r\n          return true;\r\n        } else {\r\n          throw new Error('Fallback copy failed');\r\n        }\r\n      }\r\n    } catch (error) {\r\n      this.logger.error('Failed to copy URL to clipboard:', error);\r\n      return false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Shares the current code and copies URL to clipboard\r\n   * @param {string} code - The code to share\r\n   * @returns {Promise<boolean>} Success status\r\n   */\r\n  async shareCode(code) {\r\n    try {\r\n      const shareUrl = this.generateShareUrl(code);\r\n      const success = await this.copyToClipboard(shareUrl);\r\n\r\n      if (success) {\r\n        // Emit success event\r\n        this.eventEmitter.emit(EVENTS.SHARE_SUCCESS, {\r\n          url: shareUrl,\r\n          codeLength: code.length\r\n        });\r\n        this.logger.info('Code shared successfully');\r\n        return true;\r\n      } else {\r\n        // Emit error event\r\n        this.eventEmitter.emit(EVENTS.SHARE_ERROR, {\r\n          error: 'Failed to copy to clipboard'\r\n        });\r\n        return false;\r\n      }\r\n    } catch (error) {\r\n      this.logger.error('Failed to share code:', error);\r\n      this.eventEmitter.emit(EVENTS.SHARE_ERROR, {\r\n        error: error.message\r\n      });\r\n      return false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Checks if there's a script parameter in the URL on page load\r\n   * @returns {boolean} True if script parameter exists\r\n   */\r\n  hasScriptInUrl() {\r\n    const urlParams = new URLSearchParams(window.location.search);\r\n    return urlParams.has('script');\r\n  }\r\n\r\n  /**\r\n   * Cleans up the URL by removing the script parameter\r\n   */\r\n  cleanupUrl() {\r\n    try {\r\n      const url = new URL(window.location.href);\r\n      url.searchParams.delete('script');\r\n      \r\n      // Update URL without page reload\r\n      window.history.replaceState({}, document.title, url.toString());\r\n      this.logger.info('URL cleaned up, script parameter removed');\r\n    } catch (error) {\r\n      this.logger.error('Failed to cleanup URL:', error);\r\n    }\r\n  }\r\n}\r\n","/**\r\n * Neon Glass Glow Effect Manager\r\n * Applies animated neon glass borders to UI elements\r\n * @author Joao Guilherme (Guinetik) <guinetik@gmail.com>\r\n */\r\n\r\nimport { Logger } from '../core/logger.js';\r\n\r\nexport class NeonGlowManager {\r\n  /**\r\n   * Creates a new NeonGlowManager instance\r\n   * @param {Object} [options={}] - Configuration options\r\n   * @param {number} [options.transitionDuration=8000] - Duration for color transitions in ms\r\n   * @param {boolean} [options.autoRotate=true] - Automatically rotate colors\r\n   * @param {boolean} [options.debug=false] - Enable debug logging\r\n   */\r\n  constructor(options = {}) {\r\n    this.options = {\r\n      transitionDuration: 8000,\r\n      autoRotate: true,\r\n      debug: false,\r\n      ...options\r\n    };\r\n\r\n    this.logger = new Logger({\r\n      enabled: this.options.debug,\r\n      level: 'info',\r\n      prefix: 'NeonGlow'\r\n    });\r\n\r\n    this.hue1 = this.randomHue();\r\n    this.hue2 = this.randomHue();\r\n    this.rotationInterval = null;\r\n    this.glowElements = new Set();\r\n  }\r\n\r\n  /**\r\n   * Generates a random hue value\r\n   * @returns {number} Hue between 0-360\r\n   */\r\n  randomHue() {\r\n    return Math.floor(Math.random() * 360);\r\n  }\r\n\r\n  /**\r\n   * Generates a complementary hue with some variance\r\n   * @param {number} baseHue - Base hue value\r\n   * @returns {number} Complementary hue\r\n   */\r\n  complementaryHue(baseHue) {\r\n    const offset = 80 + Math.floor(Math.random() * 60) - 30;\r\n    return (baseHue + offset) % 360;\r\n  }\r\n\r\n  /**\r\n   * Applies neon glow effect to an element\r\n   * @param {HTMLElement} element - Element to apply glow to\r\n   * @param {Object} [options={}] - Glow options (unused in new implementation)\r\n   */\r\n  applyGlow(element, options = {}) {\r\n    // Add neon-glow class\r\n    element.classList.add('neon-glow');\r\n\r\n    // Create glow container\r\n    const glowContainer = document.createElement('div');\r\n    glowContainer.className = 'neon-glow-container';\r\n\r\n    // Create SINGLE glow element that covers entire pane\r\n    const shine = document.createElement('div');\r\n    shine.className = 'neon-shine';\r\n    glowContainer.appendChild(shine);\r\n\r\n    element.appendChild(glowContainer);\r\n    this.glowElements.add(element);\r\n\r\n    this.logger.debug('Applied glow to element:', element);\r\n  }\r\n\r\n  /**\r\n   * Updates CSS custom properties for hue values\r\n   * @param {number} hue1 - Primary hue\r\n   * @param {number} hue2 - Secondary hue\r\n   */\r\n  updateHues(hue1, hue2) {\r\n    this.hue1 = hue1;\r\n    this.hue2 = hue2;\r\n\r\n    document.documentElement.style.setProperty('--hue1', String(hue1));\r\n    document.documentElement.style.setProperty('--hue2', String(hue2));\r\n\r\n    this.logger.debug(`Updated hues: ${hue1}, ${hue2}`);\r\n  }\r\n\r\n  /**\r\n   * Rotates to new random colors\r\n   */\r\n  rotateColors() {\r\n    const newHue1 = this.randomHue();\r\n    const newHue2 = this.complementaryHue(newHue1);\r\n\r\n    this.logger.info(`Rotating colors: ${newHue1}, ${newHue2}`);\r\n    this.updateHues(newHue1, newHue2);\r\n  }\r\n\r\n  /**\r\n   * Starts automatic color rotation\r\n   */\r\n  startRotation() {\r\n    if (this.rotationInterval) {\r\n      this.stopRotation();\r\n    }\r\n\r\n    // Initial colors\r\n    this.rotateColors();\r\n\r\n    // Set up interval\r\n    this.rotationInterval = setInterval(() => {\r\n      this.rotateColors();\r\n    }, this.options.transitionDuration);\r\n\r\n    this.logger.info('Started color rotation');\r\n  }\r\n\r\n  /**\r\n   * Stops automatic color rotation\r\n   */\r\n  stopRotation() {\r\n    if (this.rotationInterval) {\r\n      clearInterval(this.rotationInterval);\r\n      this.rotationInterval = null;\r\n      this.logger.info('Stopped color rotation');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Removes glow from an element\r\n   * @param {HTMLElement} element - Element to remove glow from\r\n   */\r\n  removeGlow(element) {\r\n    element.classList.remove('neon-glow');\r\n    const container = element.querySelector('.neon-glow-container');\r\n    if (container) {\r\n      container.remove();\r\n    }\r\n    this.glowElements.delete(element);\r\n  }\r\n\r\n  /**\r\n   * Cleans up the glow manager\r\n   */\r\n  destroy() {\r\n    this.logger.info('Destroying neon glow manager');\r\n    this.stopRotation();\r\n    \r\n    // Remove glow from all elements\r\n    this.glowElements.forEach(element => {\r\n      this.removeGlow(element);\r\n    });\r\n\r\n    this.glowElements.clear();\r\n  }\r\n}\r\n","import { SandboxEngine } from '../core/sandbox.js';\r\nimport { ConsoleOutput } from '../core/console.js';\r\nimport { Storage } from '../core/storage.js';\r\nimport { Logger } from '../core/logger.js';\r\nimport { EventEmitter } from '../core/events.js';\r\nimport { ExamplesLoader } from './examples.js';\r\nimport { ExamplesDropdown } from './examples-dropdown.js';\r\nimport { ThemeSwitcher } from './theme-switcher.js';\r\nimport { EditorSwitcher } from './editor-switcher.js';\r\nimport { FullscreenManager } from './fullscreen.js';\r\nimport { LibraryManager } from '../libraries/manager.js';\r\nimport { LibraryDialog } from '../libraries/dialog.js';\r\nimport { ShareManager } from './share-manager.js';\r\nimport { createHorizontalResizeHandler, createVerticalResizeHandler } from './resize-utils.js';\r\nimport { isMobile } from '../core/utils.js';\r\nimport { NeonGlowManager } from './neon.js';\r\nimport { \r\n  DEFAULT_TIMEOUT_MS, \r\n  DEFAULT_STORAGE_KEY, \r\n  EVENTS, \r\n  STATUS_MESSAGES,\r\n  MOBILE_BREAKPOINT \r\n} from '../core/constants.js';\r\n\r\n/**\r\n * Main controller that orchestrates the sandbox application components\r\n * @author Joao Guilherme (Guinetik) <guinetik@gmail.com>\r\n */\r\nexport class SandboxController {\r\n  /**\r\n   * Creates a new SandboxController instance\r\n   * @param {Object} [options={}] - Configuration options\r\n   * @param {number} [options.timeLimit] - Execution timeout in milliseconds\r\n   * @param {string} [options.storageKey] - LocalStorage key for persistence\r\n   * @param {string} [options.defaultCode] - Default code to load\r\n   * @param {boolean} [options.debug=false] - Enable debug logging\r\n   * @param {string} [options.logLevel='info'] - Log level for debugging\r\n   */\r\n  constructor(options = {}) {\r\n    this.options = {\r\n      timeLimit: DEFAULT_TIMEOUT_MS,\r\n      storageKey: DEFAULT_STORAGE_KEY,\r\n      defaultCode: this.getDefaultCode(),\r\n      debug: false,\r\n      logLevel: 'info',\r\n      ...options\r\n    };\r\n\r\n    this.logger = new Logger({\r\n      enabled: this.options.debug,\r\n      level: this.options.logLevel,\r\n      prefix: 'Controller'\r\n    });\r\n\r\n    this.events = new EventEmitter();\r\n    this.editor = null;\r\n    this.sandbox = null;\r\n    this.console = null;\r\n    this.storage = null;\r\n    this.examples = null;\r\n    this.examplesDropdown = null;\r\n    this.themeSwitcher = null;\r\n    this.editorSwitcher = null;\r\n    this.fullscreenManager = null;\r\n    this.libraryManager = null;\r\n    this.libraryDialog = null;\r\n    this.shareManager = null;\r\n    this.neonGlow = null;\r\n    this.elements = {};\r\n    this.resizeHandlers = [];\r\n    this.responsiveListener = null;\r\n    this.isInitialized = false;\r\n  }\r\n\r\n  /**\r\n   * Returns the default JavaScript code to load in the editor\r\n   * @returns {string} Default code content\r\n   */\r\n  getDefaultCode() {\r\n    return [\r\n      '// Welcome to JS Sandbox! 🙌',\r\n      '//',\r\n      '// Tips:',\r\n      '//  - Use console.log/info/warn/error',\r\n      '//  - Ctrl/Cmd+Enter to execute',\r\n      '//  - \"Reset\" kills stuck executions',\r\n      '//',\r\n      '// Examples:',\r\n      'console.log(\"Hello, sandbox!\");',\r\n      'function noReturn() { var x = 1+1; }',\r\n      'noReturn(); // no return value, all good',\r\n      '',\r\n      '// DOM inside sandbox:',\r\n      'var el = document.createElement(\"h1\");',\r\n      'el.textContent = \"Hello from iframe!\";',\r\n      'document.body.appendChild(el);',\r\n      '',\r\n      '// Errors:',\r\n      'Promise.reject(\"rejected!\");',\r\n      '// throw new Error(\"Exception thrown\");',\r\n      '',\r\n      '// Infinite loop test (commented):',\r\n      '// while(true) {}'\r\n    ].join('\\n');\r\n  }\r\n\r\n  /**\r\n   * Initializes the controller and all components\r\n   * @returns {Promise<void>}\r\n   */\r\n  async init() {\r\n    if (this.isInitialized) {\r\n      this.logger.warn('Controller already initialized');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      this.events.emit(EVENTS.INIT_START);\r\n      this.logger.info('Initializing controller...');\r\n      \r\n      this.findElements();\r\n      await this.initializeComponents();\r\n      this.setupEventListeners();\r\n      \r\n      this.isInitialized = true;\r\n      this.events.emit(EVENTS.INIT_COMPLETE);\r\n      this.logger.info('Controller initialization complete');\r\n    } catch (error) {\r\n      this.logger.error('Initialization failed:', error);\r\n      this.events.emit(EVENTS.INIT_ERROR, error);\r\n      \r\n      // Show user-friendly error message\r\n      this.showInitializationError(error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Shows initialization error to user\r\n   * @param {Error} error - The error that occurred\r\n   */\r\n  showInitializationError(error) {\r\n    if (this.elements.consoleContainer) {\r\n      const errorDiv = document.createElement('div');\r\n      errorDiv.className = 'console-line console-error';\r\n      errorDiv.textContent = `⚠️ Initialization failed: ${error.message}`;\r\n      this.elements.consoleContainer.appendChild(errorDiv);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Finds and caches DOM elements\r\n   */\r\n  findElements() {\r\n    this.elements = {\r\n      app: document.querySelector('.app'),\r\n      editorContainer: document.getElementById('editorContainer'),\r\n      consoleContainer: document.getElementById('console'),\r\n      sandboxContainer: document.getElementById('sandboxContainer'),\r\n      runBtn: document.getElementById('runBtn'),\r\n      clearBtn: document.getElementById('clearBtn'),\r\n      resetBtn: document.getElementById('resetBtn'),\r\n      togglePreview: document.getElementById('togglePreview'),\r\n      previewWrap: document.getElementById('previewWrap'),\r\n      status: document.getElementById('status'),\r\n      limitLabel: document.getElementById('limitLabel'),\r\n      toolbar: document.querySelector('.toolbar'),\r\n      fullscreenEditor: document.getElementById('fullscreenEditor'),\r\n      fullscreenConsole: document.getElementById('fullscreenConsole'),\r\n      librariesBtn: document.getElementById('librariesBtn'),\r\n      clearConsoleBtn: document.getElementById('clearConsoleBtn'),\r\n      shareBtn: document.getElementById('shareBtn')\r\n    };\r\n\r\n    // Validate required elements\r\n    const required = ['app', 'editorContainer', 'consoleContainer', 'sandboxContainer'];\r\n    const missing = required.filter(key => !this.elements[key]);\r\n    \r\n    if (missing.length > 0) {\r\n      throw new Error(`Missing required elements: ${missing.join(', ')}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Initializes all components with error boundaries\r\n   * @returns {Promise<void>}\r\n   */\r\n  async initializeComponents() {\r\n    this.logger.info('Initializing components...');\r\n\r\n    // Initialize storage\r\n    try {\r\n      this.storage = new Storage(this.options.storageKey, {\r\n        debug: this.options.debug\r\n      });\r\n      this.logger.debug('Storage initialized');\r\n    } catch (error) {\r\n      this.logger.error('Storage initialization failed:', error);\r\n      // Non-fatal, continue without persistence\r\n    }\r\n\r\n    // Initialize console\r\n    try {\r\n      this.console = new ConsoleOutput(this.elements.consoleContainer, {\r\n        debug: this.options.debug\r\n      });\r\n      this.logger.debug('Console initialized');\r\n    } catch (error) {\r\n      this.logger.error('Console initialization failed:', error);\r\n      throw new Error('Failed to initialize console output');\r\n    }\r\n\r\n    // Initialize sandbox\r\n    try {\r\n      this.sandbox = new SandboxEngine(this.elements.sandboxContainer, {\r\n        timeLimit: this.options.timeLimit,\r\n        debug: this.options.debug,\r\n        logLevel: this.options.logLevel,\r\n        onMessage: (type, args) => {\r\n          this.console.addLine(type, args);\r\n          this.events.emit(EVENTS.CONSOLE_MESSAGE, { type, args });\r\n        },\r\n        onStatusChange: (status) => this.updateStatus(status)\r\n      });\r\n      this.logger.debug('SandboxEngine created');\r\n\r\n      // Initialize sandbox template\r\n      await this.sandbox.initialize();\r\n      this.logger.info('Sandbox initialized');\r\n    } catch (error) {\r\n      this.logger.error('Sandbox initialization failed:', error);\r\n      throw new Error(`Failed to initialize sandbox: ${error.message}`);\r\n    }\r\n\r\n    // Initialize examples system\r\n    try {\r\n      this.examples = new ExamplesLoader({\r\n        onLoad: (example) => this.events.emit(EVENTS.EXAMPLE_LOAD, example),\r\n        onError: (error) => this.events.emit(EVENTS.EXAMPLE_ERROR, error),\r\n        debug: true // Always debug examples loading to help troubleshoot\r\n      });\r\n\r\n      // Initialize examples dropdown (only if not already created)\r\n      if (this.elements.toolbar && !this.examplesDropdown) {\r\n        this.examplesDropdown = new ExamplesDropdown(this.elements.toolbar, {\r\n          onSelect: (exampleId) => this.loadExample(exampleId)\r\n        });\r\n\r\n        // Load available examples\r\n        try {\r\n          this.examplesDropdown.setLoading(true);\r\n          const availableExamples = await this.examples.discoverExamples();\r\n          this.examplesDropdown.setExamples(availableExamples);\r\n          this.logger.info('Examples loaded:', availableExamples.length);\r\n        } catch (error) {\r\n          this.logger.error('Failed to load examples:', error);\r\n          this.examplesDropdown.setError('Failed to load');\r\n        }\r\n      }\r\n\r\n      // Initialize theme switcher (only if not already created)\r\n      if (this.elements.toolbar && !this.themeSwitcher) {\r\n        this.themeSwitcher = new ThemeSwitcher(this.elements.toolbar, this.events, {\r\n          defaultTheme: 'monokai'\r\n        });\r\n        this.logger.info('Theme switcher initialized');\r\n      }\r\n\r\n      // Initialize editor switcher (only if not already created)\r\n      const editorControls = this.elements.app.querySelector('.editor-controls');\r\n      if (editorControls && !this.editorSwitcher) {\r\n        this.editorSwitcher = new EditorSwitcher(editorControls, this.events, {\r\n          defaultEditor: 'ace'\r\n        });\r\n        this.logger.info('Editor switcher initialized');\r\n      }\r\n\r\n      // Initialize fullscreen manager (only if not already created)\r\n      if (!this.fullscreenManager) {\r\n        this.fullscreenManager = new FullscreenManager(this.events, {\r\n          debug: this.options.debug\r\n        });\r\n        this.fullscreenManager.init({\r\n          app: this.elements.app,\r\n          fullscreenEditor: this.elements.fullscreenEditor,\r\n          fullscreenConsole: this.elements.fullscreenConsole\r\n        });\r\n        this.logger.info('Fullscreen manager initialized');\r\n      }\r\n\r\n      // Initialize library manager (only if not already created)\r\n      if (!this.libraryManager) {\r\n        this.libraryManager = new LibraryManager(this.events, {\r\n          debug: this.options.debug\r\n        });\r\n        this.logger.info('Library manager initialized');\r\n      }\r\n\r\n      // Initialize library dialog (only if not already created)\r\n      if (!this.libraryDialog) {\r\n        this.libraryDialog = new LibraryDialog(this.events, this.libraryManager, {\r\n          debug: this.options.debug\r\n        });\r\n        this.logger.info('Library dialog initialized');\r\n      }\r\n\r\n      // Initialize share manager (only if not already created)\r\n      if (!this.shareManager) {\r\n        this.shareManager = new ShareManager(this.events, {\r\n          debug: this.options.debug\r\n        });\r\n        this.logger.info('Share manager initialized');\r\n      }\r\n    } catch (error) {\r\n      this.logger.warn('Examples system initialization failed:', error);\r\n      // Non-fatal, continue without examples\r\n    }\r\n\r\n    // Update time limit display\r\n    if (this.elements.limitLabel) {\r\n      this.elements.limitLabel.textContent = this.options.timeLimit + 'ms';\r\n    }\r\n\r\n    // Initialize resizable panes\r\n    this.initializeResizer();\r\n\r\n    // Handle responsive layout changes\r\n    this.setupResponsiveListener();\r\n\r\n    // Set initial state for preview toggle\r\n    const rightPane = this.elements.app.querySelector('.pane.right');\r\n    if (rightPane && this.elements.previewWrap) {\r\n      const isPreviewVisible = this.elements.previewWrap.classList.contains('show');\r\n      rightPane.classList.toggle('has-preview', isPreviewVisible);\r\n    }\r\n\r\n    // Initialize neon glow effects\r\n    this.initializeNeonGlow();\r\n\r\n    this.logger.info('Components initialization complete');\r\n  }\r\n\r\n  /**\r\n   * Initializes neon glow effects on UI elements\r\n   */\r\n  initializeNeonGlow() {\r\n    try {\r\n      this.neonGlow = new NeonGlowManager({\r\n        transitionDuration: 8000,\r\n        autoRotate: true,\r\n        debug: true // Enable debug to see color changes\r\n      });\r\n\r\n      // Apply glow ONLY to panes (not navbar)\r\n      const panes = this.elements.app.querySelectorAll('.pane');\r\n      panes.forEach(pane => {\r\n        this.neonGlow.applyGlow(pane);\r\n      });\r\n\r\n      // Start automatic color rotation\r\n      this.neonGlow.startRotation();\r\n\r\n      this.logger.info('Neon glow effects initialized');\r\n    } catch (error) {\r\n      this.logger.warn('Failed to initialize neon glow:', error);\r\n      // Non-fatal, continue without neon effects\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Cleans up existing resize handlers\r\n   */\r\n  cleanupResizeHandlers() {\r\n    this.resizeHandlers.forEach(handler => {\r\n      if (handler && handler.cleanup) {\r\n        handler.cleanup();\r\n      }\r\n    });\r\n    this.resizeHandlers = [];\r\n  }\r\n\r\n  /**\r\n   * Initializes the resizable panes functionality\r\n   */\r\n  initializeResizer() {\r\n    if (!this.elements.app) return;\r\n\r\n    // Cleanup existing handlers\r\n    this.cleanupResizeHandlers();\r\n\r\n    // Skip horizontal resize on mobile\r\n    if (isMobile(MOBILE_BREAKPOINT)) {\r\n      this.initializeVerticalResize();\r\n      return;\r\n    }\r\n\r\n    const mainContent = this.elements.app.querySelector('.main-content');\r\n    if (!mainContent) return;\r\n\r\n    // Remove any existing resize handles first\r\n    const existingHandles = this.elements.app.querySelectorAll('.resize-handle, .vertical-resize-handle');\r\n    existingHandles.forEach(handle => handle.remove());\r\n\r\n    // Reset any inline grid styles that might have been applied\r\n    mainContent.style.gridTemplateColumns = '';\r\n    mainContent.style.gridTemplateRows = '';\r\n\r\n    // Reset right pane styles\r\n    const rightPane = mainContent.querySelector('.pane:last-child');\r\n    if (rightPane) {\r\n      rightPane.style.gridTemplateRows = '';\r\n      rightPane.classList.remove('preview-hidden');\r\n    }\r\n\r\n    // Create resize handle\r\n    const resizeHandle = document.createElement('div');\r\n    resizeHandle.className = 'resize-handle';\r\n\r\n    // Insert between the first and last pane in main-content\r\n    const panes = mainContent.querySelectorAll('.pane');\r\n    if (panes.length >= 2) {\r\n      mainContent.insertBefore(resizeHandle, panes[1]);\r\n\r\n      // Create horizontal resize handler using utility\r\n      const horizontalHandler = createHorizontalResizeHandler({\r\n        container: mainContent,\r\n        leftPane: panes[0],\r\n        rightPane: panes[1],\r\n        handle: resizeHandle,\r\n        onResize: () => this.events.emit(EVENTS.PANES_RESIZED)\r\n      });\r\n\r\n      this.resizeHandlers.push(horizontalHandler);\r\n    }\r\n\r\n    // Initialize vertical resizing\r\n    this.initializeVerticalResize();\r\n  }\r\n\r\n  /**\r\n   * Sets up responsive layout listener for orientation/resize changes\r\n   */\r\n  setupResponsiveListener() {\r\n    // Clean up existing listener\r\n    if (this.responsiveListener) {\r\n      this.responsiveListener.mediaQuery.removeListener(this.responsiveListener.handleChange);\r\n    }\r\n\r\n    const mediaQuery = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT}px)`);\r\n\r\n    const handleChange = () => {\r\n      this.logger.debug('Responsive breakpoint changed');\r\n      this.initializeResizer();\r\n    };\r\n\r\n    mediaQuery.addListener(handleChange);\r\n\r\n    // Store reference for cleanup\r\n    this.responsiveListener = { mediaQuery, handleChange };\r\n  }\r\n\r\n  /**\r\n   * Initializes vertical resizing between console and preview\r\n   */\r\n  initializeVerticalResize() {\r\n    const rightPane = this.elements.app.querySelector('.pane.right');\r\n    if (!rightPane) return;\r\n\r\n    // Create vertical resize handle\r\n    const verticalHandle = document.createElement('div');\r\n    verticalHandle.className = 'vertical-resize-handle';\r\n\r\n    // Insert after console\r\n    const consoleEl = rightPane.querySelector('.console');\r\n    if (consoleEl) {\r\n      consoleEl.parentNode.insertBefore(verticalHandle, consoleEl.nextSibling);\r\n\r\n      // Create vertical resize handler using utility\r\n      const verticalHandler = createVerticalResizeHandler({\r\n        container: rightPane,\r\n        topPane: consoleEl,\r\n        bottomPane: this.elements.previewWrap,\r\n        handle: verticalHandle,\r\n        shouldResize: () => this.elements.previewWrap.classList.contains('show'),\r\n        onResize: () => this.events.emit(EVENTS.PANES_RESIZED_VERTICAL)\r\n      });\r\n\r\n      this.resizeHandlers.push(verticalHandler);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Gets the event emitter instance\r\n   * @returns {EventEmitter} The event emitter\r\n   */\r\n  getEventEmitter() {\r\n    return this.events;\r\n  }\r\n\r\n\r\n  /**\r\n   * Sets the editor instance\r\n   * @param {EditorAdapter} editor - The editor instance\r\n   */\r\n  setEditor(editor) {\r\n    if (this.editor) {\r\n      this.editor.destroy();\r\n    }\r\n\r\n    this.editor = editor;\r\n\r\n    // Setup editor event handlers\r\n    this.editor.onChange((code) => {\r\n      if (this.storage) {\r\n        this.storage.save(code);\r\n      }\r\n      this.events.emit(EVENTS.CODE_CHANGE, { code });\r\n    });\r\n\r\n    this.editor.onExecute(() => {\r\n      this.run();\r\n    });\r\n\r\n    // Load initial code now that editor is ready\r\n    this.loadInitialCode();\r\n    this.events.emit(EVENTS.EDITOR_READY, { editor });\r\n  }\r\n\r\n  /**\r\n   * Sets up event listeners for UI interactions\r\n   */\r\n  setupEventListeners() {\r\n    if (this.elements.runBtn) {\r\n      this.elements.runBtn.addEventListener('click', () => this.run());\r\n    }\r\n\r\n    if (this.elements.clearBtn) {\r\n      this.elements.clearBtn.addEventListener('click', () => this.clearConsole());\r\n    }\r\n\r\n    if (this.elements.resetBtn) {\r\n      this.elements.resetBtn.addEventListener('click', () => this.reset());\r\n    }\r\n\r\n    if (this.elements.togglePreview) {\r\n      this.elements.togglePreview.addEventListener('change', (e) => {\r\n        this.elements.previewWrap.classList.toggle('show', e.target.checked);\r\n\r\n        const rightPane = this.elements.app.querySelector('.pane.right');\r\n        if (rightPane) {\r\n          if (e.target.checked) {\r\n            rightPane.classList.add('has-preview');\r\n          } else {\r\n            rightPane.classList.remove('has-preview');\r\n            rightPane.style.gridTemplateRows = '';\r\n          }\r\n        }\r\n      });\r\n    }\r\n\r\n    if (this.elements.librariesBtn) {\r\n      this.elements.librariesBtn.addEventListener('click', () => {\r\n        this.events.emit(EVENTS.LIBRARY_MANAGER_OPEN);\r\n      });\r\n    }\r\n\r\n    if (this.elements.clearConsoleBtn) {\r\n      this.elements.clearConsoleBtn.addEventListener('click', () => {\r\n        this.clearConsole();\r\n      });\r\n    }\r\n\r\n    if (this.elements.shareBtn) {\r\n      this.elements.shareBtn.addEventListener('click', () => {\r\n        this.shareCode();\r\n      });\r\n    }\r\n\r\n    // Set up theme event listeners\r\n    this.setupThemeEventListeners();\r\n\r\n    // Set up editor change event listeners\r\n    this.setupEditorEventListeners();\r\n\r\n    // Set up share event listeners\r\n    this.setupShareEventListeners();\r\n  }\r\n\r\n  /**\r\n   * Sets up theme-related event listeners\r\n   */\r\n  setupThemeEventListeners() {\r\n    // Listen for theme loading start\r\n    this.events.on(EVENTS.THEME_LOAD_START, (data) => {\r\n      this.logger.info('Theme loading started:', data.theme);\r\n    });\r\n\r\n    // Listen for theme ready\r\n    this.events.on(EVENTS.THEME_READY, (data) => {\r\n      this.logger.info('Theme ready:', data.theme);\r\n      if (data.error) {\r\n        this.logger.warn('Theme ready with error:', data.error);\r\n      }\r\n    });\r\n\r\n    // Listen for theme changes\r\n    this.events.on(EVENTS.THEME_CHANGE, (data) => {\r\n      this.logger.info('Theme changed from', data.oldTheme, 'to', data.theme);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Sets up editor-related event listeners\r\n   */\r\n  setupEditorEventListeners() {\r\n    // Listen for editor changes\r\n    this.events.on(EVENTS.EDITOR_CHANGE, async (data) => {\r\n      this.logger.info('Editor change requested:', data);\r\n      await this.switchEditor(data.editor, data.oldEditor);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Sets up share-related event listeners\r\n   */\r\n  setupShareEventListeners() {\r\n    this.events.on(EVENTS.SHARE_SUCCESS, (data) => {\r\n      this.updateStatus('Share link copied to clipboard!');\r\n      this.logger.info('Share successful:', data);\r\n    });\r\n\r\n    this.events.on(EVENTS.SHARE_ERROR, (data) => {\r\n      this.updateStatus('Failed to share code');\r\n      this.logger.error('Share failed:', data);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Shares the current code\r\n   */\r\n  async shareCode() {\r\n    if (!this.editor || !this.shareManager) {\r\n      this.logger.error('Cannot share: editor or share manager not available');\r\n      return;\r\n    }\r\n\r\n    const code = this.editor.getValue();\r\n    if (!code.trim()) {\r\n      this.updateStatus('No code to share');\r\n      return;\r\n    }\r\n\r\n    this.updateStatus('Generating share link...');\r\n    await this.shareManager.shareCode(code);\r\n  }\r\n\r\n  /**\r\n   * Switches to a different editor\r\n   * @param {string} editorName - The editor to switch to\r\n   * @param {string} oldEditor - The previous editor name\r\n   */\r\n  async switchEditor(editorName, oldEditor) {\r\n    this.logger.info('Switching editor from', oldEditor, 'to', editorName);\r\n\r\n    // Save current code before switching\r\n    const currentCode = this.editor ? this.editor.getValue() : '';\r\n\r\n    // Destroy current editor\r\n    if (this.editor) {\r\n      this.editor.destroy();\r\n      this.editor = null;\r\n    }\r\n\r\n    // Create new editor\r\n    const editorContainer = this.elements.editorContainer;\r\n    if (!editorContainer) {\r\n      throw new Error('Editor container not found');\r\n    }\r\n\r\n    // Clear container\r\n    editorContainer.innerHTML = '';\r\n\r\n    // Import and create the appropriate editor\r\n    let newEditor;\r\n    try {\r\n      if (editorName === 'ace') {\r\n        const { ACEEditor } = await import('../editors/ace.js');\r\n        newEditor = new ACEEditor(editorContainer, {\r\n          mode: 'javascript',\r\n          theme: this.themeSwitcher ? this.themeSwitcher.getCurrentTheme() : 'monokai',\r\n          autofocus: true,\r\n          debug: this.options.debug\r\n        }, this.events);\r\n      } else if (editorName === 'codemirror') {\r\n        const { CodeMirrorEditor } = await import('../editors/codemirror.js');\r\n        newEditor = new CodeMirrorEditor(editorContainer, {\r\n          mode: 'javascript',\r\n          theme: this.themeSwitcher ? this.themeSwitcher.getCurrentTheme() : 'darcula',\r\n          autofocus: true,\r\n          debug: this.options.debug\r\n        }, this.events);\r\n      } else {\r\n        const { TextareaEditor } = await import('../editors/textarea.js');\r\n        newEditor = new TextareaEditor(editorContainer, {\r\n          autofocus: true,\r\n          debug: this.options.debug\r\n        }, this.events);\r\n      }\r\n\r\n      // Set up the new editor\r\n      this.setEditor(newEditor);\r\n\r\n      // Restore code\r\n      if (currentCode) {\r\n        this.editor.setValue(currentCode);\r\n      }\r\n\r\n      this.logger.info('Editor switched successfully to:', editorName);\r\n      this.events.emit(EVENTS.EDITOR_CHANGED, { editor: editorName, oldEditor: oldEditor });\r\n\r\n    } catch (error) {\r\n      this.logger.error('Failed to switch editor:', error);\r\n      // Fallback to textarea\r\n      const { TextareaEditor } = await import('../editors/textarea.js');\r\n      this.editor = new TextareaEditor(editorContainer, {\r\n        autofocus: true,\r\n        debug: this.options.debug\r\n      }, this.events);\r\n      this.setEditor(this.editor);\r\n      if (currentCode) {\r\n        this.editor.setValue(currentCode);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Loads initial code into the editor\r\n   */\r\n  loadInitialCode() {\r\n    let initialCode = this.options.defaultCode;\r\n    let fromStorage = false;\r\n    let fromShare = false;\r\n\r\n    // Check for shared script in URL first\r\n    if (this.shareManager && this.shareManager.hasScriptInUrl()) {\r\n      const sharedCode = this.shareManager.extractScriptFromUrl();\r\n      if (sharedCode) {\r\n        initialCode = sharedCode;\r\n        fromShare = true;\r\n        this.logger.info('Loaded code from share URL');\r\n        \r\n        // Clean up the URL after loading\r\n        this.shareManager.cleanupUrl();\r\n      }\r\n    }\r\n\r\n    // Fallback to saved code if no shared script\r\n    if (!fromShare) {\r\n      const savedCode = this.storage ? this.storage.load() : null;\r\n      if (savedCode) {\r\n        initialCode = savedCode;\r\n        fromStorage = true;\r\n      }\r\n    }\r\n\r\n    if (this.editor) {\r\n      this.editor.setValue(initialCode);\r\n      this.editor.focus();\r\n      this.events.emit(EVENTS.CODE_LOAD, { \r\n        code: initialCode, \r\n        fromStorage, \r\n        fromShare \r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Runs the current code in the sandbox\r\n   */\r\n  async run() {\r\n    if (!this.editor) {\r\n      this.logger.error('No editor configured');\r\n      return;\r\n    }\r\n\r\n    const code = this.editor.getValue();\r\n    this.events.emit(EVENTS.CODE_EXECUTE_START, { code });\r\n\r\n    // Validate syntax first\r\n    const validation = this.sandbox.validateSyntax(code);\r\n    this.events.emit(EVENTS.CODE_VALIDATE, { code, validation });\r\n\r\n    this.console.clear();\r\n\r\n    // Auto-open preview when running code\r\n    if (this.elements.togglePreview && !this.elements.togglePreview.checked) {\r\n      this.elements.togglePreview.checked = true;\r\n      this.elements.previewWrap.classList.add('show');\r\n      \r\n      const rightPane = this.elements.app.querySelector('.pane.right');\r\n      if (rightPane) {\r\n        rightPane.classList.add('has-preview');\r\n      }\r\n    }\r\n\r\n    // On mobile, enter fullscreen console mode after running code\r\n    if (isMobile(MOBILE_BREAKPOINT)) {\r\n      this.enterConsoleFullscreenOnMobile();\r\n    }\r\n\r\n    // Prepare library data for injection (async)\r\n    let libraryData = null;\r\n    if (this.libraryManager) {\r\n      const libraries = this.libraryManager.getLibraries();\r\n      if (libraries.length > 0) {\r\n        // Show loading status for libraries\r\n        this.updateStatus(`Loading ${libraries.length} libraries...`);\r\n\r\n        try {\r\n          this.logger.debug('Generating library scripts...');\r\n          const scripts = await this.libraryManager.generateScriptTags();\r\n          const csp = this.libraryManager.generateCSP();\r\n\r\n          libraryData = { scripts, csp };\r\n          this.logger.debug('Library data prepared successfully');\r\n        } catch (error) {\r\n          this.logger.error('Failed to prepare library data:', error);\r\n          this.updateStatus('Library loading failed');\r\n          // Continue without libraries\r\n        }\r\n      }\r\n    }\r\n\r\n    this.sandbox.execute(code, libraryData);\r\n  }\r\n\r\n  /**\r\n   * Enters fullscreen console mode on mobile devices when running code\r\n   */\r\n  enterConsoleFullscreenOnMobile() {\r\n    if (this.fullscreenManager && !this.fullscreenManager.isFullscreen()) {\r\n      this.logger.debug('Entering console fullscreen mode on mobile after run');\r\n      this.fullscreenManager.setFullscreenMode('console');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clears the console output\r\n   */\r\n  clearConsole() {\r\n    this.console.clear();\r\n    this.updateStatus(STATUS_MESSAGES.cleared);\r\n    this.events.emit(EVENTS.CONSOLE_CLEAR);\r\n  }\r\n\r\n  /**\r\n   * Resets the sandbox\r\n   */\r\n  reset() {\r\n    this.sandbox.reset();\r\n    this.updateStatus(STATUS_MESSAGES.reset);\r\n    this.events.emit(EVENTS.SANDBOX_RESET);\r\n  }\r\n\r\n  /**\r\n   * Updates the status display\r\n   * @param {string} status - Status message or key\r\n   */\r\n  updateStatus(status) {\r\n    if (!this.elements.status) return;\r\n\r\n    const displayStatus = STATUS_MESSAGES[status] || status;\r\n    this.elements.status.textContent = displayStatus;\r\n    this.events.emit(EVENTS.STATUS_CHANGE, { status, displayStatus });\r\n\r\n    // Emit specific status events\r\n    if (status === 'completed') {\r\n      this.events.emit(EVENTS.CODE_EXECUTE_COMPLETE);\r\n    } else if (status === 'timeout') {\r\n      this.events.emit(EVENTS.CODE_EXECUTE_TIMEOUT);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Registers an event listener\r\n   * @param {string} event - The event name\r\n   * @param {Function} callback - The callback function\r\n   * @param {Object} [options={}] - Options for the listener\r\n   * @returns {Function} Unsubscribe function\r\n   */\r\n  on(event, callback, options) {\r\n    return this.events.on(event, callback, options);\r\n  }\r\n\r\n  /**\r\n   * Registers a one-time event listener\r\n   * @param {string} event - The event name\r\n   * @param {Function} callback - The callback function\r\n   * @returns {Function} Unsubscribe function\r\n   */\r\n  once(event, callback) {\r\n    return this.events.once(event, callback);\r\n  }\r\n\r\n  /**\r\n   * Removes an event listener\r\n   * @param {string} event - The event name\r\n   * @param {Function} callback - The callback function\r\n   */\r\n  off(event, callback) {\r\n    this.events.off(event, callback);\r\n  }\r\n\r\n  /**\r\n   * Gets the current code from the editor\r\n   * @returns {string|null} The current code or null if no editor\r\n   */\r\n  getCode() {\r\n    return this.editor ? this.editor.getValue() : null;\r\n  }\r\n\r\n  /**\r\n   * Sets code in the editor\r\n   * @param {string} code - The code to set\r\n   */\r\n  setCode(code) {\r\n    if (this.editor) {\r\n      this.editor.setValue(code);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Validates JavaScript syntax without executing\r\n   * @param {string} [code] - The code to validate, or current editor code if not provided\r\n   * @returns {Object} Validation result with {valid: boolean, error?: string}\r\n   */\r\n  validateCode(code) {\r\n    const codeToValidate = code || this.getCode();\r\n    return this.sandbox ? \r\n      this.sandbox.validateSyntax(codeToValidate) : \r\n      { valid: false, error: 'Sandbox not initialized' };\r\n  }\r\n\r\n  /**\r\n   * Loads and runs an example\r\n   * @param {string} exampleId - The example ID to load\r\n   * @returns {Promise<void>}\r\n   */\r\n  async loadExample(exampleId) {\r\n    try {\r\n      this.logger.info('Loading example:', exampleId);\r\n\r\n      const example = await this.examples.loadExample(exampleId);\r\n\r\n      // Set the code in the editor\r\n      this.setCode(example.code);\r\n\r\n      // Open preview pane\r\n      if (this.elements.togglePreview && !this.elements.togglePreview.checked) {\r\n        this.elements.togglePreview.checked = true;\r\n        this.elements.previewWrap.classList.add('show');\r\n\r\n        const rightPane = this.elements.app.querySelector('.pane.right');\r\n        if (rightPane) {\r\n          rightPane.classList.add('has-preview');\r\n        }\r\n      }\r\n\r\n      // Run the example\r\n      this.run();\r\n\r\n      this.events.emit(EVENTS.EXAMPLE_LOADED, { exampleId, example });\r\n    } catch (error) {\r\n      this.logger.error('Failed to load example:', error);\r\n      this.events.emit(EVENTS.EXAMPLE_ERROR, error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Cleans up the controller and all components\r\n   */\r\n  destroy() {\r\n    this.logger.info('Destroying controller...');\r\n    \r\n    this.events.emit(EVENTS.DESTROY);\r\n\r\n    if (this.editor) {\r\n      this.editor.destroy();\r\n      this.editor = null;\r\n    }\r\n\r\n    if (this.sandbox) {\r\n      this.sandbox.destroy();\r\n      this.sandbox = null;\r\n    }\r\n\r\n    if (this.examples) {\r\n      this.examples.destroy();\r\n      this.examples = null;\r\n    }\r\n\r\n    if (this.examplesDropdown) {\r\n      this.examplesDropdown.destroy();\r\n      this.examplesDropdown = null;\r\n    }\r\n\r\n    if (this.themeSwitcher) {\r\n      this.themeSwitcher.destroy();\r\n      this.themeSwitcher = null;\r\n    }\r\n\r\n    if (this.editorSwitcher) {\r\n      this.editorSwitcher.destroy();\r\n      this.editorSwitcher = null;\r\n    }\r\n\r\n    if (this.neonGlow) {\r\n      this.neonGlow.destroy();\r\n      this.neonGlow = null;\r\n    }\r\n\r\n    if (this.fullscreenManager) {\r\n      this.fullscreenManager.destroy();\r\n      this.fullscreenManager = null;\r\n    }\r\n\r\n    if (this.libraryManager) {\r\n      this.libraryManager.destroy();\r\n      this.libraryManager = null;\r\n    }\r\n\r\n    if (this.libraryDialog) {\r\n      this.libraryDialog.destroy();\r\n      this.libraryDialog = null;\r\n    }\r\n\r\n    if (this.shareManager) {\r\n      this.shareManager = null; // ShareManager doesn't need explicit cleanup\r\n    }\r\n\r\n    // Cleanup resize handlers\r\n    this.cleanupResizeHandlers();\r\n\r\n    // Cleanup responsive listener\r\n    if (this.responsiveListener) {\r\n      this.responsiveListener.mediaQuery.removeListener(this.responsiveListener.handleChange);\r\n      this.responsiveListener = null;\r\n    }\r\n\r\n    this.events.removeAllListeners();\r\n    this.isInitialized = false;\r\n    \r\n    this.logger.info('Controller destroyed');\r\n  }\r\n}\r\n","import {\r\n  MIN_LEFT_PANE_WIDTH,\r\n  MIN_RIGHT_PANE_WIDTH,\r\n  MIN_CONSOLE_HEIGHT,\r\n  MIN_PREVIEW_HEIGHT,\r\n  RESIZE_HANDLE_WIDTH\r\n} from '../core/constants.js';\r\n\r\n/**\r\n * Shared resize functionality for panes\r\n * @author Joao Guilherme (Guinetik) <guinetik@gmail.com>\r\n */\r\n\r\n/**\r\n * Creates a horizontal resize handler\r\n * @param {Object} config - Configuration object\r\n * @param {HTMLElement} config.container - Container element\r\n * @param {HTMLElement} config.leftPane - Left pane element\r\n * @param {HTMLElement} config.rightPane - Right pane element\r\n * @param {HTMLElement} config.handle - Resize handle element\r\n * @param {Function} config.onResize - Callback when resize completes\r\n * @returns {Object} Handler functions and cleanup\r\n */\r\nexport function createHorizontalResizeHandler(config) {\r\n  const { container, leftPane, rightPane, handle, onResize } = config;\r\n\r\n  let isResizing = false;\r\n  let startX = 0;\r\n  let startLeftWidth = 0;\r\n  let startRightWidth = 0;\r\n\r\n  const handleStart = (e) => {\r\n    isResizing = true;\r\n    // Support both mouse and touch events\r\n    const clientX = e.clientX || (e.touches && e.touches[0].clientX);\r\n    startX = clientX;\r\n    handle.classList.add('dragging');\r\n\r\n    startLeftWidth = leftPane.getBoundingClientRect().width;\r\n    startRightWidth = rightPane.getBoundingClientRect().width;\r\n\r\n    document.body.style.userSelect = 'none';\r\n    document.body.style.cursor = 'col-resize';\r\n\r\n    e.preventDefault();\r\n  };\r\n\r\n  const handleMove = (e) => {\r\n    if (!isResizing) return;\r\n\r\n    // Support both mouse and touch events\r\n    const clientX = e.clientX || (e.touches && e.touches[0].clientX);\r\n    const deltaX = clientX - startX;\r\n    const containerRect = container.getBoundingClientRect();\r\n    const totalWidth = containerRect.width - RESIZE_HANDLE_WIDTH - 10; // Subtract handle and padding\r\n\r\n    // Calculate new widths with constraints\r\n    const newLeftWidth = Math.max(\r\n      MIN_LEFT_PANE_WIDTH,\r\n      Math.min(totalWidth - MIN_RIGHT_PANE_WIDTH, startLeftWidth + deltaX)\r\n    );\r\n    const newRightWidth = totalWidth - newLeftWidth;\r\n\r\n    // Update grid template\r\n    container.style.gridTemplateColumns = `${newLeftWidth}px ${RESIZE_HANDLE_WIDTH}px ${newRightWidth}px`;\r\n\r\n    e.preventDefault();\r\n  };\r\n\r\n  const handleEnd = () => {\r\n    if (!isResizing) return;\r\n\r\n    isResizing = false;\r\n    handle.classList.remove('dragging');\r\n\r\n    document.body.style.userSelect = '';\r\n    document.body.style.cursor = '';\r\n\r\n    if (onResize) onResize();\r\n  };\r\n\r\n  // Add both mouse and touch event listeners\r\n  handle.addEventListener('mousedown', handleStart);\r\n  handle.addEventListener('touchstart', handleStart);\r\n  document.addEventListener('mousemove', handleMove);\r\n  document.addEventListener('touchmove', handleMove);\r\n  document.addEventListener('mouseup', handleEnd);\r\n  document.addEventListener('touchend', handleEnd);\r\n\r\n  return {\r\n    handleStart,\r\n    handleMove,\r\n    handleEnd,\r\n    cleanup: () => {\r\n      handle.removeEventListener('mousedown', handleStart);\r\n      handle.removeEventListener('touchstart', handleStart);\r\n      document.removeEventListener('mousemove', handleMove);\r\n      document.removeEventListener('touchmove', handleMove);\r\n      document.removeEventListener('mouseup', handleEnd);\r\n      document.removeEventListener('touchend', handleEnd);\r\n    }\r\n  };\r\n}\r\n\r\n/**\r\n * Creates a vertical resize handler\r\n * @param {Object} config - Configuration object\r\n * @param {HTMLElement} config.container - Container element\r\n * @param {HTMLElement} config.topPane - Top pane element\r\n * @param {HTMLElement} config.bottomPane - Bottom pane element\r\n * @param {HTMLElement} config.handle - Resize handle element\r\n * @param {Function} config.onResize - Callback when resize completes\r\n * @param {Function} config.shouldResize - Optional function to check if resize should proceed\r\n * @returns {Object} Handler functions and cleanup\r\n */\r\nexport function createVerticalResizeHandler(config) {\r\n  const { container, topPane, bottomPane, handle, onResize, shouldResize } = config;\r\n  \r\n  let isResizing = false;\r\n  let startY = 0;\r\n  let startTopHeight = 0;\r\n  let startBottomHeight = 0;\r\n\r\n  const handleStart = (e) => {\r\n    // Check if resizing is allowed\r\n    if (shouldResize && !shouldResize()) return;\r\n\r\n    isResizing = true;\r\n    // Support both mouse and touch events\r\n    const clientY = e.clientY || (e.touches && e.touches[0].clientY);\r\n    startY = clientY;\r\n    handle.classList.add('dragging');\r\n\r\n    const topRect = topPane.getBoundingClientRect();\r\n    const bottomRect = bottomPane.getBoundingClientRect();\r\n\r\n    startTopHeight = topRect.height;\r\n    startBottomHeight = bottomRect.height;\r\n\r\n    document.body.style.userSelect = 'none';\r\n    document.body.style.cursor = 'row-resize';\r\n\r\n    e.preventDefault();\r\n  };\r\n\r\n  const handleMove = (e) => {\r\n    if (!isResizing) return;\r\n\r\n    // Support both mouse and touch events\r\n    const clientY = e.clientY || (e.touches && e.touches[0].clientY);\r\n    const deltaY = clientY - startY;\r\n    const totalContentHeight = startTopHeight + startBottomHeight;\r\n\r\n    // Calculate new heights with constraints\r\n    const newTopHeight = Math.max(\r\n      MIN_CONSOLE_HEIGHT,\r\n      Math.min(totalContentHeight - MIN_PREVIEW_HEIGHT, startTopHeight + deltaY)\r\n    );\r\n    const newBottomHeight = totalContentHeight - newTopHeight;\r\n\r\n    // Update grid template\r\n    container.style.gridTemplateRows = `auto ${newTopHeight}px 8px ${newBottomHeight}px auto`;\r\n\r\n    e.preventDefault();\r\n  };\r\n\r\n  const handleEnd = () => {\r\n    if (!isResizing) return;\r\n\r\n    isResizing = false;\r\n    handle.classList.remove('dragging');\r\n\r\n    document.body.style.userSelect = '';\r\n    document.body.style.cursor = '';\r\n\r\n    if (onResize) onResize();\r\n  };\r\n\r\n  // Add both mouse and touch event listeners\r\n  handle.addEventListener('mousedown', handleStart);\r\n  handle.addEventListener('touchstart', handleStart);\r\n  document.addEventListener('mousemove', handleMove);\r\n  document.addEventListener('touchmove', handleMove);\r\n  document.addEventListener('mouseup', handleEnd);\r\n  document.addEventListener('touchend', handleEnd);\r\n\r\n  return {\r\n    handleStart,\r\n    handleMove,\r\n    handleEnd,\r\n    cleanup: () => {\r\n      handle.removeEventListener('mousedown', handleStart);\r\n      handle.removeEventListener('touchstart', handleStart);\r\n      document.removeEventListener('mousemove', handleMove);\r\n      document.removeEventListener('touchmove', handleMove);\r\n      document.removeEventListener('mouseup', handleEnd);\r\n      document.removeEventListener('touchend', handleEnd);\r\n    }\r\n  };\r\n}\r\n","import { EditorAdapter } from './base.js';\r\nimport { Logger } from '../core/logger.js';\r\n\r\n/**\r\n * ACE editor adapter with syntax highlighting and advanced features\r\n * @author Joao Guilherme (Guinetik) <guinetik@gmail.com>\r\n */\r\nexport class ACEEditor extends EditorAdapter {\r\n  /**\r\n   * Creates a new ACEEditor instance\r\n   * @param {HTMLElement} container - DOM element to contain the editor\r\n   * @param {Object} [options={}] - Editor configuration options\r\n   * @param {string} [options.mode='javascript'] - ACE language mode\r\n   * @param {string} [options.theme='monokai'] - ACE theme\r\n   * @param {boolean} [options.autofocus=true] - Whether to autofocus the editor\r\n   * @param {boolean} [options.autocomplete=true] - Enable autocomplete\r\n   * @param {Object} [eventEmitter] - Event emitter for listening to global events\r\n   */\r\n  constructor(container, options = {}, eventEmitter = null) {\r\n    super(container, options, eventEmitter);\r\n    this.editor = null;\r\n    this.currentTheme = options.theme || 'monokai';\r\n\r\n    this.logger = new Logger({\r\n      enabled: true,\r\n      level: 'info',\r\n      prefix: 'ACEEditor'\r\n    });\r\n\r\n    this.logger.info('ACE editor initialized with theme:', this.currentTheme);\r\n    this.logger.info('Event emitter provided:', !!eventEmitter);\r\n\r\n    this.init();\r\n  }\r\n\r\n  /**\r\n   * Initializes the ACE editor instance\r\n   * @throws {Error} If ACE is not loaded\r\n   */\r\n  init() {\r\n    if (typeof ace === 'undefined') {\r\n      throw new Error('ACE is not loaded. Include ACE before using this adapter.');\r\n    }\r\n\r\n    // Create editor element\r\n    const editorElement = document.createElement('div');\r\n    editorElement.style.cssText = `\r\n      width: 100%;\r\n      height: 100%;\r\n      min-height: 300px;\r\n    `;\r\n    this.container.appendChild(editorElement);\r\n\r\n    // Initialize ACE editor\r\n    this.editor = ace.edit(editorElement);\r\n    \r\n    // Configure editor\r\n    this.editor.setTheme(`ace/theme/${this.currentTheme}`);\r\n    this.editor.session.setMode('ace/mode/javascript');\r\n    this.editor.setOptions({\r\n      fontSize: '14px',\r\n      showPrintMargin: false,\r\n      showGutter: true,\r\n      highlightActiveLine: true,\r\n      enableBasicAutocompletion: this.options.autocomplete !== false,\r\n      enableLiveAutocompletion: this.options.autocomplete !== false,\r\n      enableSnippets: true,\r\n      wrap: true,\r\n      tabSize: 2,\r\n      useSoftTabs: true,\r\n      behavioursEnabled: true,\r\n      wrapBehavioursEnabled: true\r\n    });\r\n\r\n    // Set up keyboard shortcuts\r\n    this.editor.commands.addCommand({\r\n      name: 'executeCode',\r\n      bindKey: { win: 'Ctrl-Enter', mac: 'Cmd-Enter' },\r\n      exec: () => this.triggerExecute()\r\n    });\r\n\r\n    // Set up event listeners\r\n    this.editor.on('change', () => {\r\n      this.triggerChange();\r\n    });\r\n\r\n    // Apply glass effect on initial load\r\n    this.applyGlassEffect(this.currentTheme);\r\n\r\n    // Focus if requested\r\n    if (this.options.autofocus !== false) {\r\n      this.editor.focus();\r\n    }\r\n\r\n    this.logger.info('ACE editor initialized successfully');\r\n  }\r\n\r\n  /**\r\n   * Gets the current code value from ACE\r\n   * @returns {string} The current code\r\n   */\r\n  getValue() {\r\n    return this.editor ? this.editor.getValue() : '';\r\n  }\r\n\r\n  /**\r\n   * Sets the code value in ACE\r\n   * @param {string} code - The code to set\r\n   */\r\n  setValue(code) {\r\n    if (this.editor) {\r\n      this.editor.setValue(code, -1); // -1 means move cursor to start\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Focuses the ACE editor\r\n   */\r\n  focus() {\r\n    if (this.editor) {\r\n      this.editor.focus();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handles theme change events\r\n   * @param {string} newTheme - The new theme name\r\n   * @param {string} oldTheme - The previous theme name\r\n   */\r\n  onThemeChange(newTheme, oldTheme) {\r\n    this.logger.info('onThemeChange called with:', { newTheme, oldTheme });\r\n    this.logger.info('Current theme before change:', this.currentTheme);\r\n    this.logger.info('ACE editor instance exists:', !!this.editor);\r\n\r\n    if (this.editor && newTheme !== this.currentTheme) {\r\n      this.logger.info('Applying theme change from', this.currentTheme, 'to', newTheme);\r\n      this.currentTheme = newTheme;\r\n      this.editor.setTheme(`ace/theme/${newTheme}`);\r\n      this.logger.info('Theme applied successfully');\r\n\r\n      // Apply glass glow effect by reducing background opacity\r\n      this.applyGlassEffect(newTheme);\r\n    } else {\r\n      this.logger.warn('Theme change skipped. Reasons:');\r\n      this.logger.warn('- ACE editor exists:', !!this.editor);\r\n      this.logger.warn('- New theme different from current:', newTheme !== this.currentTheme);\r\n      this.logger.warn('- New theme value:', newTheme);\r\n      this.logger.warn('- Current theme value:', this.currentTheme);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Applies glass effect by reducing ACE background opacity\r\n   * @param {string} theme - The current theme name\r\n   */\r\n  applyGlassEffect(theme) {\r\n    // Wait for theme to be applied, then modify background opacity\r\n    setTimeout(() => {\r\n      const aceElement = this.container.querySelector('.ace_editor');\r\n      if (aceElement) {\r\n        this.logger.info('Applying glass effect for theme:', theme);\r\n\r\n        // Get the computed background color from the theme\r\n        const computedStyle = window.getComputedStyle(aceElement);\r\n        const backgroundColor = computedStyle.backgroundColor;\r\n        this.logger.info('Original background color:', backgroundColor);\r\n\r\n        // Parse the color and reduce opacity to 70%\r\n        const reducedOpacityColor = this.reduceColorOpacity(backgroundColor, 0.7);\r\n        this.logger.info('Reduced opacity color:', reducedOpacityColor);\r\n\r\n        // Create or update style element for glass effect\r\n        let styleElement = document.getElementById('ace-glass-effect');\r\n        if (!styleElement) {\r\n          styleElement = document.createElement('style');\r\n          styleElement.id = 'ace-glass-effect';\r\n          document.head.appendChild(styleElement);\r\n        }\r\n\r\n        // Apply reduced opacity background to let glow show through\r\n        styleElement.textContent = `\r\n          .ace_editor {\r\n            background-color: ${reducedOpacityColor} !important;\r\n          }\r\n          .ace_gutter {\r\n            background-color: ${this.reduceColorOpacity(backgroundColor, 0.8)} !important;\r\n          }\r\n        `;\r\n\r\n        this.logger.info('Glass effect applied with reduced opacity background');\r\n      }\r\n    }, 200); // Slightly longer delay to ensure theme CSS is fully loaded\r\n  }\r\n\r\n  /**\r\n   * Reduces the opacity of a CSS color value\r\n   * @param {string} color - The CSS color value (rgb, rgba, hex, etc.)\r\n   * @param {number} opacity - The target opacity (0-1)\r\n   * @returns {string} The color with reduced opacity in rgba format\r\n   */\r\n  reduceColorOpacity(color, opacity) {\r\n    // Handle rgba format\r\n    const rgbaMatch = color.match(/rgba?\\((\\d+),\\s*(\\d+),\\s*(\\d+)(?:,\\s*([\\d.]+))?\\)/);\r\n    if (rgbaMatch) {\r\n      const [, r, g, b] = rgbaMatch;\r\n      return `rgba(${r}, ${g}, ${b}, ${opacity})`;\r\n    }\r\n\r\n    // Handle rgb format\r\n    const rgbMatch = color.match(/rgb\\((\\d+),\\s*(\\d+),\\s*(\\d+)\\)/);\r\n    if (rgbMatch) {\r\n      const [, r, g, b] = rgbMatch;\r\n      return `rgba(${r}, ${g}, ${b}, ${opacity})`;\r\n    }\r\n\r\n    // Handle hex format\r\n    const hexMatch = color.match(/^#([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i);\r\n    if (hexMatch) {\r\n      const r = parseInt(hexMatch[1], 16);\r\n      const g = parseInt(hexMatch[2], 16);\r\n      const b = parseInt(hexMatch[3], 16);\r\n      return `rgba(${r}, ${g}, ${b}, ${opacity})`;\r\n    }\r\n\r\n    // Fallback for other formats or if parsing fails\r\n    this.logger.warn('Could not parse color:', color, 'using fallback');\r\n    return `rgba(0, 0, 0, ${opacity})`;\r\n  }\r\n\r\n  /**\r\n   * Gets the current theme\r\n   * @returns {string} Current theme name\r\n   */\r\n  getCurrentTheme() {\r\n    return this.currentTheme;\r\n  }\r\n\r\n  /**\r\n   * Sets the theme programmatically\r\n   * @param {string} theme - Theme name to set\r\n   */\r\n  setTheme(theme) {\r\n    if (this.editor && theme !== this.currentTheme) {\r\n      this.currentTheme = theme;\r\n      this.editor.setTheme(`ace/theme/${theme}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Apply a transformation to the ACE editor\r\n   * @param {Object} transformation - Transformation to apply\r\n   */\r\n  applyTransformation(transformation) {\r\n    this.logger.debug('Applying transformation:', transformation);\r\n\r\n    const cursor = this.editor.getCursorPosition();\r\n\r\n    switch (transformation.action) {\r\n      case 'insert':\r\n        this.editor.insert(transformation.text);\r\n        if (transformation.cursorOffset !== undefined) {\r\n          const newCursor = this.editor.getCursorPosition();\r\n          this.editor.moveCursorTo(newCursor.row, newCursor.column + transformation.cursorOffset);\r\n        }\r\n        break;\r\n\r\n      case 'skip':\r\n        this.editor.moveCursorTo(cursor.row, cursor.column + transformation.positions);\r\n        break;\r\n\r\n      case 'deleteRange':\r\n        const range = new ace.Range(\r\n          cursor.row, transformation.start,\r\n          cursor.row, transformation.end\r\n        );\r\n        this.editor.session.remove(range);\r\n        break;\r\n\r\n      default:\r\n        this.logger.warn('Unknown transformation action:', transformation.action);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Cleans up the ACE editor\r\n   */\r\n  destroy() {\r\n    if (this.editor) {\r\n      this.editor.destroy();\r\n      this.editor = null;\r\n    }\r\n  }\r\n}\r\n","import { EditorAdapter } from './base.js';\r\n\r\n/**\r\n * Plain textarea editor adapter for basic code editing\r\n * @author Joao Guilherme (Guinetik) <guinetik@gmail.com>\r\n */\r\nexport class TextareaEditor extends EditorAdapter {\r\n  /**\r\n   * Creates a new TextareaEditor instance\r\n   * @param {HTMLElement} container - DOM element to contain the editor\r\n   * @param {Object} [options={}] - Editor configuration options\r\n   * @param {string} [options.placeholder] - Placeholder text for the textarea\r\n   * @param {Object} [eventEmitter] - Event emitter for listening to global events\r\n   */\r\n  constructor(container, options = {}, eventEmitter = null) {\r\n    super(container, options, eventEmitter);\r\n    this.textarea = null;\r\n    this.init();\r\n  }\r\n\r\n  /**\r\n   * Initializes the textarea editor\r\n   */\r\n  init() {\r\n    this.textarea = document.createElement('textarea');\r\n    this.textarea.className = 'code-editor';\r\n    this.textarea.spellcheck = false;\r\n    this.textarea.placeholder = this.options.placeholder || 'Enter your JavaScript code here...';\r\n\r\n    this.container.appendChild(this.textarea);\r\n    this.setupEventListeners();\r\n  }\r\n\r\n  /**\r\n   * Sets up event listeners for the textarea\r\n   */\r\n  setupEventListeners() {\r\n    this.textarea.addEventListener('input', () => {\r\n      this.triggerChange();\r\n    });\r\n\r\n    this.textarea.addEventListener('keydown', (e) => {\r\n      if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {\r\n        e.preventDefault();\r\n        this.triggerExecute();\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Gets the current code value from the textarea\r\n   * @returns {string} The current code\r\n   */\r\n  getValue() {\r\n    return this.textarea.value;\r\n  }\r\n\r\n  /**\r\n   * Sets the code value in the textarea\r\n   * @param {string} code - The code to set\r\n   */\r\n  setValue(code) {\r\n    this.textarea.value = code;\r\n  }\r\n\r\n  /**\r\n   * Focuses the textarea\r\n   */\r\n  focus() {\r\n    this.textarea.focus();\r\n  }\r\n\r\n  /**\r\n   * Cleans up the textarea editor\r\n   */\r\n  destroy() {\r\n    if (this.textarea) {\r\n      this.textarea.remove();\r\n    }\r\n  }\r\n}","/**\r\n * JavaScript Sandbox - A secure, isolated JavaScript execution environment\r\n * @author Joao Guilherme (Guinetik) <guinetik@gmail.com>\r\n */\r\n\r\nimport { SandboxController } from './ui/controller.js';\r\nimport { ACEEditor } from './editors/ace.js';\r\nimport { CodeMirrorEditor } from './editors/codemirror.js';\r\nimport { TextareaEditor } from './editors/textarea.js';\r\nimport { Logger } from './core/logger.js';\r\n\r\n/**\r\n * Auto-detects and initializes the best available editor\r\n * @param {HTMLElement} container - DOM element to contain the editor\r\n * @param {Object} [options={}] - Editor configuration options\r\n * @param {Object} [eventEmitter] - Event emitter for theme changes\r\n * @returns {EditorAdapter} The initialized editor instance\r\n */\r\nfunction createEditor(container, options = {}, eventEmitter = null) {\r\n  const logger = new Logger({\r\n    enabled: options.debug || false,\r\n    level: 'info',\r\n    prefix: 'EditorFactory'\r\n  });\r\n\r\n  // Check for saved editor preference\r\n  const savedEditor = localStorage.getItem('sandbox_current_editor');\r\n  logger.info('Saved editor preference:', savedEditor);\r\n\r\n  // Try saved editor first if available\r\n  if (savedEditor === 'ace' && typeof ace !== 'undefined') {\r\n    try {\r\n      logger.info('Initializing saved ACE editor');\r\n      return new ACEEditor(container, options, eventEmitter);\r\n    } catch (e) {\r\n      logger.warn('Failed to initialize saved ACE, falling back:', e);\r\n    }\r\n  } else if (savedEditor === 'codemirror' && typeof CodeMirror !== 'undefined') {\r\n    try {\r\n      logger.info('Initializing saved CodeMirror editor');\r\n      return new CodeMirrorEditor(container, options, eventEmitter);\r\n    } catch (e) {\r\n      logger.warn('Failed to initialize saved CodeMirror, falling back:', e);\r\n    }\r\n  } else if (savedEditor === 'textarea') {\r\n    try {\r\n      logger.info('Initializing saved textarea editor');\r\n      return new TextareaEditor(container, options, eventEmitter);\r\n    } catch (e) {\r\n      logger.warn('Failed to initialize saved textarea, falling back:', e);\r\n    }\r\n  }\r\n\r\n  // Fallback: Try ACE first if available\r\n  if (typeof ace !== 'undefined') {\r\n    try {\r\n      logger.info('Initializing ACE editor (fallback)');\r\n      return new ACEEditor(container, options, eventEmitter);\r\n    } catch (e) {\r\n      logger.warn('Failed to initialize ACE, falling back to textarea:', e);\r\n    }\r\n  }\r\n\r\n  // Final fallback to textarea\r\n  logger.info('Initializing textarea editor (final fallback)');\r\n  return new TextareaEditor(container, options, eventEmitter);\r\n}\r\n\r\n/**\r\n * Initializes the JavaScript sandbox application\r\n * @param {Object} [options={}] - Configuration options\r\n * @param {number} [options.timeLimit] - Execution timeout in milliseconds\r\n * @param {string} [options.storageKey] - LocalStorage key for persistence\r\n * @param {string} [options.defaultCode] - Default code to load\r\n * @param {boolean} [options.debug=false] - Enable debug logging\r\n * @param {string} [options.logLevel='info'] - Log level for debugging\r\n * @param {string} [options.templatePath] - Path to custom sandbox template\r\n * @returns {Promise<SandboxController>} The initialized sandbox controller\r\n */\r\nexport async function initSandbox(options = {}) {\r\n  const debug = options.debug || false;\r\n  const logger = new Logger({\r\n    enabled: debug,\r\n    level: options.logLevel || 'info',\r\n    prefix: 'App'\r\n  });\r\n\r\n  try {\r\n    logger.info('Starting sandbox initialization...');\r\n\r\n    // Create controller\r\n    const controller = new SandboxController(options);\r\n    \r\n    // Initialize controller (now properly awaited)\r\n    await controller.init();\r\n    logger.info('Controller initialized');\r\n\r\n    // Find editor container\r\n    const editorContainer = document.getElementById('editorContainer');\r\n    if (!editorContainer) {\r\n      throw new Error('Editor container element not found');\r\n    }\r\n\r\n    // Create editor with event emitter for theme switching\r\n    // Start with default theme, will be updated when ThemeSwitcher emits THEME_READY\r\n    const editor = createEditor(editorContainer, {\r\n      mode: 'javascript',\r\n      theme: 'monokai', // Temporary default, will be updated by THEME_READY event\r\n      autofocus: true,\r\n      debug: debug\r\n    }, controller.getEventEmitter());\r\n    logger.info('Editor created, waiting for theme ready event');\r\n\r\n    // Set editor on controller\r\n    controller.setEditor(editor);\r\n    logger.info('Editor set on controller');\r\n    \r\n    logger.info('Sandbox initialization complete');\r\n    return controller;\r\n  } catch (error) {\r\n    logger.error('Sandbox initialization failed:', error);\r\n    throw error;\r\n  }\r\n}\r\n\r\n/**\r\n * Auto-initializes the sandbox if DOM is ready\r\n */\r\nfunction autoInit() {\r\n  // Only auto-init if not already initialized and editor container exists\r\n  if (!window.sandbox && document.getElementById('editorContainer')) {\r\n    initSandbox({ debug: true, logLevel: 'trace' })\r\n      .then(sandbox => {\r\n        window.sandbox = sandbox;\r\n        console.log('✅ Sandbox initialized successfully');\r\n      })\r\n      .catch(error => {\r\n        console.error('❌ Failed to initialize sandbox:', error);\r\n      });\r\n  }\r\n}\r\n\r\n// Auto-initialize based on document state\r\nif (document.readyState === 'loading') {\r\n  document.addEventListener('DOMContentLoaded', autoInit);\r\n} else {\r\n  // DOM already loaded\r\n  autoInit();\r\n}\r\n\r\n// Export for manual initialization\r\nexport { SandboxController, ACEEditor, CodeMirrorEditor, TextareaEditor };\r\n"],"file":"assets/index-NSGOTdEp.js"}