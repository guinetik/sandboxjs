import{L as e,E as t,C as i,S as s}from"./core-D_qm-Uej.js";import{E as o,C as n}from"./vendor-DmI2F1iK.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const i of e)if("childList"===i.type)for(const e of i.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();class r{constructor(e="js-sandbox-code"){this.key=e}save(e){try{localStorage.setItem(this.key,e)}catch(t){console.warn("Failed to save code to localStorage:",t)}}load(){try{return localStorage.getItem(this.key)}catch(e){return console.warn("Failed to load code from localStorage:",e),null}}}class a{constructor(e={}){this.examplesPath=e.examplesPath||"./examples",this.onLoad=e.onLoad||(()=>{}),this.onError=e.onError||(()=>{}),this.examples=new Map}async discoverExamples(){const e=[{id:"hello-world",title:"üëã Hello World",description:"Simple greeting with interactive button",file:"hello-world.js"},{id:"spinning-animation",title:"üåÄ CSS Animations",description:"Spinning box with rainbow colors and controls",file:"spinning-animation.js"},{id:"interactive-form",title:"üìù Interactive Form",description:"Form validation and submission handling",file:"interactive-form.js"},{id:"canvas-drawing",title:"üé® Canvas Drawing",description:"Draw with mouse or touch on HTML5 canvas",file:"canvas-drawing.js"}],t=[];for(const s of e)try{const e=await fetch(`${this.examplesPath}/${s.file}`);if(e.ok){const i=await e.text();this.examples.set(s.id,{...s,code:i}),t.push(s)}}catch(i){console.warn(`Example ${s.id} not available:`,i)}return t}async loadExample(e){if(this.examples.has(e)){const t=this.examples.get(e);return this.onLoad(t),t}try{await this.discoverExamples();const t=this.examples.get(e);if(t)return this.onLoad(t),t;throw new Error(`Example '${e}' not found`)}catch(t){throw this.onError(t),t}}getAvailableExamples(){return Array.from(this.examples.values())}clearCache(){this.examples.clear()}}class l{constructor(e,t={}){this.container=e,this.onSelect=t.onSelect||(()=>{}),this.examples=[],this.createDropdown()}createDropdown(){const e=this.container.querySelector(".examples-dropdown");e&&e.remove(),this.dropdown=document.createElement("select"),this.dropdown.className="examples-dropdown",this.dropdown.innerHTML='<option value="">üìö Load Example...</option>',this.dropdown.addEventListener("change",e=>{const t=e.target.value;t&&(this.onSelect(t),setTimeout(()=>{this.dropdown.value=""},100))});const t=this.container.querySelector("label.btn");t?this.container.insertBefore(this.dropdown,t):this.container.appendChild(this.dropdown)}setExamples(e){this.examples=e,this.dropdown.innerHTML='<option value="">üìö Load Example...</option>',e.forEach(e=>{const t=document.createElement("option");t.value=e.id,t.textContent=e.title,t.title=e.description,this.dropdown.appendChild(t)}),this.dropdown.disabled=0===e.length}setLoading(e=!0){e?(this.dropdown.innerHTML='<option value="">‚è≥ Loading examples...</option>',this.dropdown.disabled=!0):(this.dropdown.innerHTML='<option value="">üìö Load Example...</option>',this.dropdown.disabled=!1)}setError(e="Failed to load examples"){this.dropdown.innerHTML=`<option value="">‚ùå ${e}</option>`,this.dropdown.disabled=!0}destroy(){this.dropdown&&this.dropdown.parentNode&&this.dropdown.parentNode.removeChild(this.dropdown)}}class d{constructor(i={}){this.options={timeLimit:4e3,storageKey:"js-sandbox-code",defaultCode:this.getDefaultCode(),debug:!1,logLevel:"info",...i},this.logger=new e({enabled:this.options.debug,level:this.options.logLevel,prefix:"Controller"}),this.events=new t,this.editor=null,this.sandbox=null,this.console=null,this.storage=null,this.examples=null,this.examplesDropdown=null,this.elements={},this.init()}getDefaultCode(){return["// Welcome to JS Sandbox! üôå","//","// Tips:","//  - Use console.log/info/warn/error","//  - Ctrl/Cmd+Enter to execute",'//  - "Reset" kills stuck executions',"//","// Examples:",'console.log("Hello, sandbox!");',"function noReturn() { var x = 1+1; }","noReturn(); // no return value, all good","","// DOM inside sandbox:",'var el = document.createElement("h1");','el.textContent = "Hello from iframe!";',"document.body.appendChild(el);","","// Errors:",'Promise.reject("rejected!");','// throw new Error("Exception thrown");',"","// Infinite loop test (commented):","// while(true) {}"].join("\n")}async init(){this.events.emit("init:start"),this.findElements(),await this.initializeComponents(),this.setupEventListeners(),this.events.emit("init:complete")}findElements(){this.elements={app:document.querySelector(".app"),editorContainer:document.getElementById("editorContainer"),consoleContainer:document.getElementById("console"),sandboxContainer:document.getElementById("sandboxContainer"),runBtn:document.getElementById("runBtn"),clearBtn:document.getElementById("clearBtn"),resetBtn:document.getElementById("resetBtn"),togglePreview:document.getElementById("togglePreview"),previewWrap:document.getElementById("previewWrap"),status:document.getElementById("status"),limitLabel:document.getElementById("limitLabel"),toolbar:document.querySelector(".toolbar")}}async initializeComponents(){if(this.logger.info("Initializing components..."),this.storage=new r(this.options.storageKey),this.logger.debug("Storage initialized"),this.console=new i(this.elements.consoleContainer),this.logger.debug("Console initialized"),this.sandbox=new s(this.elements.sandboxContainer,{timeLimit:this.options.timeLimit,debug:this.options.debug,logLevel:this.options.logLevel,onMessage:(e,t)=>{this.console.addLine(e,t),this.events.emit("console:message",{type:e,args:t})},onStatusChange:e=>this.updateStatus(e)}),this.logger.debug("SandboxEngine created"),await this.sandbox.initialize(),this.logger.info("Sandbox initialized"),this.examples=new a({onLoad:e=>this.events.emit("example:load",e),onError:e=>this.events.emit("example:error",e)}),this.elements.toolbar&&!this.examplesDropdown){this.examplesDropdown=new l(this.elements.toolbar,{onSelect:e=>this.loadExample(e)});try{this.examplesDropdown.setLoading(!0);const e=await this.examples.discoverExamples();this.examplesDropdown.setExamples(e),this.logger.info("Examples loaded:",e.length)}catch(t){this.logger.error("Failed to load examples:",t),this.examplesDropdown.setError()}}this.elements.limitLabel&&(this.elements.limitLabel.textContent=this.options.timeLimit+"ms"),this.initializeResizer();const e=this.elements.app.querySelector(".pane.right");if(e&&this.elements.previewWrap){const t=this.elements.previewWrap.classList.contains("show");e.classList.toggle("has-preview",t)}this.logger.info("Components initialization complete")}initializeResizer(){if(!this.elements.app)return;this.elements.app.querySelectorAll(".resize-handle, .vertical-resize-handle").forEach(e=>e.remove());const e=this.elements.app.querySelector(".main-content");e.style.gridTemplateColumns="",e.style.gridTemplateRows="";const t=e.querySelector(".pane:last-child");t&&(t.style.gridTemplateRows="",t.classList.remove("preview-hidden"));const i=document.createElement("div");i.className="resize-handle";const s=e.querySelectorAll(".pane");s.length>=2&&e.insertBefore(i,s[1]);let o=!1,n=0,r=0;const a=e=>{o=!0,n=e.clientX,i.classList.add("dragging"),this.elements.app.getBoundingClientRect(),i.getBoundingClientRect();const t=s[0],a=s[1];r=t.getBoundingClientRect().width,a.getBoundingClientRect().width,document.body.style.userSelect="none",document.body.style.cursor="col-resize",e.preventDefault()},l=t=>{if(!o)return;const i=t.clientX-n,s=e.getBoundingClientRect().width-25,a=Math.max(320,Math.min(s-420,r+i)),l=s-a;e.style.gridTemplateColumns=`${a}px 5px ${l}px`,t.preventDefault()},d=()=>{o&&(o=!1,i.classList.remove("dragging"),document.body.style.userSelect="",document.body.style.cursor="",this.events.emit("panes:resized"))};i.addEventListener("mousedown",a),document.addEventListener("mousemove",l),document.addEventListener("mouseup",d),this.resizeHandle=i,this.resizeListeners={handleMouseDown:a,handleMouseMove:l,handleMouseUp:d},this.initializeVerticalResize()}initializeVerticalResize(){const e=this.elements.app.querySelector(".pane.right");if(!e)return;const t=document.createElement("div");t.className="vertical-resize-handle";const i=e.querySelector(".console");i&&i.parentNode.insertBefore(t,i.nextSibling);let s=!1,o=0,n=0,r=0;const a=e=>{if(!this.elements.previewWrap.classList.contains("show"))return;s=!0,o=e.clientY,t.classList.add("dragging");const a=i.getBoundingClientRect(),l=this.elements.previewWrap.getBoundingClientRect();n=a.height,r=l.height,document.body.style.userSelect="none",document.body.style.cursor="row-resize",e.preventDefault()},l=t=>{if(!s)return;const i=t.clientY-o,a=n+r,l=Math.max(100,Math.min(a-100,n+i)),d=a-l;e.style.gridTemplateRows=`auto ${l}px 8px ${d}px auto`,t.preventDefault()},d=()=>{s&&(s=!1,t.classList.remove("dragging"),document.body.style.userSelect="",document.body.style.cursor="",this.events.emit("panes:resized:vertical"))};t.addEventListener("mousedown",a),document.addEventListener("mousemove",l),document.addEventListener("mouseup",d),this.verticalResizeHandle=t,this.verticalResizeListeners={handleMouseDown:a,handleMouseMove:l,handleMouseUp:d}}setEditor(e){this.editor&&this.editor.destroy(),this.editor=e,this.editor.onChange(e=>{this.storage.save(e),this.events.emit("code:change",{code:e})}),this.editor.onExecute(()=>{this.run()}),this.loadInitialCode(),this.events.emit("editor:ready",{editor:e})}setupEventListeners(){this.elements.runBtn&&this.elements.runBtn.addEventListener("click",()=>this.run()),this.elements.clearBtn&&this.elements.clearBtn.addEventListener("click",()=>this.clearConsole()),this.elements.resetBtn&&this.elements.resetBtn.addEventListener("click",()=>this.reset()),this.elements.togglePreview&&this.elements.togglePreview.addEventListener("change",e=>{this.elements.previewWrap.classList.toggle("show",e.target.checked);const t=this.elements.app.querySelector(".pane.right");t&&(e.target.checked?t.classList.add("has-preview"):(t.classList.remove("has-preview"),t.style.gridTemplateRows=""))})}loadInitialCode(){const e=this.storage.load(),t=e||this.options.defaultCode;this.editor&&(this.editor.setValue(t),this.editor.focus(),this.events.emit("code:load",{code:t,fromStorage:!!e}))}run(){if(!this.editor)return void console.error("No editor configured");const e=this.editor.getValue();this.events.emit("code:execute:start",{code:e});const t=this.sandbox.validateSyntax(e);this.events.emit("code:validate",{code:e,validation:t}),this.console.clear(),this.sandbox.execute(e)}clearConsole(){this.console.clear(),this.updateStatus("Console cleared"),this.events.emit("console:clear")}reset(){this.sandbox.reset(),this.updateStatus("Sandbox reset"),this.events.emit("sandbox:reset")}updateStatus(e){if(!this.elements.status)return;const t={executing:"Executing‚Ä¶",completed:"Completed",timeout:"Timeout exceeded",reset:"Sandbox reset","Console cleared":"Console cleared"}[e]||e;this.elements.status.textContent=t,this.events.emit("status:change",{status:e,displayStatus:t}),"completed"===e?this.events.emit("code:execute:complete"):"timeout"===e&&this.events.emit("code:execute:timeout")}on(e,t,i){return this.events.on(e,t,i)}once(e,t){return this.events.once(e,t)}off(e,t){this.events.off(e,t)}getCode(){return this.editor?this.editor.getValue():null}setCode(e){this.editor&&this.editor.setValue(e)}validateCode(e){const t=e||this.getCode();return this.sandbox?this.sandbox.validateSyntax(t):{valid:!1,error:"Sandbox not initialized"}}async loadExample(e){try{this.logger.info("Loading example:",e);const t=await this.examples.loadExample(e);if(this.setCode(t.code),this.elements.togglePreview&&!this.elements.togglePreview.checked){this.elements.togglePreview.checked=!0,this.elements.previewWrap.classList.add("show");const e=this.elements.app.querySelector(".pane.right");e&&e.classList.add("has-preview")}this.run(),this.events.emit("example:loaded",{exampleId:e,example:t})}catch(t){this.logger.error("Failed to load example:",t),this.events.emit("example:error",t)}}destroy(){this.events.emit("destroy"),this.editor&&this.editor.destroy(),this.sandbox&&this.sandbox.destroy(),this.examplesDropdown&&this.examplesDropdown.destroy(),this.resizeListeners&&(document.removeEventListener("mousemove",this.resizeListeners.handleMouseMove),document.removeEventListener("mouseup",this.resizeListeners.handleMouseUp)),this.verticalResizeListeners&&(document.removeEventListener("mousemove",this.verticalResizeListeners.handleMouseMove),document.removeEventListener("mouseup",this.verticalResizeListeners.handleMouseUp)),this.resizeHandle&&this.resizeHandle.parentNode&&this.resizeHandle.parentNode.removeChild(this.resizeHandle),this.verticalResizeHandle&&this.verticalResizeHandle.parentNode&&this.verticalResizeHandle.parentNode.removeChild(this.verticalResizeHandle),this.events.removeAllListeners()}}class c extends o{constructor(e,t={}){super(e,t),this.textarea=null,this.init()}init(){this.textarea=document.createElement("textarea"),this.textarea.className="code-editor",this.textarea.spellcheck=!1,this.textarea.placeholder=this.options.placeholder||"Enter your JavaScript code here...",this.container.appendChild(this.textarea),this.setupEventListeners()}setupEventListeners(){this.textarea.addEventListener("input",()=>{this.triggerChange()}),this.textarea.addEventListener("keydown",e=>{(e.ctrlKey||e.metaKey)&&"Enter"===e.key&&(e.preventDefault(),this.triggerExecute())})}getValue(){return this.textarea.value}setValue(e){this.textarea.value=e}focus(){this.textarea.focus()}destroy(){this.textarea&&this.textarea.remove()}}async function h(e={}){e.debug;const t=console;t.log("[App] Starting sandbox initialization...");const i=new d(e);await i.init(),t.log("[App] Controller initialized");const s=document.getElementById("editorContainer");if(!s)throw new Error("Editor container element not found");const o=function(e,t={}){if("undefined"!=typeof CodeMirror)try{return new n(e,t)}catch(i){console.warn("Failed to initialize CodeMirror, falling back to textarea:",i)}return new c(e,t)}(s,{mode:"javascript",theme:"darcula",autofocus:!0});return t.log("[App] Editor created"),i.setEditor(o),t.log("[App] Editor set on controller"),t.log("[App] Sandbox initialization complete"),i}!window.sandbox&&document.getElementById("editorContainer")&&("loading"===document.readyState?document.addEventListener("DOMContentLoaded",async()=>{!window.sandbox&&document.getElementById("editorContainer")&&(window.sandbox=await h())}):h().then(e=>{window.sandbox=e}));
//# sourceMappingURL=index-Cn4x0xvH.js.map
