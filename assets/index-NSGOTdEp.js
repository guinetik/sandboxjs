import{f as e,E as t,C as i,S as r,i as o}from"./core-B-sNhaEt.js";import{c as s,L as n,d as a,N as l,E as d,e as h,R as c,M as g,f as u,g as m,h as p,b as f,i as b,S as v,j as E,k as w}from"./vendor-CiEMj8hI.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const i of e)if("childList"===i.type)for(const e of i.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const y={},L=function(e,t,i){let r=Promise.resolve();if(t&&t.length>0){let e=function(e){return Promise.all(e.map(e=>Promise.resolve(e).then(e=>({status:"fulfilled",value:e}),e=>({status:"rejected",reason:e}))))};document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),o=i?.nonce||i?.getAttribute("nonce");r=e(t.map(e=>{if((e=function(e){return"/sandboxjs/"+e}(e))in y)return;y[e]=!0;const t=e.endsWith(".css"),i=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${i}`))return;const r=document.createElement("link");return r.rel=t?"stylesheet":"modulepreload",t||(r.as="script"),r.crossOrigin="",r.href=e,o&&r.setAttribute("nonce",o),document.head.appendChild(r),t?new Promise((t,i)=>{r.addEventListener("load",t),r.addEventListener("error",()=>i(new Error(`Unable to preload CSS for ${e}`)))}):void 0}))}function o(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return r.then(t=>{for(const e of t||[])"rejected"===e.status&&o(e.reason);return e().catch(o)})};class C{constructor(e=s,t={}){this.key=e,this.logger=new n({enabled:t.debug||!1,level:"warn",prefix:"Storage"})}save(e){try{return localStorage.setItem(this.key,e),!0}catch(t){return this.logger.warn("Failed to save code to localStorage:",t),!1}}load(){try{return localStorage.getItem(this.key)}catch(e){return this.logger.warn("Failed to load code from localStorage:",e),null}}clear(){try{return localStorage.removeItem(this.key),!0}catch(e){return this.logger.warn("Failed to clear localStorage:",e),!1}}}class S{constructor(e={}){this.examplesPath=e.examplesPath||a,this.onLoad=e.onLoad||(()=>{}),this.onError=e.onError||(()=>{}),this.examples=new Map,this.logger=new n({enabled:e.debug||!1,level:"info",prefix:"ExamplesLoader"})}async discoverExamples(){const t=[{id:"hello-world",title:"üëã Hello World",description:"Simple greeting with interactive button",file:"hello-world.js"},{id:"spinning-animation",title:"üåÄ CSS Animations",description:"Spinning box with rainbow colors and controls",file:"spinning-animation.js"},{id:"interactive-form",title:"üìù Interactive Form",description:"Form validation and submission handling",file:"interactive-form.js"},{id:"canvas-drawing",title:"üé® Canvas Drawing",description:"Draw with mouse or touch on HTML5 canvas",file:"canvas-drawing.js"},{id:"jquery-basics",title:"üîß jQuery Basics",description:"Basic jQuery DOM manipulation and event handling",file:"jquery-basics.js"},{id:"jquery-demo",title:"üé® jQuery Demo",description:"Advanced jQuery features: animations, plugins, and effects",file:"jquery-demo.js"},{id:"jquery-ajax",title:"üåê jQuery AJAX",description:"jQuery AJAX calls, API integration, and data handling",file:"jquery-ajax.js"}],i=[];this.logger.info(`Discovering examples from: ${this.examplesPath}`);for(const o of t)try{const t=`${this.examplesPath}/${o.file}`;this.logger.debug(`Fetching example: ${t}`);const r=await e(t,{},l);if(r.ok){const e=await r.text();this.examples.set(o.id,{...o,code:e}),i.push(o),this.logger.debug(`‚úì Example loaded: ${o.id}`)}else this.logger.warn(`‚úó Example ${o.id} returned ${r.status}`)}catch(r){this.logger.warn(`‚úó Example ${o.id} failed:`,r.message)}return this.logger.info(`Discovered ${i.length} of ${t.length} examples`),i}async loadExample(e){if(this.examples.has(e)){const t=this.examples.get(e);return this.onLoad(t),t}try{await this.discoverExamples();const t=this.examples.get(e);if(t)return this.onLoad(t),t;throw new Error(`Example '${e}' not found`)}catch(t){throw this.logger.error("Failed to load example:",t),this.onError(t),t}}getAvailableExamples(){return Array.from(this.examples.values())}clearCache(){this.logger.debug("Clearing examples cache"),this.examples.clear()}destroy(){this.logger.debug("Destroying examples loader"),this.clearCache()}}class x{constructor(e,t={}){this.container=e,this.onSelect=t.onSelect||(()=>{}),this.examples=[],this.createDropdown()}createDropdown(){const e=this.container.querySelector(".examples-dropdown");e&&e.remove(),this.dropdown=document.createElement("select"),this.dropdown.className="examples-dropdown",this.dropdown.innerHTML='<option value="">üìö Load Example...</option>',this.dropdown.addEventListener("change",e=>{const t=e.target.value;t&&(this.onSelect(t),setTimeout(()=>{this.dropdown.value=""},100))});const t=this.container.querySelector("label.btn");t?this.container.insertBefore(this.dropdown,t.nextSibling):this.container.appendChild(this.dropdown)}setExamples(e){this.examples=e,this.dropdown.innerHTML='<option value="">üìö Load Example...</option>',e.forEach(e=>{const t=document.createElement("option");t.value=e.id,t.textContent=e.title,t.title=e.description,this.dropdown.appendChild(t)}),this.dropdown.disabled=0===e.length}setLoading(e=!0){e?(this.dropdown.innerHTML='<option value="">‚è≥ Loading examples...</option>',this.dropdown.disabled=!0):(this.dropdown.innerHTML='<option value="">üìö Load Example...</option>',this.dropdown.disabled=!1)}setError(e="Failed to load examples"){this.dropdown.innerHTML=`<option value="">‚ùå ${e}</option>`,this.dropdown.disabled=!0}destroy(){this.dropdown&&this.dropdown.parentNode&&this.dropdown.parentNode.removeChild(this.dropdown)}}class T{constructor(e,t,i={}){this.container=e,this.eventEmitter=t,this.options={defaultTheme:"monokai",debug:!0,storageKey:"sandbox_current_theme",...i},this.logger=new n({enabled:this.options.debug,level:"info",prefix:"ThemeSwitcher"});const r=localStorage.getItem("sandbox_current_editor")||"ace";this.logger.info("Initializing theme switcher with saved editor:",r),this.themes=T.getThemesForEditor(r),this.currentTheme=this.loadSavedTheme()||this.options.defaultTheme,this.logger.info("Initializing theme switcher with theme:",this.currentTheme),this.createDropdown(),this.initializeCurrentTheme(),this.setupEditorChangeListener()}setupEditorChangeListener(){this.eventEmitter&&this.eventEmitter.on(d.EDITOR_CHANGE,async e=>{this.logger.info("Editor changed, refreshing theme list:",e),await this.refreshThemesForEditor(e.editor)})}static getThemesForEditor(e){switch(e){case"ace":default:return h.ACE;case"codemirror":return h.CODEMIRROR;case"textarea":return h.TEXTAREA}}async refreshThemesForEditor(e){if(this.logger.info("Refreshing themes for editor:",e),this.themes=T.getThemesForEditor(e),this.populateThemes(),this.themes.find(e=>e.value===this.currentTheme))this.dropdown.value=this.currentTheme,this.logger.info("Re-applying current theme for new editor:",this.currentTheme),await this.switchTheme(this.currentTheme);else{const e=this.themes[0].value;this.logger.info("Current theme not available in new editor, switching to:",e),await this.switchTheme(e)}}async initializeCurrentTheme(){this.logger.info("Initializing current theme:",this.currentTheme),this.eventEmitter.emit(d.THEME_LOAD_START,{theme:this.currentTheme});try{await this.loadThemeCSS(this.currentTheme),this.logger.info("Current theme CSS loaded:",this.currentTheme),this.eventEmitter.emit(d.THEME_READY,{theme:this.currentTheme})}catch(e){this.logger.warn("Failed to load current theme CSS:",e),this.eventEmitter.emit(d.THEME_READY,{theme:"darcula",error:e.message})}}createDropdown(){const e=this.container.querySelector(".theme-switcher");e&&e.remove(),this.dropdown=document.createElement("select"),this.dropdown.className="theme-switcher examples-dropdown",this.dropdown.title="Switch editor theme",this.populateThemes(),this.dropdown.value=this.currentTheme,this.dropdown.addEventListener("change",async e=>{const t=e.target.value;this.logger.info("Theme dropdown changed to:",t),this.logger.info("Current theme is:",this.currentTheme),t&&t!==this.currentTheme?(this.logger.info("Switching theme from",this.currentTheme,"to",t),await this.switchTheme(t)):this.logger.warn("Theme value is empty or same as current theme")});const t=this.container.querySelector(".examples-dropdown"),i=this.container.querySelector("label.btn");t?this.container.insertBefore(this.dropdown,t.nextSibling):i?this.container.insertBefore(this.dropdown,i.nextSibling):this.container.appendChild(this.dropdown)}populateThemes(){this.dropdown.innerHTML="",this.themes.forEach(e=>{const t=document.createElement("option");t.value=e.value,t.textContent=e.label,this.dropdown.appendChild(t)})}async loadThemeCSS(e){if(this.logger.info("ACE theme loading for:",e),"undefined"==typeof ace)throw new Error("ACE editor not loaded");try{const t=`ace/theme/${e}`;if(ace.require&&ace.require(t))return void this.logger.info("ACE theme is available:",e)}catch(t){this.logger.warn("ACE theme may not be loaded:",e,t)}return this.logger.info("Assuming ACE theme is available:",e),Promise.resolve()}loadSavedTheme(){try{const e=localStorage.getItem(this.options.storageKey);if(e&&this.themes.find(t=>t.value===e))return this.logger.info("Loaded saved theme from storage:",e),e}catch(e){this.logger.warn("Failed to load saved theme:",e)}return null}saveTheme(e){try{localStorage.setItem(this.options.storageKey,e),this.logger.info("Saved theme to storage:",e)}catch(t){this.logger.warn("Failed to save theme:",t)}}async switchTheme(e){const t=this.currentTheme;this.currentTheme=e,this.logger.info("switchTheme called: changing from",t,"to",e),this.dropdown.value=e,this.logger.info("Dropdown value updated to:",this.dropdown.value);try{await this.loadThemeCSS(e),this.saveTheme(e),this.logger.info("Emitting theme change event with data:",{theme:e,oldTheme:t}),this.eventEmitter.emit(d.THEME_CHANGE,{theme:e,oldTheme:t}),this.logger.info("Theme change event emitted successfully")}catch(i){this.logger.error("Failed to switch theme:",i),this.dropdown.value=t,this.currentTheme=t}}getCurrentTheme(){return this.currentTheme}setTheme(e){this.themes.find(t=>t.value===e)&&this.switchTheme(e)}addTheme(e,t){this.themes.find(t=>t.value===e)||(this.themes.push({value:e,label:t}),this.populateThemes(),this.dropdown.value=this.currentTheme)}destroy(){this.dropdown&&this.dropdown.parentNode&&this.dropdown.parentNode.removeChild(this.dropdown)}}class R{constructor(e,t,i={}){this.container=e,this.eventEmitter=t,this.options={defaultEditor:"ace",debug:!0,storageKey:"sandbox_current_editor",...i},this.logger=new n({enabled:this.options.debug,level:"info",prefix:"EditorSwitcher"}),this.editors=[{value:"ace",label:"üéØ ACE Editor",available:()=>"undefined"!=typeof ace},{value:"codemirror",label:"üìù CodeMirror",available:()=>"undefined"!=typeof CodeMirror},{value:"textarea",label:"üìÑ Textarea",available:()=>!0}],this.currentEditor=this.loadSavedEditor()||this.options.defaultEditor,this.logger.info("Initializing editor switcher with editor:",this.currentEditor),this.createDropdown()}createDropdown(){const e=this.container.querySelector(".editor-switcher");e&&e.remove(),this.dropdown=document.createElement("select"),this.dropdown.className="editor-switcher examples-dropdown",this.dropdown.title="Switch editor (ACE, CodeMirror, Textarea)",this.populateEditors(),this.dropdown.value=this.currentEditor,this.dropdown.addEventListener("change",async e=>{const t=e.target.value;this.logger.info("Editor dropdown changed to:",t),this.logger.info("Current editor is:",this.currentEditor),t&&t!==this.currentEditor?(this.logger.info("Switching editor from",this.currentEditor,"to",t),await this.switchEditor(t)):this.logger.warn("Editor value is empty or same as current editor")}),this.container.appendChild(this.dropdown)}populateEditors(){this.dropdown.innerHTML="",this.editors.forEach(e=>{if(e.available()){const t=document.createElement("option");t.value=e.value,t.textContent=e.label,this.dropdown.appendChild(t)}else this.logger.debug("Editor not available:",e.value)});const e=this.editors.filter(e=>e.available());e.length>0&&!this.editors.find(e=>e.value===this.currentEditor)?.available()&&(this.logger.warn("Current editor not available, falling back to:",e[0].value),this.currentEditor=e[0].value,this.dropdown.value=this.currentEditor)}loadSavedEditor(){try{const e=localStorage.getItem(this.options.storageKey);if(e&&this.editors.find(t=>t.value===e&&t.available()))return this.logger.info("Loaded saved editor from storage:",e),e}catch(e){this.logger.warn("Failed to load saved editor:",e)}return null}saveEditor(e){try{localStorage.setItem(this.options.storageKey,e),this.logger.info("Saved editor to storage:",e)}catch(t){this.logger.warn("Failed to save editor:",t)}}async switchEditor(e){const t=this.currentEditor;this.currentEditor=e,this.logger.info("switchEditor called: changing from",t,"to",e),this.dropdown.value=e,this.logger.info("Dropdown value updated to:",this.dropdown.value);try{this.saveEditor(e),this.logger.info("Emitting editor change event with data:",{editor:e,oldEditor:t}),this.eventEmitter.emit(d.EDITOR_CHANGE,{editor:e,oldEditor:t}),this.logger.info("Editor change event emitted successfully")}catch(i){this.logger.error("Failed to switch editor:",i),this.dropdown.value=t,this.currentEditor=t}}getCurrentEditor(){return this.currentEditor}setEditor(e){this.editors.find(t=>t.value===e&&t.available())&&this.switchEditor(e)}refreshEditors(){this.logger.info("Refreshing editor list"),this.populateEditors(),this.dropdown.value=this.currentEditor}destroy(){this.dropdown&&this.dropdown.parentNode&&this.dropdown.parentNode.removeChild(this.dropdown)}}class D{constructor(e,t={}){this.eventEmitter=e,this.options={debug:!1,...t},this.logger=new n({enabled:this.options.debug,level:"info",prefix:"FullscreenManager"}),this.currentMode=null,this.appElement=null,this.elements={},this.isChanging=!1,this.setupEventListeners()}init(e){this.appElement=e.app,this.elements=e,this.logger.info("Fullscreen manager initialized"),this.elements.fullscreenEditor&&this.elements.fullscreenEditor.addEventListener("click",()=>{this.toggleFullscreen("editor")}),this.elements.fullscreenConsole&&this.elements.fullscreenConsole.addEventListener("click",()=>{this.toggleFullscreen("console")}),document.addEventListener("keydown",e=>{"F11"===e.key?(e.preventDefault(),this.toggleFullscreen()):"Escape"===e.key&&this.currentMode&&this.exitFullscreen()})}setupEventListeners(){this.eventEmitter.on(d.FULLSCREEN_TOGGLE,e=>{this.toggleFullscreen(e)}),this.eventEmitter.on(d.FULLSCREEN_EXIT,()=>{this.exitFullscreen()})}toggleFullscreen(e){this.appElement?(e||(e=null===this.currentMode?"editor":"editor"===this.currentMode?"console":null),e===this.currentMode&&(e=null),this.setFullscreenMode(e)):this.logger.warn("App element not initialized")}setFullscreenMode(e){if(!this.appElement)return;if(this.isChanging||e===this.currentMode)return;this.isChanging=!0;const t=this.currentMode;try{this.appElement.classList.remove("fullscreen-editor","fullscreen-console"),this.updateButtonStates(null),e?(this.appElement.classList.add(`fullscreen-${e}`),this.updateButtonStates(e),this.logger.info(`Entering fullscreen mode: ${e}`),this.eventEmitter.emit(`FULLSCREEN_${e.toUpperCase()}`,{mode:e})):t&&(this.logger.info("Exiting fullscreen mode"),this.eventEmitter.emit(d.FULLSCREEN_EXIT,{previousMode:t})),this.currentMode=e}finally{this.isChanging=!1}}updateButtonStates(e){this.elements.fullscreenEditor&&("editor"===e?(this.elements.fullscreenEditor.textContent="‚ó±",this.elements.fullscreenEditor.title="Exit Fullscreen"):(this.elements.fullscreenEditor.textContent="‚õ∂",this.elements.fullscreenEditor.title="Fullscreen Editor")),this.elements.fullscreenConsole&&("console"===e?(this.elements.fullscreenConsole.textContent="‚ó±",this.elements.fullscreenConsole.title="Exit Fullscreen"):(this.elements.fullscreenConsole.textContent="‚õ∂",this.elements.fullscreenConsole.title="Fullscreen Console"))}exitFullscreen(){this.setFullscreenMode(null)}getCurrentMode(){return this.currentMode}isFullscreen(){return null!==this.currentMode}destroy(){this.exitFullscreen(),this.logger.info("Fullscreen manager destroyed")}}class A{constructor(e,t={}){this.eventEmitter=e,this.options={debug:!1,storageKey:"sandbox_libraries",allowlistKey:"sandbox_allowed_domains",...t},this.logger=new n({enabled:this.options.debug,level:"info",prefix:"LibraryManager"}),console.log("üîß LibraryManager created with debug:",this.options.debug),this.defaultDomains=["cdnjs.cloudflare.com","unpkg.com","jsdelivr.net","code.jquery.com","stackpath.bootstrapcdn.com"],this.libraries=[],this.allowedDomains=[],this.libraryCache=new Map,this.loadFromStorage(),this.setupEventListeners()}setupEventListeners(){this.eventEmitter.on(d.LIBRARY_ADD,e=>{this.addLibrary(e.url,e.name)}),this.eventEmitter.on(d.LIBRARY_REMOVE,e=>{this.removeLibrary(e.id)}),this.eventEmitter.on(d.DOMAIN_TRUST_REQUEST,e=>{this.addDomain(e.domain)})}loadFromStorage(){this.logger.debug("Loading library data from localStorage...");try{this.logger.debug(`Checking localStorage for key: ${this.options.storageKey}`);const e=localStorage.getItem(this.options.storageKey);this.libraries=e?JSON.parse(e):[],this.logger.debug(`Loaded ${this.libraries.length} libraries from storage`),this.logger.debug(`Checking localStorage for key: ${this.options.allowlistKey}`);const t=localStorage.getItem(this.options.allowlistKey),i=t?JSON.parse(t):[];this.allowedDomains=[...new Set([...this.defaultDomains,...i])],this.logger.debug(`Merged domains - defaults: ${this.defaultDomains.length}, saved: ${i.length}, total: ${this.allowedDomains.length}`),this.logger.info(`Storage load complete: ${this.libraries.length} libraries, ${this.allowedDomains.length} allowed domains`),this.libraries.length>0&&this.logger.debug("Loaded libraries:",this.libraries.map(e=>e.name).join(", "))}catch(e){this.logger.error("Failed to load from storage:",e),this.logger.warn("Falling back to empty state with default domains"),this.libraries=[],this.allowedDomains=[...this.defaultDomains]}}saveLibraries(){this.logger.debug(`Saving ${this.libraries.length} libraries to localStorage...`);try{const e=JSON.stringify(this.libraries);localStorage.setItem(this.options.storageKey,e),this.logger.debug(`Libraries saved successfully (${e.length} chars)`)}catch(e){this.logger.error("Failed to save libraries to localStorage:",e),"QuotaExceededError"===e.name&&this.logger.warn("localStorage quota exceeded - consider clearing old data")}}saveDomains(){const e=this.allowedDomains.filter(e=>!this.defaultDomains.includes(e));this.logger.debug(`Saving ${e.length} custom domains to localStorage...`);try{const t=JSON.stringify(e);localStorage.setItem(this.options.allowlistKey,t),this.logger.debug(`Custom domains saved successfully: [${e.join(", ")}]`)}catch(t){this.logger.error("Failed to save domains to localStorage:",t),"QuotaExceededError"===t.name&&this.logger.warn("localStorage quota exceeded - consider clearing old data")}}generateId(){return"lib_"+Date.now()+"_"+Math.random().toString(36).substr(2,9)}extractDomain(e){try{return new URL(e).hostname}catch(t){return this.logger.warn("Invalid URL provided:",e),null}}guessLibraryName(e){try{const t=new URL(e).pathname,i=t.split("/").pop().replace(/\.(min\.)?js$/,""),r=[/^(.+?)[-.][\d]/,/^(.+?)\.min$/,/^(.+?)$/];for(const e of r){const t=i.match(e);if(t&&t[1])return t[1].charAt(0).toUpperCase()+t[1].slice(1)}return i||"Unknown Library"}catch(t){return"Unknown Library"}}extractVersionFromUrl(e){try{const t=new URL(e).pathname,i=t.split("/").pop().replace(/\.(min\.)?js$/,""),r=[/[-.](\d+\.\d+\.\d+(?:\.\d+)?(?:-[a-zA-Z0-9]+)*)/,/[-.](\d+\.\d+\.\d+)/,/[-.](\d+\.\d+)/,/\/(\d+\.\d+\.\d+(?:\.\d+)?(?:-[a-zA-Z0-9]+)*)\//];for(const o of r){const t=e.match(o)||i.match(o);if(t&&t[1])return t[1]}return null}catch(t){return null}}isDomainAllowed(e){return this.allowedDomains.includes(e)}validateLibraryUrl(e){if(!e||"string"!=typeof e)return{valid:!1,error:"URL is required"};const t=this.extractDomain(e);if(!t)return{valid:!1,error:"Invalid URL format"};if(!e.match(/\.js(\?.*)?$/i))return{valid:!1,error:"URL must point to a JavaScript file (.js)"};const i=this.isDomainAllowed(t);return{valid:!0,domain:t,domainAllowed:i,needsDomainApproval:!i}}addLibrary(e,t=null){const i=this.validateLibraryUrl(e);if(!i.valid)return this.logger.warn("Library validation failed:",i.error),{success:!1,error:i.error};if(this.libraries.find(t=>t.url===e))return this.logger.warn("Library already exists:",e),{success:!1,error:"Library already added"};if(i.needsDomainApproval)return this.logger.info("Domain approval needed for:",i.domain),this.eventEmitter.emit(d.DOMAIN_TRUST_REQUEST,{domain:i.domain,url:e,name:t||this.guessLibraryName(e)}),{success:!1,needsApproval:!0,domain:i.domain};const r={id:this.generateId(),name:t||this.guessLibraryName(e),url:e.trim(),domain:i.domain,addedAt:(new Date).toISOString()};return this.libraries.push(r),this.saveLibraries(),this.logger.info("Library added:",r.name),this.eventEmitter.emit(d.LIBRARY_ADDED,{library:r}),{success:!0,library:r}}removeLibrary(e){const t=this.libraries.findIndex(t=>t.id===e);if(-1===t)return this.logger.warn("Library not found for removal:",e),!1;const i=this.libraries.splice(t,1)[0];return this.saveLibraries(),this.logger.info("Library removed:",i.name),this.eventEmitter.emit(d.LIBRARY_REMOVED,{library:i}),!0}addDomain(e){return!(!e||this.allowedDomains.includes(e))&&(this.allowedDomains.push(e),this.saveDomains(),this.logger.info("Domain added to allowlist:",e),this.eventEmitter.emit(d.DOMAIN_ADDED,{domain:e}),!0)}removeDomain(e){if(this.defaultDomains.includes(e))return this.logger.warn("Cannot remove default domain:",e),!1;const t=this.allowedDomains.indexOf(e);return-1!==t&&(this.allowedDomains.splice(t,1),this.saveDomains(),this.logger.info("Domain removed from allowlist:",e),this.eventEmitter.emit(d.DOMAIN_REMOVED,{domain:e}),!0)}getLibraries(){return[...this.libraries]}getAllowedDomains(){return[...this.allowedDomains]}async generateScriptTags(){if(0===this.libraries.length)return this.logger.debug("No libraries to generate scripts for"),"";this.logger.info(`Fetching content for ${this.libraries.length} libraries...`);const e=[];for(const r of this.libraries)try{let t;if(this.libraryCache.has(r.url))this.logger.debug(`Using cached content for: ${r.name}`),t=this.libraryCache.get(r.url);else{this.logger.debug(`Fetching library: ${r.name} from ${r.url}`);const e=await fetch(r.url);if(!e.ok)throw new Error(`HTTP ${e.status}: ${e.statusText}`);t=await e.text(),this.logger.debug(`Fetched ${r.name}: ${t.length} characters`),this.libraryCache.set(r.url,t)}e.push(`  <script data-library="${r.name}">\n/* Library: ${r.name} */\n/* Source: ${r.url} */\n/* Cached: ${(new Date).toISOString()} */\n${t}\n<\/script>`),this.logger.info(`‚úÖ Successfully loaded library: ${r.name}`)}catch(i){this.logger.error(`‚ùå Failed to fetch library ${r.name}:`,i.message),e.push(`  <script data-library="${r.name}">\n/* Library: ${r.name} - FAILED TO LOAD */\n/* Error: ${i.message} */\n/* URL: ${r.url} */\nconsole.error('Failed to load library ${r.name}: ${i.message}');\n<\/script>`)}const t=e.join("\n");if(this.libraries.length>0){const i=this.libraries.map(e=>e.name).join(", ");this.logger.info(`üìö Injecting ${this.libraries.length} libraries into sandbox: ${i}`),this.libraries.forEach(t=>{const i=e.find(e=>e.includes(`data-library="${t.name}"`))?.length||0,r=this.extractVersionFromUrl(t.url),o=r?` v${r}`:"";this.logger.debug(`  ‚Üí ${t.name}${o}: ${(i/1024).toFixed(1)}KB from ${t.url}`)}),this.logger.info(`üì¶ Total script injection size: ${(t.length/1024).toFixed(1)}KB`)}else this.logger.debug("No libraries to inject into sandbox");return t}generateCSP(){return`default-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob:; script-src ${["'self'","'unsafe-inline'","'unsafe-eval'",...this.allowedDomains.map(e=>`https://${e}`)].join(" ")}; connect-src 'none';`}getStats(){return{libraryCount:this.libraries.length,domainCount:this.allowedDomains.length,customDomainCount:this.allowedDomains.length-this.defaultDomains.length}}clear(){this.libraries=[],this.allowedDomains=[...this.defaultDomains],localStorage.removeItem(this.options.storageKey),localStorage.removeItem(this.options.allowlistKey),this.logger.info("All libraries and custom domains cleared"),this.eventEmitter.emit(d.LIBRARIES_CLEARED)}testLogging(){console.log("üß™ LibraryManager test logging - debug enabled:",this.options.debug),this.logger.debug("This is a debug message"),this.logger.info("This is an info message"),this.logger.warn("This is a warn message"),this.logger.error("This is an error message")}destroy(){this.libraries=[],this.allowedDomains=[],this.logger.info("Library manager destroyed")}}class M{constructor(e={}){this.options={title:"Dialog",className:"",modal:!0,closeOnBackdrop:!0,closeOnEscape:!0,debug:!1,logPrefix:"BaseDialog",...e},this.logger=new n({enabled:this.options.debug,level:"info",prefix:this.options.logPrefix}),this.dialog=null,this.content=null,this.isOpen=!1,this.closeButton=null,this.logger.debug("BaseDialog instance created with options:",this.options),this.createDialog()}createDialog(){this.logger.debug("Creating dialog structure..."),this.dialog=document.createElement("dialog"),this.dialog.className=`base-dialog ${this.options.className}`.trim(),this.content=document.createElement("div"),this.content.className="dialog-content";const e=document.createElement("header");e.className="dialog-header",e.innerHTML=`\n      <h3 class="dialog-title">${this.options.title}</h3>\n      <button class="close-btn" title="Close">√ó</button>\n    `,this.closeButton=e.querySelector(".close-btn");const t=document.createElement("div");t.className="dialog-body",this.content.appendChild(e),this.content.appendChild(t),this.dialog.appendChild(this.content),document.body.appendChild(this.dialog),this.logger.debug("Dialog structure created and added to DOM"),this.setupEventListeners()}setupEventListeners(){this.logger.debug("Setting up base event listeners..."),this.closeButton&&this.closeButton.addEventListener("click",()=>{this.logger.debug("Close button clicked"),this.close()}),this.options.closeOnBackdrop&&this.dialog.addEventListener("click",e=>{e.target===this.dialog&&(this.logger.debug("Backdrop clicked, closing dialog"),this.close())}),this.options.closeOnEscape&&this.dialog.addEventListener("keydown",e=>{"Escape"===e.key&&(this.logger.debug("Escape key pressed, closing dialog"),this.close())}),this.logger.debug("Base event listeners configured")}getBody(){return this.content.querySelector(".dialog-body")}setTitle(e){this.logger.debug(`Setting dialog title to: "${e}"`);const t=this.content.querySelector(".dialog-title");t&&(t.textContent=e,this.options.title=e)}open(e={}){const{focus:t=!0}=e;this.isOpen?this.logger.warn("Dialog is already open"):(this.logger.info("Opening dialog..."),this.onBeforeOpen(),this.options.modal?this.dialog.showModal():this.dialog.show(),this.isOpen=!0,t&&setTimeout(()=>{this.dialog.focus(),this.onFocus()},100),this.onAfterOpen(),this.logger.info("Dialog opened successfully"))}close(){this.isOpen?(this.logger.info("Closing dialog..."),this.onBeforeClose(),this.dialog.close(),this.isOpen=!1,this.onAfterClose(),this.logger.info("Dialog closed successfully")):this.logger.warn("Dialog is already closed")}toggle(){this.logger.debug("Toggling dialog state"),this.isOpen?this.close():this.open()}isDialogOpen(){return this.isOpen}setContent(e){this.logger.debug("Setting dialog content...");const t=this.getBody();"string"==typeof e?t.innerHTML=e:e instanceof HTMLElement&&(t.innerHTML="",t.appendChild(e)),this.logger.debug("Dialog content updated")}addClass(e){this.logger.debug(`Adding class: ${e}`),this.dialog.classList.add(e)}removeClass(e){this.logger.debug(`Removing class: ${e}`),this.dialog.classList.remove(e)}onBeforeOpen(){this.logger.debug("onBeforeOpen hook called")}onAfterOpen(){this.logger.debug("onAfterOpen hook called")}onFocus(){this.logger.debug("onFocus hook called")}onBeforeClose(){this.logger.debug("onBeforeClose hook called")}onAfterClose(){this.logger.debug("onAfterClose hook called")}destroy(){this.logger.info("Destroying dialog..."),this.isOpen&&this.close(),this.dialog&&(this.dialog.remove(),this.dialog=null),this.content=null,this.closeButton=null,this.isOpen=!1,this.logger.info("Dialog destroyed successfully")}}class I extends M{constructor(e,t,i={}){super({title:"Runtime Libraries",className:"library-dialog",debug:i.debug||!1,logPrefix:"LibraryDialog",...i}),this.eventEmitter=e,this.libraryManager=t,this.urlInput=null,this.addBtn=null,this.libraryList=null,console.log("üîß LibraryDialog created with debug:",this.options.debug),this.logger.info("LibraryDialog initializing..."),this.createLibraryContent(),this.setupLibraryEventListeners(),this.logger.info("LibraryDialog initialization complete")}createLibraryContent(){this.logger.debug("Creating library-specific dialog content...");const e=this.getBody();e.innerHTML='\n      <section class="current-libraries">\n        <p class="descriptor">Manage libraries loaded into the sandbox environment</p>\n        <div class="library-list">\n          <div class="empty-state">\n            <span class="empty-icon">üìö</span>\n            <p>No libraries added yet</p>\n            <small>Add a CDN URL below to get started</small>\n          </div>\n        </div>\n      </section>\n\n      <section class="add-library">\n        <h4>Add Library</h4>\n        <p class="descriptor">Paste CDN URL to add a new library to your sandbox</p>\n        <div class="input-row">\n          <input type="url" class="url-input" placeholder="https://cdnjs.cloudflare.com/ajax/libs/...">\n          <button class="add-btn">Add</button>\n        </div>\n        <div class="input-feedback"></div>\n      </section>\n    ',this.urlInput=e.querySelector(".url-input"),this.addBtn=e.querySelector(".add-btn"),this.libraryList=e.querySelector(".library-list"),this.addBtn.addEventListener("click",()=>{this.logger.debug("Add button clicked"),this.handleAddLibrary()}),this.urlInput.addEventListener("keydown",e=>{"Enter"===e.key&&(this.logger.debug("Enter key pressed in URL input"),this.handleAddLibrary())}),this.logger.debug("Library content created successfully")}setupLibraryEventListeners(){this.logger.debug("Setting up library event listeners..."),this.eventEmitter.on(d.LIBRARY_MANAGER_OPEN,()=>{this.logger.info("Received LIBRARY_MANAGER_OPEN event"),this.open()}),this.eventEmitter.on(d.LIBRARY_ADDED,e=>{this.logger.info("Received LIBRARY_ADDED event for:",e?.library?.name),this.refreshLibraryList()}),this.eventEmitter.on(d.LIBRARY_REMOVED,e=>{this.logger.info("Received LIBRARY_REMOVED event for:",e?.library?.name),this.refreshLibraryList()}),this.eventEmitter.on(d.DOMAIN_TRUST_REQUEST,e=>{this.logger.warn("Received DOMAIN_TRUST_REQUEST for domain:",e?.domain),this.showDomainTrustDialog(e)}),this.logger.debug("Library event listeners configured")}onBeforeOpen(){this.logger.debug("Preparing library dialog for opening..."),this.refreshLibraryList(),this.urlInput.value="",this.clearFeedback()}onFocus(){this.logger.debug("Library dialog focused, focusing URL input"),this.urlInput&&this.urlInput.focus()}onAfterClose(){this.logger.debug("Library dialog closed, clearing feedback"),this.clearFeedback()}handleAddLibrary(){const e=this.urlInput.value.trim();if(this.logger.debug("handleAddLibrary called with URL:",e),!e)return this.logger.warn("Add library attempted with empty URL"),void this.showFeedback("Please enter a library URL","error");this.logger.info("Attempting to add library:",e),this.showFeedback("Adding library...","loading"),this.addBtn.disabled=!0;const t=this.libraryManager.addLibrary(e);this.logger.debug("Library manager result:",t),t.success?(this.logger.info(`Library added successfully: ${t.library.name}`),this.showFeedback(`Added: ${t.library.name}`,"success"),this.urlInput.value="",setTimeout(()=>{this.logger.debug("Clearing success feedback after timeout"),this.clearFeedback()},2e3)):t.needsApproval?(this.logger.warn(`Domain approval needed for: ${t.domain}`),this.showFeedback(`Waiting for domain approval: ${t.domain}`,"warning")):(this.logger.error(`Failed to add library: ${t.error}`),this.showFeedback(`Error: ${t.error}`,"error")),this.addBtn.disabled=!1,this.logger.debug("Add library operation completed")}showDomainTrustDialog(e){this.logger.info(`Showing domain trust dialog for: ${e.domain}`);if(confirm(`‚ö†Ô∏è New CDN Domain Detected\n\nThe domain "${e.domain}" is not in your trusted list.\n\nAdding this domain will allow all scripts from:\nhttps://${e.domain}\n\nDo you want to trust this domain?`)){this.logger.info(`User confirmed trust for domain: ${e.domain}`),this.libraryManager.addDomain(e.domain),this.logger.debug(`Retrying library addition for: ${e.url}`);const t=this.libraryManager.addLibrary(e.url,e.name);t.success?(this.logger.info(`Library added after domain approval: ${t.library.name}`),this.showFeedback(`Added: ${t.library.name}`,"success"),this.urlInput.value="",setTimeout(()=>{this.logger.debug("Clearing success feedback after domain approval"),this.clearFeedback()},2e3)):(this.logger.error(`Library addition failed after domain approval: ${t.error}`),this.showFeedback(`Error: ${t.error}`,"error"))}else this.logger.info(`User cancelled domain trust for: ${e.domain}`),this.showFeedback("Library addition cancelled","info"),setTimeout(()=>{this.logger.debug("Clearing cancellation feedback"),this.clearFeedback()},2e3)}refreshLibraryList(){this.logger.debug("Refreshing library list display...");const e=this.libraryManager.getLibraries();0===e.length?(this.logger.debug("No libraries found, showing empty state"),this.libraryList.innerHTML='\n        <div class="empty-state">\n          <span class="empty-icon">üìö</span>\n          <p>No libraries added yet</p>\n          <small>Add a CDN URL below to get started</small>\n        </div>\n      '):(this.logger.info(`Displaying ${e.length} libraries in list`),this.libraryList.innerHTML=e.map(e=>(this.logger.trace(`Rendering library item: ${e.name}`),`\n          <div class="library-item" data-id="${e.id}">\n            <div class="library-info">\n              <span class="library-name">${e.name}</span>\n              <small class="library-url">${e.url}</small>\n            </div>\n            <button class="remove-btn" title="Remove library" data-id="${e.id}">üóëÔ∏è</button>\n          </div>\n        `)).join(""),this.libraryList.querySelectorAll(".remove-btn").forEach(t=>{t.addEventListener("click",t=>{const i=t.target.dataset.id,r=e.find(e=>e.id===i);this.logger.info(`Remove button clicked for library: ${r?.name||i}`),this.libraryManager.removeLibrary(i)})}),this.logger.debug("Remove button listeners attached to all library items")),this.logger.debug(`Library list refresh completed: ${e.length} libraries displayed`)}showFeedback(e,t="info"){this.logger.debug(`Showing ${t} feedback: ${e}`);const i=this.getBody().querySelector(".input-feedback");i?(i.textContent=e,i.className=`input-feedback ${t}`):this.logger.warn("Feedback element not found in dialog body")}clearFeedback(){this.logger.debug("Clearing feedback message");const e=this.getBody().querySelector(".input-feedback");e&&(e.textContent="",e.className="input-feedback")}}class ${constructor(e,t={}){this.eventEmitter=e,this.options={debug:!0,...t},this.logger=new n({enabled:this.options.debug,level:"info",prefix:"ShareManager"}),this.logger.info("ShareManager initialized")}generateShareUrl(e){try{const t=btoa(encodeURIComponent(e));this.logger.info("Generated share URL with code length:",e.length);const i=new URL(window.location.href);return i.searchParams.set("script",t),i.toString()}catch(t){throw this.logger.error("Failed to generate share URL:",t),new Error("Failed to generate share URL")}}extractScriptFromUrl(){try{const e=new URLSearchParams(window.location.search).get("script");if(!e)return this.logger.info("No script parameter found in URL"),null;const t=decodeURIComponent(atob(e));return this.logger.info("Extracted script from URL, length:",t.length),t}catch(e){return this.logger.error("Failed to extract script from URL:",e),null}}async copyToClipboard(e){try{if(navigator.clipboard&&window.isSecureContext)return await navigator.clipboard.writeText(e),this.logger.info("URL copied to clipboard using modern API"),!0;{const t=document.createElement("textarea");t.value=e,t.style.position="fixed",t.style.left="-999999px",t.style.top="-999999px",document.body.appendChild(t),t.focus(),t.select();const i=document.execCommand("copy");if(document.body.removeChild(t),i)return this.logger.info("URL copied to clipboard using fallback method"),!0;throw new Error("Fallback copy failed")}}catch(t){return this.logger.error("Failed to copy URL to clipboard:",t),!1}}async shareCode(e){try{const t=this.generateShareUrl(e);return await this.copyToClipboard(t)?(this.eventEmitter.emit(d.SHARE_SUCCESS,{url:t,codeLength:e.length}),this.logger.info("Code shared successfully"),!0):(this.eventEmitter.emit(d.SHARE_ERROR,{error:"Failed to copy to clipboard"}),!1)}catch(t){return this.logger.error("Failed to share code:",t),this.eventEmitter.emit(d.SHARE_ERROR,{error:t.message}),!1}}hasScriptInUrl(){return new URLSearchParams(window.location.search).has("script")}cleanupUrl(){try{const e=new URL(window.location.href);e.searchParams.delete("script"),window.history.replaceState({},document.title,e.toString()),this.logger.info("URL cleaned up, script parameter removed")}catch(e){this.logger.error("Failed to cleanup URL:",e)}}}class k{constructor(e={}){this.options={transitionDuration:8e3,autoRotate:!0,debug:!1,...e},this.logger=new n({enabled:this.options.debug,level:"info",prefix:"NeonGlow"}),this.hue1=this.randomHue(),this.hue2=this.randomHue(),this.rotationInterval=null,this.glowElements=new Set}randomHue(){return Math.floor(360*Math.random())}complementaryHue(e){return(e+(80+Math.floor(60*Math.random())-30))%360}applyGlow(e,t={}){e.classList.add("neon-glow");const i=document.createElement("div");i.className="neon-glow-container";const r=document.createElement("div");r.className="neon-shine",i.appendChild(r),e.appendChild(i),this.glowElements.add(e),this.logger.debug("Applied glow to element:",e)}updateHues(e,t){this.hue1=e,this.hue2=t,document.documentElement.style.setProperty("--hue1",String(e)),document.documentElement.style.setProperty("--hue2",String(t)),this.logger.debug(`Updated hues: ${e}, ${t}`)}rotateColors(){const e=this.randomHue(),t=this.complementaryHue(e);this.logger.info(`Rotating colors: ${e}, ${t}`),this.updateHues(e,t)}startRotation(){this.rotationInterval&&this.stopRotation(),this.rotateColors(),this.rotationInterval=setInterval(()=>{this.rotateColors()},this.options.transitionDuration),this.logger.info("Started color rotation")}stopRotation(){this.rotationInterval&&(clearInterval(this.rotationInterval),this.rotationInterval=null,this.logger.info("Stopped color rotation"))}removeGlow(e){e.classList.remove("neon-glow");const t=e.querySelector(".neon-glow-container");t&&t.remove(),this.glowElements.delete(e)}destroy(){this.logger.info("Destroying neon glow manager"),this.stopRotation(),this.glowElements.forEach(e=>{this.removeGlow(e)}),this.glowElements.clear()}}class _{constructor(e={}){this.options={timeLimit:f,storageKey:s,defaultCode:this.getDefaultCode(),debug:!1,logLevel:"info",...e},this.logger=new n({enabled:this.options.debug,level:this.options.logLevel,prefix:"Controller"}),this.events=new t,this.editor=null,this.sandbox=null,this.console=null,this.storage=null,this.examples=null,this.examplesDropdown=null,this.themeSwitcher=null,this.editorSwitcher=null,this.fullscreenManager=null,this.libraryManager=null,this.libraryDialog=null,this.shareManager=null,this.neonGlow=null,this.elements={},this.resizeHandlers=[],this.responsiveListener=null,this.isInitialized=!1}getDefaultCode(){return["// Welcome to JS Sandbox! üôå","//","// Tips:","//  - Use console.log/info/warn/error","//  - Ctrl/Cmd+Enter to execute",'//  - "Reset" kills stuck executions',"//","// Examples:",'console.log("Hello, sandbox!");',"function noReturn() { var x = 1+1; }","noReturn(); // no return value, all good","","// DOM inside sandbox:",'var el = document.createElement("h1");','el.textContent = "Hello from iframe!";',"document.body.appendChild(el);","","// Errors:",'Promise.reject("rejected!");','// throw new Error("Exception thrown");',"","// Infinite loop test (commented):","// while(true) {}"].join("\n")}async init(){if(this.isInitialized)this.logger.warn("Controller already initialized");else try{this.events.emit(d.INIT_START),this.logger.info("Initializing controller..."),this.findElements(),await this.initializeComponents(),this.setupEventListeners(),this.isInitialized=!0,this.events.emit(d.INIT_COMPLETE),this.logger.info("Controller initialization complete")}catch(e){throw this.logger.error("Initialization failed:",e),this.events.emit(d.INIT_ERROR,e),this.showInitializationError(e),e}}showInitializationError(e){if(this.elements.consoleContainer){const t=document.createElement("div");t.className="console-line console-error",t.textContent=`‚ö†Ô∏è Initialization failed: ${e.message}`,this.elements.consoleContainer.appendChild(t)}}findElements(){this.elements={app:document.querySelector(".app"),editorContainer:document.getElementById("editorContainer"),consoleContainer:document.getElementById("console"),sandboxContainer:document.getElementById("sandboxContainer"),runBtn:document.getElementById("runBtn"),clearBtn:document.getElementById("clearBtn"),resetBtn:document.getElementById("resetBtn"),togglePreview:document.getElementById("togglePreview"),previewWrap:document.getElementById("previewWrap"),status:document.getElementById("status"),limitLabel:document.getElementById("limitLabel"),toolbar:document.querySelector(".toolbar"),fullscreenEditor:document.getElementById("fullscreenEditor"),fullscreenConsole:document.getElementById("fullscreenConsole"),librariesBtn:document.getElementById("librariesBtn"),clearConsoleBtn:document.getElementById("clearConsoleBtn"),shareBtn:document.getElementById("shareBtn")};const e=["app","editorContainer","consoleContainer","sandboxContainer"].filter(e=>!this.elements[e]);if(e.length>0)throw new Error(`Missing required elements: ${e.join(", ")}`)}async initializeComponents(){this.logger.info("Initializing components...");try{this.storage=new C(this.options.storageKey,{debug:this.options.debug}),this.logger.debug("Storage initialized")}catch(t){this.logger.error("Storage initialization failed:",t)}try{this.console=new i(this.elements.consoleContainer,{debug:this.options.debug}),this.logger.debug("Console initialized")}catch(t){throw this.logger.error("Console initialization failed:",t),new Error("Failed to initialize console output")}try{this.sandbox=new r(this.elements.sandboxContainer,{timeLimit:this.options.timeLimit,debug:this.options.debug,logLevel:this.options.logLevel,onMessage:(e,t)=>{this.console.addLine(e,t),this.events.emit(d.CONSOLE_MESSAGE,{type:e,args:t})},onStatusChange:e=>this.updateStatus(e)}),this.logger.debug("SandboxEngine created"),await this.sandbox.initialize(),this.logger.info("Sandbox initialized")}catch(t){throw this.logger.error("Sandbox initialization failed:",t),new Error(`Failed to initialize sandbox: ${t.message}`)}try{if(this.examples=new S({onLoad:e=>this.events.emit(d.EXAMPLE_LOAD,e),onError:e=>this.events.emit(d.EXAMPLE_ERROR,e),debug:!0}),this.elements.toolbar&&!this.examplesDropdown){this.examplesDropdown=new x(this.elements.toolbar,{onSelect:e=>this.loadExample(e)});try{this.examplesDropdown.setLoading(!0);const e=await this.examples.discoverExamples();this.examplesDropdown.setExamples(e),this.logger.info("Examples loaded:",e.length)}catch(t){this.logger.error("Failed to load examples:",t),this.examplesDropdown.setError("Failed to load")}}this.elements.toolbar&&!this.themeSwitcher&&(this.themeSwitcher=new T(this.elements.toolbar,this.events,{defaultTheme:"monokai"}),this.logger.info("Theme switcher initialized"));const e=this.elements.app.querySelector(".editor-controls");e&&!this.editorSwitcher&&(this.editorSwitcher=new R(e,this.events,{defaultEditor:"ace"}),this.logger.info("Editor switcher initialized")),this.fullscreenManager||(this.fullscreenManager=new D(this.events,{debug:this.options.debug}),this.fullscreenManager.init({app:this.elements.app,fullscreenEditor:this.elements.fullscreenEditor,fullscreenConsole:this.elements.fullscreenConsole}),this.logger.info("Fullscreen manager initialized")),this.libraryManager||(this.libraryManager=new A(this.events,{debug:this.options.debug}),this.logger.info("Library manager initialized")),this.libraryDialog||(this.libraryDialog=new I(this.events,this.libraryManager,{debug:this.options.debug}),this.logger.info("Library dialog initialized")),this.shareManager||(this.shareManager=new $(this.events,{debug:this.options.debug}),this.logger.info("Share manager initialized"))}catch(t){this.logger.warn("Examples system initialization failed:",t)}this.elements.limitLabel&&(this.elements.limitLabel.textContent=this.options.timeLimit+"ms"),this.initializeResizer(),this.setupResponsiveListener();const e=this.elements.app.querySelector(".pane.right");if(e&&this.elements.previewWrap){const t=this.elements.previewWrap.classList.contains("show");e.classList.toggle("has-preview",t)}this.initializeNeonGlow(),this.logger.info("Components initialization complete")}initializeNeonGlow(){try{this.neonGlow=new k({transitionDuration:8e3,autoRotate:!0,debug:!0});this.elements.app.querySelectorAll(".pane").forEach(e=>{this.neonGlow.applyGlow(e)}),this.neonGlow.startRotation(),this.logger.info("Neon glow effects initialized")}catch(e){this.logger.warn("Failed to initialize neon glow:",e)}}cleanupResizeHandlers(){this.resizeHandlers.forEach(e=>{e&&e.cleanup&&e.cleanup()}),this.resizeHandlers=[]}initializeResizer(){if(!this.elements.app)return;if(this.cleanupResizeHandlers(),o(b))return void this.initializeVerticalResize();const e=this.elements.app.querySelector(".main-content");if(!e)return;this.elements.app.querySelectorAll(".resize-handle, .vertical-resize-handle").forEach(e=>e.remove()),e.style.gridTemplateColumns="",e.style.gridTemplateRows="";const t=e.querySelector(".pane:last-child");t&&(t.style.gridTemplateRows="",t.classList.remove("preview-hidden"));const i=document.createElement("div");i.className="resize-handle";const r=e.querySelectorAll(".pane");if(r.length>=2){e.insertBefore(i,r[1]);const t=function(e){const{container:t,leftPane:i,rightPane:r,handle:o,onResize:s}=e;let n=!1,a=0,l=0;const d=e=>{n=!0;const t=e.clientX||e.touches&&e.touches[0].clientX;a=t,o.classList.add("dragging"),l=i.getBoundingClientRect().width,r.getBoundingClientRect().width,document.body.style.userSelect="none",document.body.style.cursor="col-resize",e.preventDefault()},h=e=>{if(!n)return;const i=(e.clientX||e.touches&&e.touches[0].clientX)-a,r=t.getBoundingClientRect().width-c-10,o=Math.max(g,Math.min(r-u,l+i)),s=r-o;t.style.gridTemplateColumns=`${o}px ${c}px ${s}px`,e.preventDefault()},m=()=>{n&&(n=!1,o.classList.remove("dragging"),document.body.style.userSelect="",document.body.style.cursor="",s&&s())};return o.addEventListener("mousedown",d),o.addEventListener("touchstart",d),document.addEventListener("mousemove",h),document.addEventListener("touchmove",h),document.addEventListener("mouseup",m),document.addEventListener("touchend",m),{handleStart:d,handleMove:h,handleEnd:m,cleanup:()=>{o.removeEventListener("mousedown",d),o.removeEventListener("touchstart",d),document.removeEventListener("mousemove",h),document.removeEventListener("touchmove",h),document.removeEventListener("mouseup",m),document.removeEventListener("touchend",m)}}}({container:e,leftPane:r[0],rightPane:r[1],handle:i,onResize:()=>this.events.emit(d.PANES_RESIZED)});this.resizeHandlers.push(t)}this.initializeVerticalResize()}setupResponsiveListener(){this.responsiveListener&&this.responsiveListener.mediaQuery.removeListener(this.responsiveListener.handleChange);const e=window.matchMedia(`(max-width: ${b}px)`),t=()=>{this.logger.debug("Responsive breakpoint changed"),this.initializeResizer()};e.addListener(t),this.responsiveListener={mediaQuery:e,handleChange:t}}initializeVerticalResize(){const e=this.elements.app.querySelector(".pane.right");if(!e)return;const t=document.createElement("div");t.className="vertical-resize-handle";const i=e.querySelector(".console");if(i){i.parentNode.insertBefore(t,i.nextSibling);const r=function(e){const{container:t,topPane:i,bottomPane:r,handle:o,onResize:s,shouldResize:n}=e;let a=!1,l=0,d=0,h=0;const c=e=>{if(n&&!n())return;a=!0;const t=e.clientY||e.touches&&e.touches[0].clientY;l=t,o.classList.add("dragging");const s=i.getBoundingClientRect(),c=r.getBoundingClientRect();d=s.height,h=c.height,document.body.style.userSelect="none",document.body.style.cursor="row-resize",e.preventDefault()},g=e=>{if(!a)return;const i=(e.clientY||e.touches&&e.touches[0].clientY)-l,r=d+h,o=Math.max(m,Math.min(r-p,d+i)),s=r-o;t.style.gridTemplateRows=`auto ${o}px 8px ${s}px auto`,e.preventDefault()},u=()=>{a&&(a=!1,o.classList.remove("dragging"),document.body.style.userSelect="",document.body.style.cursor="",s&&s())};return o.addEventListener("mousedown",c),o.addEventListener("touchstart",c),document.addEventListener("mousemove",g),document.addEventListener("touchmove",g),document.addEventListener("mouseup",u),document.addEventListener("touchend",u),{handleStart:c,handleMove:g,handleEnd:u,cleanup:()=>{o.removeEventListener("mousedown",c),o.removeEventListener("touchstart",c),document.removeEventListener("mousemove",g),document.removeEventListener("touchmove",g),document.removeEventListener("mouseup",u),document.removeEventListener("touchend",u)}}}({container:e,topPane:i,bottomPane:this.elements.previewWrap,handle:t,shouldResize:()=>this.elements.previewWrap.classList.contains("show"),onResize:()=>this.events.emit(d.PANES_RESIZED_VERTICAL)});this.resizeHandlers.push(r)}}getEventEmitter(){return this.events}setEditor(e){this.editor&&this.editor.destroy(),this.editor=e,this.editor.onChange(e=>{this.storage&&this.storage.save(e),this.events.emit(d.CODE_CHANGE,{code:e})}),this.editor.onExecute(()=>{this.run()}),this.loadInitialCode(),this.events.emit(d.EDITOR_READY,{editor:e})}setupEventListeners(){this.elements.runBtn&&this.elements.runBtn.addEventListener("click",()=>this.run()),this.elements.clearBtn&&this.elements.clearBtn.addEventListener("click",()=>this.clearConsole()),this.elements.resetBtn&&this.elements.resetBtn.addEventListener("click",()=>this.reset()),this.elements.togglePreview&&this.elements.togglePreview.addEventListener("change",e=>{this.elements.previewWrap.classList.toggle("show",e.target.checked);const t=this.elements.app.querySelector(".pane.right");t&&(e.target.checked?t.classList.add("has-preview"):(t.classList.remove("has-preview"),t.style.gridTemplateRows=""))}),this.elements.librariesBtn&&this.elements.librariesBtn.addEventListener("click",()=>{this.events.emit(d.LIBRARY_MANAGER_OPEN)}),this.elements.clearConsoleBtn&&this.elements.clearConsoleBtn.addEventListener("click",()=>{this.clearConsole()}),this.elements.shareBtn&&this.elements.shareBtn.addEventListener("click",()=>{this.shareCode()}),this.setupThemeEventListeners(),this.setupEditorEventListeners(),this.setupShareEventListeners()}setupThemeEventListeners(){this.events.on(d.THEME_LOAD_START,e=>{this.logger.info("Theme loading started:",e.theme)}),this.events.on(d.THEME_READY,e=>{this.logger.info("Theme ready:",e.theme),e.error&&this.logger.warn("Theme ready with error:",e.error)}),this.events.on(d.THEME_CHANGE,e=>{this.logger.info("Theme changed from",e.oldTheme,"to",e.theme)})}setupEditorEventListeners(){this.events.on(d.EDITOR_CHANGE,async e=>{this.logger.info("Editor change requested:",e),await this.switchEditor(e.editor,e.oldEditor)})}setupShareEventListeners(){this.events.on(d.SHARE_SUCCESS,e=>{this.updateStatus("Share link copied to clipboard!"),this.logger.info("Share successful:",e)}),this.events.on(d.SHARE_ERROR,e=>{this.updateStatus("Failed to share code"),this.logger.error("Share failed:",e)})}async shareCode(){if(!this.editor||!this.shareManager)return void this.logger.error("Cannot share: editor or share manager not available");const e=this.editor.getValue();e.trim()?(this.updateStatus("Generating share link..."),await this.shareManager.shareCode(e)):this.updateStatus("No code to share")}async switchEditor(e,t){this.logger.info("Switching editor from",t,"to",e);const i=this.editor?this.editor.getValue():"";this.editor&&(this.editor.destroy(),this.editor=null);const r=this.elements.editorContainer;if(!r)throw new Error("Editor container not found");let o;r.innerHTML="";try{if("ace"===e){const{ACEEditor:e}=await L(async()=>{const{ACEEditor:e}=await Promise.resolve().then(()=>O);return{ACEEditor:e}},void 0);o=new e(r,{mode:"javascript",theme:this.themeSwitcher?this.themeSwitcher.getCurrentTheme():"monokai",autofocus:!0,debug:this.options.debug},this.events)}else if("codemirror"===e){const{CodeMirrorEditor:e}=await L(async()=>{const{CodeMirrorEditor:e}=await import("./vendor-CiEMj8hI.js").then(e=>e.l);return{CodeMirrorEditor:e}},[]);o=new e(r,{mode:"javascript",theme:this.themeSwitcher?this.themeSwitcher.getCurrentTheme():"darcula",autofocus:!0,debug:this.options.debug},this.events)}else{const{TextareaEditor:e}=await L(async()=>{const{TextareaEditor:e}=await Promise.resolve().then(()=>B);return{TextareaEditor:e}},void 0);o=new e(r,{autofocus:!0,debug:this.options.debug},this.events)}this.setEditor(o),i&&this.editor.setValue(i),this.logger.info("Editor switched successfully to:",e),this.events.emit(d.EDITOR_CHANGED,{editor:e,oldEditor:t})}catch(s){this.logger.error("Failed to switch editor:",s);const{TextareaEditor:e}=await L(async()=>{const{TextareaEditor:e}=await Promise.resolve().then(()=>B);return{TextareaEditor:e}},void 0);this.editor=new e(r,{autofocus:!0,debug:this.options.debug},this.events),this.setEditor(this.editor),i&&this.editor.setValue(i)}}loadInitialCode(){let e=this.options.defaultCode,t=!1,i=!1;if(this.shareManager&&this.shareManager.hasScriptInUrl()){const t=this.shareManager.extractScriptFromUrl();t&&(e=t,i=!0,this.logger.info("Loaded code from share URL"),this.shareManager.cleanupUrl())}if(!i){const i=this.storage?this.storage.load():null;i&&(e=i,t=!0)}this.editor&&(this.editor.setValue(e),this.editor.focus(),this.events.emit(d.CODE_LOAD,{code:e,fromStorage:t,fromShare:i}))}async run(){if(!this.editor)return void this.logger.error("No editor configured");const e=this.editor.getValue();this.events.emit(d.CODE_EXECUTE_START,{code:e});const t=this.sandbox.validateSyntax(e);if(this.events.emit(d.CODE_VALIDATE,{code:e,validation:t}),this.console.clear(),this.elements.togglePreview&&!this.elements.togglePreview.checked){this.elements.togglePreview.checked=!0,this.elements.previewWrap.classList.add("show");const e=this.elements.app.querySelector(".pane.right");e&&e.classList.add("has-preview")}o(b)&&this.enterConsoleFullscreenOnMobile();let i=null;if(this.libraryManager){const e=this.libraryManager.getLibraries();if(e.length>0){this.updateStatus(`Loading ${e.length} libraries...`);try{this.logger.debug("Generating library scripts...");const e=await this.libraryManager.generateScriptTags();i={scripts:e,csp:this.libraryManager.generateCSP()},this.logger.debug("Library data prepared successfully")}catch(r){this.logger.error("Failed to prepare library data:",r),this.updateStatus("Library loading failed")}}}this.sandbox.execute(e,i)}enterConsoleFullscreenOnMobile(){this.fullscreenManager&&!this.fullscreenManager.isFullscreen()&&(this.logger.debug("Entering console fullscreen mode on mobile after run"),this.fullscreenManager.setFullscreenMode("console"))}clearConsole(){this.console.clear(),this.updateStatus(v.cleared),this.events.emit(d.CONSOLE_CLEAR)}reset(){this.sandbox.reset(),this.updateStatus(v.reset),this.events.emit(d.SANDBOX_RESET)}updateStatus(e){if(!this.elements.status)return;const t=v[e]||e;this.elements.status.textContent=t,this.events.emit(d.STATUS_CHANGE,{status:e,displayStatus:t}),"completed"===e?this.events.emit(d.CODE_EXECUTE_COMPLETE):"timeout"===e&&this.events.emit(d.CODE_EXECUTE_TIMEOUT)}on(e,t,i){return this.events.on(e,t,i)}once(e,t){return this.events.once(e,t)}off(e,t){this.events.off(e,t)}getCode(){return this.editor?this.editor.getValue():null}setCode(e){this.editor&&this.editor.setValue(e)}validateCode(e){const t=e||this.getCode();return this.sandbox?this.sandbox.validateSyntax(t):{valid:!1,error:"Sandbox not initialized"}}async loadExample(e){try{this.logger.info("Loading example:",e);const t=await this.examples.loadExample(e);if(this.setCode(t.code),this.elements.togglePreview&&!this.elements.togglePreview.checked){this.elements.togglePreview.checked=!0,this.elements.previewWrap.classList.add("show");const e=this.elements.app.querySelector(".pane.right");e&&e.classList.add("has-preview")}this.run(),this.events.emit(d.EXAMPLE_LOADED,{exampleId:e,example:t})}catch(t){this.logger.error("Failed to load example:",t),this.events.emit(d.EXAMPLE_ERROR,t)}}destroy(){this.logger.info("Destroying controller..."),this.events.emit(d.DESTROY),this.editor&&(this.editor.destroy(),this.editor=null),this.sandbox&&(this.sandbox.destroy(),this.sandbox=null),this.examples&&(this.examples.destroy(),this.examples=null),this.examplesDropdown&&(this.examplesDropdown.destroy(),this.examplesDropdown=null),this.themeSwitcher&&(this.themeSwitcher.destroy(),this.themeSwitcher=null),this.editorSwitcher&&(this.editorSwitcher.destroy(),this.editorSwitcher=null),this.neonGlow&&(this.neonGlow.destroy(),this.neonGlow=null),this.fullscreenManager&&(this.fullscreenManager.destroy(),this.fullscreenManager=null),this.libraryManager&&(this.libraryManager.destroy(),this.libraryManager=null),this.libraryDialog&&(this.libraryDialog.destroy(),this.libraryDialog=null),this.shareManager&&(this.shareManager=null),this.cleanupResizeHandlers(),this.responsiveListener&&(this.responsiveListener.mediaQuery.removeListener(this.responsiveListener.handleChange),this.responsiveListener=null),this.events.removeAllListeners(),this.isInitialized=!1,this.logger.info("Controller destroyed")}}class F extends E{constructor(e,t={},i=null){super(e,t,i),this.editor=null,this.currentTheme=t.theme||"monokai",this.logger=new n({enabled:!0,level:"info",prefix:"ACEEditor"}),this.logger.info("ACE editor initialized with theme:",this.currentTheme),this.logger.info("Event emitter provided:",!!i),this.init()}init(){if("undefined"==typeof ace)throw new Error("ACE is not loaded. Include ACE before using this adapter.");const e=document.createElement("div");e.style.cssText="\n      width: 100%;\n      height: 100%;\n      min-height: 300px;\n    ",this.container.appendChild(e),this.editor=ace.edit(e),this.editor.setTheme(`ace/theme/${this.currentTheme}`),this.editor.session.setMode("ace/mode/javascript"),this.editor.setOptions({fontSize:"14px",showPrintMargin:!1,showGutter:!0,highlightActiveLine:!0,enableBasicAutocompletion:!1!==this.options.autocomplete,enableLiveAutocompletion:!1!==this.options.autocomplete,enableSnippets:!0,wrap:!0,tabSize:2,useSoftTabs:!0,behavioursEnabled:!0,wrapBehavioursEnabled:!0}),this.editor.commands.addCommand({name:"executeCode",bindKey:{win:"Ctrl-Enter",mac:"Cmd-Enter"},exec:()=>this.triggerExecute()}),this.editor.on("change",()=>{this.triggerChange()}),this.applyGlassEffect(this.currentTheme),!1!==this.options.autofocus&&this.editor.focus(),this.logger.info("ACE editor initialized successfully")}getValue(){return this.editor?this.editor.getValue():""}setValue(e){this.editor&&this.editor.setValue(e,-1)}focus(){this.editor&&this.editor.focus()}onThemeChange(e,t){this.logger.info("onThemeChange called with:",{newTheme:e,oldTheme:t}),this.logger.info("Current theme before change:",this.currentTheme),this.logger.info("ACE editor instance exists:",!!this.editor),this.editor&&e!==this.currentTheme?(this.logger.info("Applying theme change from",this.currentTheme,"to",e),this.currentTheme=e,this.editor.setTheme(`ace/theme/${e}`),this.logger.info("Theme applied successfully"),this.applyGlassEffect(e)):(this.logger.warn("Theme change skipped. Reasons:"),this.logger.warn("- ACE editor exists:",!!this.editor),this.logger.warn("- New theme different from current:",e!==this.currentTheme),this.logger.warn("- New theme value:",e),this.logger.warn("- Current theme value:",this.currentTheme))}applyGlassEffect(e){setTimeout(()=>{const t=this.container.querySelector(".ace_editor");if(t){this.logger.info("Applying glass effect for theme:",e);const i=window.getComputedStyle(t).backgroundColor;this.logger.info("Original background color:",i);const r=this.reduceColorOpacity(i,.7);this.logger.info("Reduced opacity color:",r);let o=document.getElementById("ace-glass-effect");o||(o=document.createElement("style"),o.id="ace-glass-effect",document.head.appendChild(o)),o.textContent=`\n          .ace_editor {\n            background-color: ${r} !important;\n          }\n          .ace_gutter {\n            background-color: ${this.reduceColorOpacity(i,.8)} !important;\n          }\n        `,this.logger.info("Glass effect applied with reduced opacity background")}},200)}reduceColorOpacity(e,t){const i=e.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*([\d.]+))?\)/);if(i){const[,e,r,o]=i;return`rgba(${e}, ${r}, ${o}, ${t})`}const r=e.match(/rgb\((\d+),\s*(\d+),\s*(\d+)\)/);if(r){const[,e,i,o]=r;return`rgba(${e}, ${i}, ${o}, ${t})`}const o=e.match(/^#([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i);if(o){return`rgba(${parseInt(o[1],16)}, ${parseInt(o[2],16)}, ${parseInt(o[3],16)}, ${t})`}return this.logger.warn("Could not parse color:",e,"using fallback"),`rgba(0, 0, 0, ${t})`}getCurrentTheme(){return this.currentTheme}setTheme(e){this.editor&&e!==this.currentTheme&&(this.currentTheme=e,this.editor.setTheme(`ace/theme/${e}`))}applyTransformation(e){this.logger.debug("Applying transformation:",e);const t=this.editor.getCursorPosition();switch(e.action){case"insert":if(this.editor.insert(e.text),void 0!==e.cursorOffset){const t=this.editor.getCursorPosition();this.editor.moveCursorTo(t.row,t.column+e.cursorOffset)}break;case"skip":this.editor.moveCursorTo(t.row,t.column+e.positions);break;case"deleteRange":const i=new ace.Range(t.row,e.start,t.row,e.end);this.editor.session.remove(i);break;default:this.logger.warn("Unknown transformation action:",e.action)}}destroy(){this.editor&&(this.editor.destroy(),this.editor=null)}}const O=Object.freeze(Object.defineProperty({__proto__:null,ACEEditor:F},Symbol.toStringTag,{value:"Module"}));class z extends E{constructor(e,t={},i=null){super(e,t,i),this.textarea=null,this.init()}init(){this.textarea=document.createElement("textarea"),this.textarea.className="code-editor",this.textarea.spellcheck=!1,this.textarea.placeholder=this.options.placeholder||"Enter your JavaScript code here...",this.container.appendChild(this.textarea),this.setupEventListeners()}setupEventListeners(){this.textarea.addEventListener("input",()=>{this.triggerChange()}),this.textarea.addEventListener("keydown",e=>{(e.ctrlKey||e.metaKey)&&"Enter"===e.key&&(e.preventDefault(),this.triggerExecute())})}getValue(){return this.textarea.value}setValue(e){this.textarea.value=e}focus(){this.textarea.focus()}destroy(){this.textarea&&this.textarea.remove()}}const B=Object.freeze(Object.defineProperty({__proto__:null,TextareaEditor:z},Symbol.toStringTag,{value:"Module"}));async function N(e={}){const t=e.debug||!1,i=new n({enabled:t,level:e.logLevel||"info",prefix:"App"});try{i.info("Starting sandbox initialization...");const r=new _(e);await r.init(),i.info("Controller initialized");const o=document.getElementById("editorContainer");if(!o)throw new Error("Editor container element not found");const s=function(e,t={},i=null){const r=new n({enabled:t.debug||!1,level:"info",prefix:"EditorFactory"}),o=localStorage.getItem("sandbox_current_editor");if(r.info("Saved editor preference:",o),"ace"===o&&"undefined"!=typeof ace)try{return r.info("Initializing saved ACE editor"),new F(e,t,i)}catch(s){r.warn("Failed to initialize saved ACE, falling back:",s)}else if("codemirror"===o&&"undefined"!=typeof CodeMirror)try{return r.info("Initializing saved CodeMirror editor"),new w(e,t,i)}catch(s){r.warn("Failed to initialize saved CodeMirror, falling back:",s)}else if("textarea"===o)try{return r.info("Initializing saved textarea editor"),new z(e,t,i)}catch(s){r.warn("Failed to initialize saved textarea, falling back:",s)}if("undefined"!=typeof ace)try{return r.info("Initializing ACE editor (fallback)"),new F(e,t,i)}catch(s){r.warn("Failed to initialize ACE, falling back to textarea:",s)}return r.info("Initializing textarea editor (final fallback)"),new z(e,t,i)}(o,{mode:"javascript",theme:"monokai",autofocus:!0,debug:t},r.getEventEmitter());return i.info("Editor created, waiting for theme ready event"),r.setEditor(s),i.info("Editor set on controller"),i.info("Sandbox initialization complete"),r}catch(r){throw i.error("Sandbox initialization failed:",r),r}}function U(){!window.sandbox&&document.getElementById("editorContainer")&&N({debug:!0,logLevel:"trace"}).then(e=>{window.sandbox=e,console.log("‚úÖ Sandbox initialized successfully")}).catch(e=>{console.error("‚ùå Failed to initialize sandbox:",e)})}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",U):U();
//# sourceMappingURL=index-NSGOTdEp.js.map
