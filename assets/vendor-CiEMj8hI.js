const e=4e3,t=5e3,o=5e3,r=320,s=420,n=100,a=100,i=5,l="js-sandbox-code",c={ERROR:0,WARN:1,INFO:2,DEBUG:3,TRACE:4},h=768;const d=function(){const e=document.querySelector("base");if(e&&e.href){return new URL(e.href).pathname}return window.location.pathname.includes("/sandboxjs/")?"/sandboxjs/":"/"}()+"examples",g="./assets/sandbox.html",u={INIT_START:"init:start",INIT_COMPLETE:"init:complete",INIT_ERROR:"init:error",CODE_CHANGE:"code:change",CODE_LOAD:"code:load",CODE_VALIDATE:"code:validate",CODE_EXECUTE_START:"code:execute:start",CODE_EXECUTE_COMPLETE:"code:execute:complete",CODE_EXECUTE_TIMEOUT:"code:execute:timeout",CONSOLE_MESSAGE:"console:message",CONSOLE_CLEAR:"console:clear",SANDBOX_RESET:"sandbox:reset",STATUS_CHANGE:"status:change",THEME_LOAD_START:"theme:load:start",THEME_LOAD_COMPLETE:"theme:load:complete",THEME_CHANGE:"theme:change",THEME_READY:"theme:ready",EDITOR_READY:"editor:ready",EDITOR_CHANGE:"editor:change",EDITOR_CHANGED:"editor:changed",EXAMPLE_LOAD:"example:load",EXAMPLE_LOADED:"example:loaded",EXAMPLE_ERROR:"example:error",PANES_RESIZED:"panes:resized",PANES_RESIZED_VERTICAL:"panes:resized:vertical",FULLSCREEN_TOGGLE:"fullscreen:toggle",FULLSCREEN_EDITOR:"fullscreen:editor",FULLSCREEN_CONSOLE:"fullscreen:console",FULLSCREEN_EXIT:"fullscreen:exit",LIBRARY_MANAGER_OPEN:"library:manager:open",LIBRARY_ADD:"library:add",LIBRARY_ADDED:"library:added",LIBRARY_REMOVE:"library:remove",LIBRARY_REMOVED:"library:removed",DOMAIN_TRUST_REQUEST:"domain:trust:request",DOMAIN_ADDED:"domain:added",DOMAIN_REMOVED:"domain:removed",LIBRARIES_CLEARED:"libraries:cleared",SHARE_SUCCESS:"share:success",SHARE_ERROR:"share:error",DESTROY:"destroy"},p={executing:"Executing…",completed:"Completed",timeout:"Timeout exceeded",reset:"Sandbox reset",cleared:"Console cleared"},m=2,f={SECRET:"{{SECRET}}",USER_CODE:"{{USER_CODE}}",DYNAMIC_CSP:"{{DYNAMIC_CSP}}",LIBRARY_SCRIPTS:"{{LIBRARY_SCRIPTS}}"},b={ACE:[{value:"dracula",label:"🧛 Dracula"},{value:"ambiance",label:"🎨 Ambiance"},{value:"chaos",label:"🌪️ Chaos"},{value:"clouds_midnight",label:"☁️ Clouds Midnight"},{value:"cobalt",label:"🔵 Cobalt"},{value:"gruvbox",label:"🎨 Gruvbox"},{value:"gob",label:"🟢 Green on Black"},{value:"idle_fingers",label:"👆 Idle Fingers"},{value:"kr_theme",label:"🌃 Karyonight"},{value:"merbivore",label:"🍇 Merbivore"},{value:"merbivore_soft",label:"🍇 Merbivore Soft"},{value:"mono_industrial",label:"🏭 Mono Industrial"},{value:"monokai",label:"🎯 Monokai"},{value:"nord_dark",label:"❄️ Nord on Dark"},{value:"one_dark",label:"🌑 One Dark"},{value:"pastel_on_dark",label:"🎨 Pastel on Dark"},{value:"solarized_dark",label:"☀️ Solarized Dark"},{value:"solarized_light",label:"☀️ Solarized Light"},{value:"github_dark",label:"🐙 Github Dark"},{value:"cloud_editor_light",label:"☁️ Cloud Editor Light"},{value:"terminal",label:"🖥️ Terminal"}],CODEMIRROR:[{value:"material",label:"📱 Material"},{value:"default",label:"🏳️ Default"},{value:"darcula",label:"🌙 Darcula"},{value:"monokai",label:"🎯 Monokai"},{value:"solarized",label:"☀️ Solarized Dark"},{value:"dracula",label:"🧛 Dracula"},{value:"tomorrow-night-eighties",label:"🌉 Tomorrow Night"},{value:"base16-dark",label:"🌃 Base16 Dark"},{value:"blackboard",label:"⚫ Blackboard"},{value:"eclipse",label:"🌅 Eclipse"}],TEXTAREA:[{value:"default",label:"🏳️ Default"}]};const E=new class{constructor(){this.allowedComponents=new Set,this.globalEnabled=!0,this.allowAll=!1,this.loadFromStorage()}enable(...e){e.forEach(e=>this.allowedComponents.add(e.toLowerCase())),this.saveToStorage(),console.log("🔧 Logging enabled for:",e.join(", "))}disable(...e){e.forEach(e=>this.allowedComponents.delete(e.toLowerCase())),this.saveToStorage(),console.log("🔧 Logging disabled for:",e.join(", "))}enableAll(){this.allowAll=!0,this.saveToStorage(),console.log("🔧 Logging enabled for ALL components")}disableAll(){this.allowAll=!1,this.allowedComponents.clear(),this.saveToStorage(),console.log("🔧 Logging disabled for ALL components (errors still show)")}status(){console.log("🔧 Logging Status:"),console.log("  Global enabled:",this.globalEnabled),console.log("  Allow all:",this.allowAll),console.log("  Enabled components:",Array.from(this.allowedComponents).join(", ")||"none")}listComponents(){console.log("🔧 Available components to filter:");Array.from(this.registeredComponents||[]).sort().forEach(e=>{const t=this.isComponentEnabled(e);console.log(`  ${t?"✅":"❌"} ${e}`)})}isComponentEnabled(e){return!!this.globalEnabled&&(!!this.allowAll||this.allowedComponents.has(e.toLowerCase()))}registerComponent(e){this.registeredComponents||(this.registeredComponents=new Set),this.registeredComponents.add(e)}saveToStorage(){try{const e={allowedComponents:Array.from(this.allowedComponents),allowAll:this.allowAll,globalEnabled:this.globalEnabled};localStorage.setItem("sandbox_logging_filters",JSON.stringify(e))}catch(e){}}loadFromStorage(){try{const e=JSON.parse(localStorage.getItem("sandbox_logging_filters")||"{}");this.allowedComponents=new Set(e.allowedComponents||[]),this.allowAll=e.allowAll||!1,this.globalEnabled=!1!==e.globalEnabled,localStorage.getItem("sandbox_logging_filters")||(this.allowedComponents=new Set(["themeswitcher","codemirroreditor","editoradapter"]))}catch(e){this.allowedComponents=new Set(["themeswitcher","codemirroreditor","editoradapter"])}}};"undefined"!=typeof window&&(window.logFilter={enable:(...e)=>E.enable(...e),disable:(...e)=>E.disable(...e),enableAll:()=>E.enableAll(),disableAll:()=>E.disableAll(),status:()=>E.status(),list:()=>E.listComponents()});class C{constructor(e={}){this.enabled=!1!==e.enabled,this.level=e.level||"info",this.prefix=e.prefix||"",this.component=this.prefix,this.redactSecrets=e.redactSecrets||!1,this.currentLevel=c[this.level.toUpperCase()]??c.INFO,this.component&&E.registerComponent(this.component)}shouldLog(e){if("ERROR"===e.toUpperCase())return this.enabled&&c[e.toUpperCase()]<=this.currentLevel;const t=!this.component||E.isComponentEnabled(this.component);return this.enabled&&t&&c[e.toUpperCase()]<=this.currentLevel}redactArgs(e){return this.redactSecrets?e.map(e=>"string"==typeof e?e.replace(/\b[a-zA-Z0-9]{20,}\b/g,"[REDACTED]"):e):e}formatMessage(e,...t){return[(this.prefix?`[${this.prefix}] `:"")+e,...this.redactArgs(t)]}error(e,...t){this.shouldLog("error")&&console.error(...this.formatMessage(e,...t))}warn(e,...t){this.shouldLog("warn")&&console.warn(...this.formatMessage(e,...t))}info(e,...t){this.shouldLog("info")&&console.info(...this.formatMessage(e,...t))}log(e,...t){this.shouldLog("info")&&console.log(...this.formatMessage(e,...t))}debug(e,...t){this.shouldLog("debug")&&console.debug(...this.formatMessage(e,...t))}trace(e,...t){if(this.shouldLog("trace")){const o=this.redactSecrets;this.redactSecrets=!0,console.trace(...this.formatMessage(e,...t)),this.redactSecrets=o}}table(e,t){if(this.shouldLog("info")){const o=this.prefix?`[${this.prefix}]`:"";o&&console.log(o),console.table(e,t)}}group(e){this.shouldLog("info")&&console.group(...this.formatMessage(e))}groupCollapsed(e){this.shouldLog("info")&&console.groupCollapsed(...this.formatMessage(e))}groupEnd(){this.shouldLog("info")&&console.groupEnd()}time(e){this.shouldLog("debug")&&console.time(this.prefix?`[${this.prefix}] ${e}`:e)}timeEnd(e){this.shouldLog("debug")&&console.timeEnd(this.prefix?`[${this.prefix}] ${e}`:e)}setLevel(e){this.level=e,this.currentLevel=c[e.toUpperCase()]??c.INFO}enable(){this.enabled=!0}disable(){this.enabled=!1}isEnabled(){return this.enabled}}class w{constructor(e,t={},o=null){this.container=e,this.options=t,this.eventEmitter=o,this.changeHandlers=[],this.executeHandlers=[],this.inputHandlers=[],this.deleteHandlers=[],this.logger=new C({enabled:!0,level:"info",prefix:"EditorAdapter"}),this.eventEmitter?(this.logger.info("Setting up theme event listeners"),this.eventEmitter.on(u.THEME_READY,e=>{this.logger.info("Base adapter received theme ready event:",e),this.onThemeChange(e.theme,null)}),this.eventEmitter.on(u.THEME_CHANGE,e=>{this.logger.info("Base adapter received theme change event:",e),this.onThemeChange(e.theme,e.oldTheme)})):this.logger.warn("No event emitter provided - theme switching will not work")}getValue(){throw new Error("getValue() must be implemented by editor adapter")}setValue(e){throw new Error("setValue() must be implemented by editor adapter")}onChange(e){this.changeHandlers.push(e)}onExecute(e){this.executeHandlers.push(e)}onInput(e){this.inputHandlers.push(e)}onDelete(e){this.deleteHandlers.push(e)}focus(){throw new Error("focus() must be implemented by editor adapter")}triggerChange(){this.changeHandlers.forEach(e=>e(this.getValue()))}triggerExecute(){this.executeHandlers.forEach(e=>e())}triggerInput(e){this.inputHandlers.forEach(t=>t(e))}triggerDelete(e){this.deleteHandlers.forEach(t=>t(e))}applyTransformation(e){throw new Error("applyTransformation() must be implemented by editor adapter")}onThemeChange(e,t){}destroy(){}}class A{constructor(e,t={}){this.cm=e,this.options=t,this.logger=new C({enabled:t.debug||!1,prefix:"AdvancedAutocomplete"}),this.scopeVariables=new Map,this.loadedLibraries=new Map,this.initScopeTracking()}initScopeTracking(){this.cm.on("change",()=>{this.analyzeScopeVariables()}),this.analyzeScopeVariables()}analyzeScopeVariables(){const e=this.cm.getValue();this.scopeVariables.clear(),Object.entries({variables:/(?:const|let|var)\s+(\w+)/g,functions:/function\s+(\w+)/g,classes:/class\s+(\w+)/g,arrowFunctions:/(?:const|let|var)\s+(\w+)\s*=\s*(?:\([^)]*\)|[^=])\s*=>/g}).forEach(([t,o])=>{let r;for(;null!==(r=o.exec(e));){const o=r[1];o&&this.scopeVariables.set(o,{type:t,line:this.getLineNumber(e,r.index),value:this.extractValue(e,r.index)})}}),this.logger.info("Scope analysis complete:",this.scopeVariables.size,"variables found")}getLineNumber(e,t){return e.substring(0,t).split("\n").length-1}extractValue(e,t){const o=e.substring(t,t+100).match(/=\s*([^;,\n]+)/);return o?o[1].trim():null}provideHints(e,t){const o=e.getCursor(),r=e.getTokenAt(o),s=e.getLine(o.line),n=r.start,a=o.ch;let i=[];if(s.substring(0,n).endsWith(".")||this.scopeVariables.forEach((t,s)=>{s.toLowerCase().startsWith(r.string.toLowerCase())&&i.push({text:s,displayText:s,type:t.type,className:"scope-variable",hint:()=>e.replaceRange(s,{line:o.line,ch:n},o)})}),s.substring(0,n).endsWith(".")){const e=s.substring(0,n-1).match(/(\w+)$/);if(e){const t=e[1],o=this.scopeVariables.get(t);o&&o.value&&(i=this.getPropertySuggestions(o.value))}}return{list:i,from:CodeMirror.Pos(o.line,n),to:CodeMirror.Pos(o.line,a)}}getPropertySuggestions(e){return e.startsWith("[")?["length","push","pop","map","filter","reduce","forEach"].map(e=>({text:e,displayText:e+"()",className:"array-method"})):e.startsWith("{")?["hasOwnProperty","toString","valueOf"].map(e=>({text:e,displayText:e+"()",className:"object-method"})):e.startsWith('"')||e.startsWith("'")||e.startsWith("`")?["length","charAt","split","substring","replace"].map(e=>({text:e,displayText:e+("length"===e?"":"()"),className:"string-method"})):[]}}class y{constructor(e={}){this.options={debug:!1,...e},this.logger=new C({enabled:this.options.debug,level:"info",prefix:"InputManager"}),this.bracketPairs=new Map([["(",")"],["[","]"],["{","}"],['"','"'],["'","'"],["`","`"]]),this.logger.info("InputManager initialized")}handleInput(e){const{char:t,position:o,line:r}=e;if(this.logger.debug(`Handling input: "${t}" at position ${o}`),this.bracketPairs.has(t)){const o=this.bracketPairs.get(t);if(this.shouldAutoClose(e,o))return this.logger.debug(`Auto-closing ${t} with ${o}`),{action:"insert",text:o,cursorOffset:-1}}if(Array.from(this.bracketPairs.values()).includes(t)){if(r.charAt(o)===t)return this.logger.debug(`Skipping over existing ${t}`),{action:"skip",positions:1}}return null}handleDelete(e){const{type:t,position:o,line:r}=e;if("backspace"===t){const e=r.charAt(o-1),t=r.charAt(o);for(const[r,s]of this.bracketPairs)if(e===r&&t===s)return this.logger.debug(`Deleting empty bracket pair: ${r}${s}`),{action:"deleteRange",start:o-1,end:o+1}}return null}shouldAutoClose(e,t){const{char:o,position:r,line:s}=e,n=s.charAt(r),a=s.charAt(r-1);if(['"',"'","`"].includes(o)){if(/\w/.test(a)&&/\w/.test(n))return!1;if(n===o)return!1}return!n||/\s/.test(n)||[")","]","}",",",";","."].includes(n)}getDebugInfo(e,t){return{charBefore:e.charAt(t-1)||"none",charAfter:e.charAt(t)||"none",position:t,lineLength:e.length,nearContext:e.substring(Math.max(0,t-3),t+3)}}}class v extends w{constructor(e,t={},o=null){super(e,t,o),this.cm=null,this.currentTheme=t.theme||"darcula",this.logger=new C({enabled:!0,level:"info",prefix:"CodeMirrorEditor"}),this.inputManager=new y({debug:t.debug||!1}),this.logger.info("CodeMirror editor initialized with theme:",this.currentTheme),this.logger.info("Event emitter provided:",!!o),this.init(),this.setupInputHandling()}init(){if("undefined"==typeof CodeMirror)throw new Error("CodeMirror is not loaded. Include CodeMirror before using this adapter.");const e=document.createElement("textarea");this.container.appendChild(e),this.cm=CodeMirror.fromTextArea(e,{mode:this.options.mode||"javascript",theme:this.currentTheme,lineNumbers:!0,lineWrapping:!0,indentUnit:2,tabSize:2,indentWithTabs:!1,autofocus:!1!==this.options.autofocus,extraKeys:{"Ctrl-Enter":()=>this.triggerExecute(),"Cmd-Enter":()=>this.triggerExecute()}}),this.cm.on("change",()=>{this.triggerChange()}),!1!==this.options.autocomplete&&this.setupAutocomplete(),this.applyGlassEffect(this.currentTheme)}getValue(){return this.cm.getValue()}setValue(e){this.cm.setValue(e)}focus(){this.cm.focus()}onThemeChange(e,t){this.logger.info("onThemeChange called with:",{newTheme:e,oldTheme:t}),this.logger.info("Current theme before change:",this.currentTheme),this.logger.info("CodeMirror instance exists:",!!this.cm),this.cm&&e!==this.currentTheme?(this.logger.info("Applying theme change from",this.currentTheme,"to",e),this.currentTheme=e,this.cm.setOption("theme",e),this.logger.info("Theme applied successfully. CodeMirror theme is now:",this.cm.getOption("theme")),this.applyGlassEffect(e)):(this.logger.warn("Theme change skipped. Reasons:"),this.logger.warn("- CodeMirror exists:",!!this.cm),this.logger.warn("- New theme different from current:",e!==this.currentTheme),this.logger.warn("- New theme value:",e),this.logger.warn("- Current theme value:",this.currentTheme))}applyGlassEffect(e){setTimeout(()=>{const t=this.container.querySelector(".CodeMirror");if(t){this.logger.info("Applying glass effect for theme:",e);const o=window.getComputedStyle(t).backgroundColor;this.logger.info("Original background color:",o);const r=this.reduceColorOpacity(o,.7);this.logger.info("Reduced opacity color:",r);let s=document.getElementById("codemirror-glass-effect");s||(s=document.createElement("style"),s.id="codemirror-glass-effect",document.head.appendChild(s));const n=`.cm-s-${e}`;s.textContent=`\n          ${n}.CodeMirror {\n            background-color: ${r} !important;\n          }\n          ${n} .CodeMirror-gutters {\n            background-color: ${this.reduceColorOpacity(o,.8)} !important;\n          }\n        `,this.logger.info("Glass effect applied with reduced opacity background")}},200)}reduceColorOpacity(e,t){const o=e.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*([\d.]+))?\)/);if(o){const[,e,r,s]=o;return`rgba(${e}, ${r}, ${s}, ${t})`}const r=e.match(/rgb\((\d+),\s*(\d+),\s*(\d+)\)/);if(r){const[,e,o,s]=r;return`rgba(${e}, ${o}, ${s}, ${t})`}const s=e.match(/^#([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i);if(s){return`rgba(${parseInt(s[1],16)}, ${parseInt(s[2],16)}, ${parseInt(s[3],16)}, ${t})`}return this.logger.warn("Could not parse color:",e,"using fallback"),`rgba(0, 0, 0, ${t})`}getCurrentTheme(){return this.currentTheme}setTheme(e){this.cm&&e!==this.currentTheme&&(this.currentTheme=e,this.cm.setOption("theme",e))}setupAutocomplete(){if(this.logger.info("Setting up autocomplete"),!document.getElementById("codemirror-autocomplete-styles")){const e=document.createElement("style");e.id="codemirror-autocomplete-styles",e.textContent="\n  .CodeMirror-hints {\n    position: absolute;\n    z-index: 10;\n    overflow: hidden;\n    list-style: none;\n    margin: 0;\n    padding: 2px;\n    background: #1e1e1e;\n    border: 1px solid #444;\n    border-radius: 4px;\n    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);\n    font-family: monospace;\n    font-size: 90%;\n    max-height: 20em;\n    overflow-y: auto;\n  }\n\n  .CodeMirror-hint {\n    margin: 0;\n    padding: 4px 8px;\n    border-radius: 2px;\n    white-space: pre;\n    cursor: pointer;\n  }\n\n  .CodeMirror-hint-active {\n    background: #2a2a2a;\n    color: #fff;\n  }\n\n  .autocomplete-item {\n    display: flex;\n    align-items: center;\n  }\n\n  .autocomplete-item.keyword {\n    color: #c678dd;\n  }\n\n  .autocomplete-item.global {\n    color: #61afef;\n  }\n\n  .autocomplete-item.method {\n    color: #e06c75;\n  }\n\n  .autocomplete-item.user-variable {\n    color: #ffffff;\n    font-weight: 500;\n  }\n\n  /* Integrate with your neon glow theme */\n  .CodeMirror-hints {\n    backdrop-filter: blur(10px);\n    background: rgba(30, 30, 30, 0.9);\n    border: 1px solid rgba(255, 255, 255, 0.1);\n  }\n",document.head.appendChild(e)}const e=function(e){let t=null;const o=["async","await","break","case","catch","class","const","continue","debugger","default","delete","do","else","export","extends","finally","for","function","if","import","in","instanceof","let","new","return","super","switch","this","throw","try","typeof","var","void","while","with","yield","true","false","null","undefined"],r=["document","window","console","navigator","location","history","localStorage","sessionStorage","fetch","Promise","Array","Object","String","Number","Boolean","Date","RegExp","Math","JSON","setTimeout","setInterval","clearTimeout","clearInterval","requestAnimationFrame","cancelAnimationFrame"];function s(e,t=null){if(!e)return[];const o=new Set;Object.getOwnPropertyNames(e).forEach(t=>{try{"function"!=typeof e[t]||t.startsWith("_")||o.add(t)}catch(r){}}),t&&Object.getOwnPropertyNames(t).forEach(e=>{try{"function"!=typeof t[e]||"constructor"===e||e.startsWith("_")||o.add(e)}catch(r){}});let r=t||Object.getPrototypeOf(e);for(;r&&r!==Object.prototype;)try{Object.getOwnPropertyNames(r).forEach(e=>{try{"function"!=typeof r[e]||"constructor"===e||e.startsWith("_")||o.add(e)}catch(t){}}),r=Object.getPrototypeOf(r)}catch(s){break}return Array.from(o).sort()}const n=s(console),a=s(window,Window.prototype),i=s(document,Document.prototype),l=s([],Array.prototype),c=s("",String.prototype),h=s(Math);console.log("🔍 Autocomplete setup complete:"),console.log("  - Window methods:",a.length),console.log("  - Document methods:",i.length),console.log("  - Console methods:",n.length);const d={console:n,window:a,document:i,Array:l,String:c,Math:h,localStorage:s(localStorage,Storage.prototype),sessionStorage:s(sessionStorage,Storage.prototype),navigator:s(navigator,Navigator.prototype),location:s(location,Location.prototype)};function g(e,n){const a=e.getCursor(),i=e.getTokenAt(a),l=i.start,c=a.ch,h=a.line,g=i.string,u=e.getLine(h).substring(0,c);let p=[];const m=u.match(/(\w+)\.(\w*)$/);if(m){const e=m[1],t=m[2]||"";if(console.log(`🔍 Object access: ${e}.${t}`),d[e]){let o=d[e];console.log(`🔍 Found ${o.length} methods for ${e}`),t?(p=o.filter(e=>e.toLowerCase().startsWith(t.toLowerCase())),console.log(`🔍 Filtered to ${p.length} methods for "${t}":`,p.slice(0,5))):p=o}else if("Array"===e)p=d.Array;else if("String"===e||textBefore.match(/["'].*["']\.$/))p=d.String;else try{const t=window[e];p=t?s(t,t.constructor?.prototype):s({},Object.prototype)}catch(E){p=["toString","valueOf","hasOwnProperty","constructor"]}}else{const e=[...o,...r];if(t&&t.scopeVariables){const o=Array.from(t.scopeVariables.keys());e.push(...o)}p=g?e.filter(e=>e.toLowerCase().startsWith(g.toLowerCase())):e}let f=l,b=c;return m&&(f=u.lastIndexOf(".")+1),{list:p.map(e=>({text:e,displayText:e,className:"autocomplete-item",render:(e,s,n)=>{e.textContent=n.displayText,o.includes(n.text)?e.className+=" keyword":r.includes(n.text)?e.className+=" global":t&&t.scopeVariables&&t.scopeVariables.has(n.text)?e.className+=" user-variable":e.className+=" method"}})),from:CodeMirror.Pos(h,f),to:CodeMirror.Pos(h,b)}}CodeMirror.registerHelper("hint","javascript",g);const u=e.getOption("extraKeys")||{};return e.setOption("extraKeys",{...u,"Ctrl-Space":"autocomplete",".":function(e){e.replaceSelection("."),e.execCommand("autocomplete")}}),e.on("inputRead",function(e,t){t.text[0]&&/[a-zA-Z]/.test(t.text[0])&&e.execCommand("autocomplete")}),{setAdvancedInstance:e=>{t=e},hint:g}}(this.cm,{});this.advancedAutocomplete=new A(this.cm,{debug:this.options.debug}),e&&e.setAdvancedInstance&&e.setAdvancedInstance(this.advancedAutocomplete),this.logger.info("Autocomplete setup complete")}setupInputHandling(){this.logger.info("Setting up input handling"),this.cm.on("inputRead",(e,t)=>{if(1===t.text.length&&t.text[0]){const o=t.text[0],r=e.getCursor(),s=e.getLine(r.line),n={char:o,position:r.ch-1,line:s.substring(0,r.ch-1)+s.substring(r.ch),lineNumber:r.line};this.logger.debug("Input event:",n);const a=this.inputManager.handleInput(n);a&&this.applyTransformation(a),this.triggerInput(n)}}),this.cm.on("beforeChange",(e,t)=>{if("+delete"===t.origin||"delete"===t.origin){const t=e.getCursor(),o=e.getLine(t.line),r={type:"backspace",position:t.ch,line:o,lineNumber:t.line};this.logger.debug("Delete event:",r);const s=this.inputManager.handleDelete(r);s&&setTimeout(()=>this.applyTransformation(s),0),this.triggerDelete(r)}}),this.logger.info("Input handling setup complete")}applyTransformation(e){this.logger.debug("Applying transformation:",e);const t=this.cm.getCursor();switch(e.action){case"insert":if(this.cm.replaceSelection(e.text),void 0!==e.cursorOffset){const t=this.cm.getCursor();this.cm.setCursor(t.line,t.ch+e.cursorOffset)}break;case"skip":this.cm.setCursor(t.line,t.ch+e.positions);break;case"deleteRange":this.cm.replaceRange("",{line:t.line,ch:e.start},{line:t.line,ch:e.end});break;default:this.logger.warn("Unknown transformation action:",e.action)}}destroy(){this.cm&&this.cm.toTextArea()}}const x=Object.freeze(Object.defineProperty({__proto__:null,CodeMirrorEditor:v},Symbol.toStringTag,{value:"Module"}));export{m as C,g as D,u as E,C as L,r as M,t as N,i as R,p as S,o as T,f as a,e as b,l as c,d,b as e,s as f,n as g,a as h,h as i,w as j,v as k,x as l};
//# sourceMappingURL=vendor-CiEMj8hI.js.map
